<!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->





<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cloud Native Stream Processor">
      
      
        <link rel="canonical" href="http://siddhi.io/en/v5.1/docs/guides/alerts-for-thresholds/guide/">
      
      
        <meta name="author" content="WSO2">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Alerts Based on Thresholds - Siddhi</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../../assets/lib/highlightjs/default.min.css">
    
      <link rel="stylesheet" href="../../../../assets/css/theme.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-103065-28", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#generating-alerts-based-on-static-and-dynamic-thresholds" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->

<header class="md-header" data-md-component="header" id="page-header" data-url=""
        data-lang="en">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://siddhi.io/en/v5.1/" title="Siddhi"
           class="md-header-nav__button md-logo">
          
            <img src="../../../../images/siddhi-logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Siddhi
            </span>
            <span class="md-header-nav__topic">
              Alerts Based on Thresholds
            </span>
          
        </div>
        <div class="md-flex__ellipsis md-header__version-select">
            <div class="mb-tabs__dropdown version-select">
                <a class="md-tabs__link md-tabs__dropdown-link" href="#!" data-target="version-select-dropdown">
                  v5.1</a>
                <ul id="version-select-dropdown" class="mb-tabs__dropdown-content" tabindex="0">
                    <!-- Versions will added here dynamically -->
                    <li class="md-tabs__item mb-tabs__dropdown">
                        <a href="#" id="show-all-versions-link">Show all</a>
                    </li>
                </ul>
            </div>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
        </div>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
        <li class="md-tabs__item home_icon">
            <a href="/" title="Siddhi Home" class="md-tabs__link md-tabs__link--active">
                <i class="fa fa-home"></i>
            </a>
        </li>
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../download/" title="Download" class="md-tabs__link">
          Download
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../quick-start/" title="Quick Start" class="md-tabs__link">
          Quick Start
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../" title="Documentation" class="md-tabs__link md-tabs__link--active">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/community/" title="Community" class="md-tabs__link">
          Community
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../development/" title="Development" class="md-tabs__link">
          Development
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/license/" title="License" class="md-tabs__link">
          License
        </a>
      
    </li>
  

      
    </ul>
    <div class="quick_links">
        
        <a href="https://github.com/siddhi-io/www/edit/v5.1/en/docs/docs/guides/alerts-for-thresholds/guide.md" target="blank" id="editIcon" title="Edit this page"
           title="Edit this page" class="md-icon md-content__icon nav_link edit_link"></a>
        
    </div>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
    <label class="md-nav__title md-nav__title--site" for="__drawer">
      <a href="http://siddhi.io/en/v5.1/" title="Siddhi"
         class="md-nav__button md-logo">
        
          <img src="../../../../images/siddhi-logo.svg" width="48" height="48">
        
      </a>
      Siddhi
    </label>
    
      <div class="md-nav__source">
        


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
      </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Download
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Download
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Quick Start
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Quick Start
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4" checked>
    
    <label class="md-nav__link" for="nav-3-4">
      Use case Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Use case Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Alerts Based on Thresholds
      </label>
    
    <a href="./" title="Alerts Based on Thresholds" class="md-nav__link md-nav__link--active">
      Alerts Based on Thresholds
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scenario-throttling-for-api-requests" title="Scenario - Throttling for API Requests" class="md-nav__link">
    Scenario - Throttling for API Requests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" title="What you'll build" class="md-nav__link">
    What you'll build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-requirements" title="Mandatory Requirements" class="md-nav__link">
    Mandatory Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Requirements needed to deploy Siddhi in Docker/Kubernetes" class="md-nav__link">
    Requirements needed to deploy Siddhi in Docker/Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implement-streaming-queries" title="Implement Streaming Queries" class="md-nav__link">
    Implement Streaming Queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-mock-logger-service" title="Run Mock Logger service" class="md-nav__link">
    Run Mock Logger service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-the-siddhi-app" title="Invoking the Siddhi App" class="md-nav__link">
    Invoking the Siddhi App
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-on-vm-bare-metal" title="Deploy on VM/ Bare Metal" class="md-nav__link">
    Deploy on VM/ Bare Metal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-docker" title="Deploy on Docker" class="md-nav__link">
    Deploy on Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-kubernetes" title="Deploy on Kubernetes" class="md-nav__link">
    Deploy on Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fault-tolerance/guide/" title="Fault Tolerance & Error Handling" class="md-nav__link">
      Fault Tolerance & Error Handling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns-and-trends/guide/" title="Patterns & Trends Over Time" class="md-nav__link">
      Patterns & Trends Over Time
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database-static-rule-processing/guide/" title="Static Rule Processing using Database Rules" class="md-nav__link">
      Static Rule Processing using Database Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrate-various-enterprise-systems/guide/" title="Integrate Various Enterprise Systems" class="md-nav__link">
      Integrate Various Enterprise Systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime-movie-recommendation/guide/" title="Realtime predictions with pre-trained ML models" class="md-nav__link">
      Realtime predictions with pre-trained ML models
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../long-term-aggregation/guide/" title="Long-running time based Aggregations" class="md-nav__link">
      Long-running time based Aggregations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tooling/" title="Tooling" class="md-nav__link">
      Tooling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../query-guide/" title="Query Guide" class="md-nav__link">
      Query Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Siddhi APIs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Siddhi APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/latest/" title="latest" class="md-nav__link">
      latest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/5.1.0/" title="5.1.0" class="md-nav__link">
      5.1.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">
    
    <label class="md-nav__link" for="nav-3-8">
      REST API Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        REST API Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/siddhi-app-api/" title="Siddhi App APIs" class="md-nav__link">
      Siddhi App APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/on-demand-query-api/" title="On-Demand Query APIs" class="md-nav__link">
      On-Demand Query APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/health-check-api/" title="Health Check APIs" class="md-nav__link">
      Health Check APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/store-api/" title="Store APIs (Deprecated)" class="md-nav__link">
      Store APIs (Deprecated)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/default-ports/" title="Default Ports" class="md-nav__link">
      Default Ports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/http-status-code/" title="HTTP Status Codes" class="md-nav__link">
      HTTP Status Codes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-java-library/" title="Siddhi Java Library" class="md-nav__link">
      Siddhi Java Library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-local-microservice/" title="Siddhi Local Microservice" class="md-nav__link">
      Siddhi Local Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-docker-microservice/" title="Siddhi Docker Microservice" class="md-nav__link">
      Siddhi Docker Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-kubernetes-microservice/" title="Siddhi Kubernetes Microservice" class="md-nav__link">
      Siddhi Kubernetes Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-python-library/" title="Siddhi Python Library" class="md-nav__link">
      Siddhi Python Library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../config-guide/" title="Configuration Guide" class="md-nav__link">
      Configuration Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Community
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Community
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/source/" title="Source" class="md-nav__link">
      Source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/build/" title="Build" class="md-nav__link">
      Build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      License
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        License
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
    </ul>
  </nav>  
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scenario-throttling-for-api-requests" title="Scenario - Throttling for API Requests" class="md-nav__link">
    Scenario - Throttling for API Requests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" title="What you'll build" class="md-nav__link">
    What you'll build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-requirements" title="Mandatory Requirements" class="md-nav__link">
    Mandatory Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Requirements needed to deploy Siddhi in Docker/Kubernetes" class="md-nav__link">
    Requirements needed to deploy Siddhi in Docker/Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implement-streaming-queries" title="Implement Streaming Queries" class="md-nav__link">
    Implement Streaming Queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-mock-logger-service" title="Run Mock Logger service" class="md-nav__link">
    Run Mock Logger service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-the-siddhi-app" title="Invoking the Siddhi App" class="md-nav__link">
    Invoking the Siddhi App
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-on-vm-bare-metal" title="Deploy on VM/ Bare Metal" class="md-nav__link">
    Deploy on VM/ Bare Metal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-docker" title="Deploy on Docker" class="md-nav__link">
    Deploy on Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-kubernetes" title="Deploy on Kubernetes" class="md-nav__link">
    Deploy on Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
  
                
                  <a href="https://github.com/siddhi-io/www/edit/v5.1/en/docs/docs/guides/alerts-for-thresholds/guide.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="generating-alerts-based-on-static-and-dynamic-thresholds">Generating Alerts Based on Static and Dynamic Thresholds<a class="headerlink" href="#generating-alerts-based-on-static-and-dynamic-thresholds" title="Permanent link">&para;</a></h1>
<p>In this guide, you will understand one of the common requirements of a Stream Processing which is generating alerts based on static and dynamic thresholds. To understand this requirement, let’s consider the throttling use case in API management solutions. </p>
<h2 id="scenario-throttling-for-api-requests">Scenario - Throttling for API Requests<a class="headerlink" href="#scenario-throttling-for-api-requests" title="Permanent link">&para;</a></h2>
<p>Throttling has become as one of the unavoidable needs with the evolution of APIs and API management. Throttling is a process that is used to control the usage of APIs by consumers during a given period. </p>
<p>The following sections are available in this guide.</p>
<ul>
<li><a href="#what-youll-build">What you'll build</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#deployment">Deployment &amp; Output</a></li>
</ul>
<h2 id="what-youll-build">What you'll build<a class="headerlink" href="#what-youll-build" title="Permanent link">&para;</a></h2>
<p>Let's consider a real world use case to implement the throttling requirement. This will help you to understand some Siddhi Stream Processing constructs such as windows, aggregations, source, and etc. Let’s jump into the use case directly.</p>
<p>Let's assume that you are an API developer and you have published a few APIs to the API store and there are subscribers who have subscribed to these APIs in different tiers which are categorized based on the number of requests per min/sec. If any subscriber is consuming an API more than the allowed quota within a time frame then that specific user will be throttled until that time frame passes. Also if a subscriber is getting throttled often then the system sends a notification to that user requesting to upgrade the tier.</p>
<p>For example, let’s assume that user “John” has subscribed to an API with the tier 'Silver'; silver tier allows a user to make 10 API requests per minute. If John, made more than 10 requests within a minute then his subsequent requests get throttled until the end of the minute, and if he has got throttled more than 10 times in an hour, then he will be notified to upgrade his tier via email.</p>
<p><img alt="Throttling_Scenario" src="../images/throttling-scenario.png" title="Throttling Scenario" /></p>
<p>Now, let’s understand how this could be implemented in Siddhi engine.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>Below are the prerequisites that should be considered to implement the above use case.</p>
<h3 id="mandatory-requirements">Mandatory Requirements<a class="headerlink" href="#mandatory-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://siddhi.io/en/v5.1/download/">Siddhi tooling VM/Local distribution</a></li>
<li>One of the <a href="https://siddhi.io/en/v5.1/download/">Siddhi runner distributions</a> <ul>
<li>VM/Local Runtime</li>
<li>Docker Image</li>
<li>K8S Operator (commands are given in deployment section)</li>
</ul>
</li>
<li>Java 8 or higher</li>
</ul>
<h3 id="requirements-needed-to-deploy-siddhi-in-dockerkubernetes">Requirements needed to deploy Siddhi in Docker/Kubernetes<a class="headerlink" href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.docker.com/engine/installation/">Docker</a></li>
<li><a href="https://github.com/kubernetes/minikube#installation">Minikube</a> or <a href="https://console.cloud.google.com/">Google Kubernetes Engine(GKE) Cluster</a> or <a href="https://docs.docker.com/docker-for-mac/install/">Docker for Mac</a></li>
</ul>
<h2 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h2>
<p>When a subscriber made an API call to <code>order-mgt-v1</code> API it sends an event with the API request information to Siddhi runtime through HTTP transport. </p>
<ul>
<li>Siddhi runtime, keep track of each API request and make decisions to throttle subscribers. </li>
<li>Again, once the corresponding time frame passed Siddhi release those throttle users. </li>
<li>Throttling decisions are informed to API management solution through an API call.</li>
<li>If a subscriber is getting throttled more than 10 times in an hour then sends a notification mail once every 15 minutes to that user requesting to upgrade the tier.</li>
</ul>
<h3 id="implement-streaming-queries">Implement Streaming Queries<a class="headerlink" href="#implement-streaming-queries" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Start the Siddhi <a href="https://siddhi.io/en/v5.0/docs/tooling/">tooling</a> runtime and go to the editor UI in http://localhost:9390/editor </p>
<p>Follow below steps to start the Siddhi tooling runtime.
* Extract the downloaded zip and navigate to <TOOLING_HOME>/bin. (TOOLING_HOME refers to the extracted folder) 
* Issue the following command in the command prompt (Windows) / terminal (Linux/Mac)
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>For Windows: tooling.bat
For Linux/Mac: ./tooling.sh
</pre></div>
</td></tr></table></p>
</li>
<li>
<p>Select File -&gt; New option, then you could either use the source view or design view to write/build the Siddhi Application. You can find the Siddhi Application bellow, that implements the requirements mentioned above.</p>
</li>
<li>
<p>Let’s write (develop) the Siddhi Application, as given below.</p>
</li>
<li>
<p>Once the Siddhi app is created, you can use the Event Simulator option in the editor to simulate events to streams and perform developer testing.</p>
</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;API-Request-Throttler&#39;</span><span class="p">)</span>
<span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">description</span><span class="p">(</span><span class="s1">&#39;Enforces throttling on API requests&#39;</span><span class="p">)</span>

<span class="c1">-- HTTP endpoint which listens for api request related events</span>
<span class="o">@</span><span class="k">source</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">receiver</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="ss">&quot;http://0.0.0.0:8006/apiRequest&quot;</span><span class="p">,</span> <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="ss">&quot;false&quot;</span><span class="p">,</span> 
    <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">APIRequestStream</span> <span class="p">(</span><span class="n">apiName</span> <span class="n">string</span><span class="p">,</span> <span class="k">version</span> <span class="n">string</span><span class="p">,</span> <span class="n">tier</span> <span class="n">string</span><span class="p">,</span> <span class="k">user</span> <span class="n">string</span><span class="p">,</span> <span class="n">userEmail</span> <span class="n">string</span><span class="p">);</span>

<span class="c1">-- HTTP sink to publich throttle decisions. For testing purpose, there is a mock logger service provided </span>
<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">publisher</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="ss">&quot;http://${LOGGER_SERVICE_HOST}:8080/logger&quot;</span><span class="p">,</span> <span class="k">method</span> <span class="o">=</span> <span class="ss">&quot;POST&quot;</span><span class="p">,</span> 
      <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">ThrottleOutputStream</span> <span class="p">(</span><span class="n">apiName</span> <span class="n">string</span><span class="p">,</span> <span class="k">version</span> <span class="n">string</span><span class="p">,</span> <span class="k">user</span> <span class="n">string</span><span class="p">,</span> <span class="n">tier</span> <span class="n">string</span><span class="p">,</span> <span class="n">userEmail</span> <span class="n">string</span><span class="p">,</span> <span class="n">isThrottled</span> <span class="n">bool</span><span class="p">);</span>

<span class="c1">-- Email sink to send alerts</span>
<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">))</span>
<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="ss">&quot;${EMAIL_USERNAME}&quot;</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="ss">&quot;${SENDER_EMAIL_ADDRESS}&quot;</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="ss">&quot;${EMAIL_PASSWORD}&quot;</span><span class="p">,</span> 
      <span class="n">subject</span> <span class="o">=</span> <span class="ss">&quot;Upgrade API Subscription Tier&quot;</span><span class="p">,</span> <span class="k">to</span> <span class="o">=</span> <span class="ss">&quot;{{userEmail}}&quot;</span><span class="p">,</span> <span class="k">host</span> <span class="o">=</span> <span class="ss">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="ss">&quot;465&quot;</span><span class="p">,</span> 
      <span class="n">ssl</span><span class="p">.</span><span class="n">enable</span> <span class="o">=</span> <span class="ss">&quot;true&quot;</span><span class="p">,</span> <span class="n">auth</span> <span class="o">=</span> <span class="ss">&quot;true&quot;</span><span class="p">,</span> 
      <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> 
           <span class="o">@</span><span class="n">payload</span><span class="p">(</span><span class="ss">&quot;&quot;&quot;</span>
<span class="ss">            Hi {{user}}</span>

<span class="ss">            You have subscribed to API called {{apiName}}:{{version}} with {{tier}} tier.</span>
<span class="ss">            Based on our records, it seems you are hitting the upper limit of the API requests in a frequent manner. </span>

<span class="ss">            We kindly request you to consider upgrading to next API subscription tier to avoid this in the future. </span>

<span class="ss">            Thanks, </span>
<span class="ss">            API Team&quot;&quot;&quot;</span><span class="p">)))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">UserNotificationStream</span> <span class="p">(</span><span class="k">user</span> <span class="n">string</span><span class="p">,</span> <span class="n">apiName</span> <span class="n">string</span><span class="p">,</span> <span class="k">version</span> <span class="n">string</span><span class="p">,</span> <span class="n">tier</span> <span class="n">string</span><span class="p">,</span> <span class="n">userEmail</span> <span class="n">string</span><span class="p">,</span> <span class="n">throttledCount</span> <span class="n">long</span><span class="p">);</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Query to find users who needs to be throttled based on tier `silver`&#39;</span><span class="p">)</span>
<span class="k">from</span> <span class="n">APIRequestStream</span><span class="p">[</span><span class="n">tier</span> <span class="o">==</span> <span class="ss">&quot;silver&quot;</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">timeBatch</span><span class="p">(</span><span class="mi">1</span> <span class="k">min</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> 
<span class="k">select</span> <span class="n">apiName</span><span class="p">,</span> <span class="k">version</span><span class="p">,</span> <span class="k">user</span><span class="p">,</span> <span class="n">tier</span><span class="p">,</span> <span class="n">userEmail</span><span class="p">,</span> <span class="k">count</span><span class="p">()</span> <span class="k">as</span> <span class="n">totalRequestCount</span> 
       <span class="k">group</span> <span class="k">by</span> <span class="n">apiName</span><span class="p">,</span> <span class="k">version</span><span class="p">,</span> <span class="k">user</span> 
       <span class="k">having</span> <span class="n">totalRequestCount</span> <span class="o">==</span> <span class="mi">10</span> <span class="k">or</span> <span class="n">totalRequestCount</span> <span class="o">==</span> <span class="mi">0</span> 
<span class="k">insert</span> <span class="k">all</span> <span class="n">events</span> <span class="k">into</span> <span class="n">ThrottledStream</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Query to find users who needs to be throttled based on tier `gold`&#39;</span><span class="p">)</span>
<span class="k">from</span> <span class="n">APIRequestStream</span><span class="p">[</span><span class="n">tier</span> <span class="o">==</span> <span class="ss">&quot;gold&quot;</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">timeBatch</span><span class="p">(</span><span class="mi">1</span> <span class="k">min</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> 
<span class="k">select</span> <span class="n">apiName</span><span class="p">,</span> <span class="k">version</span><span class="p">,</span> <span class="k">user</span><span class="p">,</span> <span class="n">tier</span><span class="p">,</span> <span class="n">userEmail</span><span class="p">,</span> <span class="k">count</span><span class="p">()</span> <span class="k">as</span> <span class="n">totalRequestCount</span> 
       <span class="k">group</span> <span class="k">by</span> <span class="n">apiName</span><span class="p">,</span> <span class="k">version</span><span class="p">,</span> <span class="k">user</span> 
       <span class="k">having</span> <span class="n">totalRequestCount</span> <span class="o">==</span> <span class="mi">100</span> <span class="k">or</span> <span class="n">totalRequestCount</span> <span class="o">==</span> <span class="mi">0</span> 
<span class="k">insert</span> <span class="k">all</span> <span class="n">events</span> <span class="k">into</span> <span class="n">ThrottledStream</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Query to add a flag for throttled request&#39;</span><span class="p">)</span>
<span class="k">from</span> <span class="n">ThrottledStream</span> 
<span class="k">select</span> <span class="n">apiName</span><span class="p">,</span> <span class="k">version</span><span class="p">,</span> <span class="k">user</span><span class="p">,</span> <span class="n">tier</span><span class="p">,</span> <span class="n">userEmail</span><span class="p">,</span> <span class="n">ifThenElse</span><span class="p">(</span><span class="n">totalRequestCount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span> <span class="k">as</span> <span class="n">isThrottled</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">ThrottleOutputStream</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Query to find frequently throttled users - who have throttled more than 10 times in the last hour&#39;</span><span class="p">)</span>
<span class="k">from</span> <span class="n">ThrottleOutputStream</span><span class="p">[</span><span class="n">isThrottled</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">time</span><span class="p">(</span><span class="mi">1</span> <span class="n">hour</span><span class="p">)</span> 
<span class="k">select</span> <span class="k">user</span><span class="p">,</span> <span class="n">apiName</span><span class="p">,</span> <span class="k">version</span><span class="p">,</span> <span class="n">tier</span><span class="p">,</span> <span class="n">userEmail</span><span class="p">,</span> <span class="k">count</span><span class="p">()</span> <span class="k">as</span> <span class="n">throttledCount</span> 
       <span class="k">group</span> <span class="k">by</span> <span class="k">user</span><span class="p">,</span> <span class="n">apiName</span><span class="p">,</span> <span class="k">version</span><span class="p">,</span> <span class="n">tier</span> 
       <span class="k">having</span> <span class="n">throttledCount</span> <span class="o">&gt;</span> <span class="mi">10</span> 
<span class="k">output</span> <span class="k">first</span> <span class="k">every</span> <span class="mi">15</span> <span class="k">min</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">UserNotificationStream</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Source view of the Siddhi app.
<img alt="source_view" src="../images/source-view.png" title="Source view of the Siddhi App" /></p>
<p>Below is the flow diagram of the above Siddhi App.</p>
<p><img alt="query_flow" src="../images/query-flow.png" title="Query flow diagram" /></p>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<p>NOTE: In the provided Siddhi app, there are some environmental variables (EMAIL_PASSWORD, EMAIL_USERNAME, and SENDER_EMAIL_ADDRESS) used which are required to be set to send an email alert based on the Siddhi queries defined. Again, there is a mock service configured to receive the throttle decisions, and its host is configured via LOGGER_SERVICE_HOST environment property. Hence, make sure to set the environmental variables with the proper values in the system</p>
<ul>
<li>EMAIL_USERNAME: Username of the email account which used to send email alerts. (eg: 'siddhi.gke.user')</li>
<li>EMAIL_PASSWORD: Password of the email account which used to send email alerts. (eg: 'siddhi123')</li>
<li>SENDER_EMAIL_ADDRESS: Email address of the account used to send email alerts. (eg: 'siddhi.gke.user@gmail.com')</li>
<li>LOGGER_SERVICE_HOST: IP address of the host where logger service is running. (eg: 'localhost')</li>
</ul>
<p>When you run the Siddhi app in the editor, you will see below logs getting printed in the editor console.</p>
<p><img alt="editor_app_run_mode" src="../images/editor-app-run-mode.png" title="Siddhi App Run mode" /></p>
<ul>
<li>You could simply simulate some events directly into the stream and test your Siddhi app in the editor itself. </li>
<li>Then, you can also simulate some events through HTTP to test the application. The following sections explain how you can test the Siddhi app via HTTP using cURL. </li>
</ul>
<h3 id="run-mock-logger-service">Run Mock Logger service<a class="headerlink" href="#run-mock-logger-service" title="Permanent link">&para;</a></h3>
<p>In the provided Siddhi app, there is an HTTP sink configured to push output events to an HTTP endpoint of the API Manager. For simplicity, you will be mocking this service. Please download the mock server <a href="https://github.com/mohanvive/siddhi-mock-services/releases/download/v1.0.0/logservice-1.0.0.jar">jar</a> and run that mock service by executing the following command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>java -jar logservice-1.0.0.jar
</pre></div>
</td></tr></table>

<h3 id="invoking-the-siddhi-app">Invoking the Siddhi App<a class="headerlink" href="#invoking-the-siddhi-app" title="Permanent link">&para;</a></h3>
<p>As per the Siddhi app that you wrote in the 'Implementation' section, there is an HTTP service running in Siddhi which is listening for events related to API requests. The respective service can be accessed via the URL  <code>http://localhost:9090/ThotttleService</code>. </p>
<p>As per the app, the API request will get throttled if there are more than 10 requests by the same user, to the same API (for 'silver’ tier).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>curl -v -X POST -d &#39;{ &quot;event&quot;: { &quot;apiName&quot;: &quot;order-mgt-v1&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;tier&quot;:&quot;silver&quot;,&quot;user&quot;:&quot;mohan&quot;, &quot;userEmail&quot;:&quot;example@wso2.com&quot;}}&#39; &quot;http://localhost:8006/apiRequest&quot; -H &quot;Content-Type:application/json&quot;
</pre></div>
</td></tr></table>

<p>If you invoke the above cURL request for more than 10 times within a minute, then Siddhi starts throttling the request, and sends an alert to the API Manager (logservice), while logging the alert as below.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>INFO {io.siddhi.core.stream.output.sink.LogSink} - API-Request-Throttler :
ThrottleOutputStream : Event{timestamp=1564056341280, data=[order-mgt-v1, 1.0.0,
mohan, silver, true], isExpired=false}
</pre></div>
</td></tr></table>

<p>You can validate that the alert has reached the API Manager (logservice) from its console logs.</p>
<p><img alt="simulation_mock_service_output" src="../images/simulation-mock-service-output.png" title="Simulation output @ mock service" /></p>
<p>If a user gets throttled more than 10 times within an hour then Siddhi sends an email to the respective user. </p>
<p>Note: The configurations provided in the email sink along with the environment properties will work for Gmail, but if you use other mail servers, please make sure to change the config values accordingly.</p>
<p><img alt="simulation_email_output" src="../images/simulation-email-output.png" title="Generated email for th simulation" /></p>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h2>
<p>Once you are done with the development, export the Siddhi app that you have developed with 'File' -&gt; 'Export File' option.</p>
<p>You can deploy the Siddhi app using any of the methods listed below. </p>
<h3 id="deploy-on-vm-bare-metal">Deploy on VM/ Bare Metal<a class="headerlink" href="#deploy-on-vm-bare-metal" title="Permanent link">&para;</a></h3>
<ol>
<li>Download the latest Siddhi Runner <a href="https://github.com/siddhi-io/distribution/releases/download/v5.1.0-alpha/siddhi-runner-5.1.0-alpha.zip">distribution</a>.</li>
<li>Unzip the <code>siddhi-runner-x.x.x.zip</code>.</li>
<li>Configure the necessary environmental variables</li>
</ol>
<p>In the above provided Siddhi app, there are some environmental variables (EMAIL_USERNAME, EMAIL_PASSWORD, and SENDER_EMAIL_ADDRESS) which are required to be set to send email alerts based on the Siddhi queries defined. Again, there is a mock service configured to receive the throttle decisions (instructions given below), and its host is configured via LOGGER_SERVICE_HOST environment property. 
    Hence, make sure to set the environmental variables with the proper values in the system (make sure to follow necessary steps based on the underneath operating system).  </p>
<ol>
<li>
<p>Start Siddhi app with the runner config by executing the following commands from the distribution directory.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Linux/Mac : ./bin/runner.sh -Dapps=&lt;siddhi-file-path&gt; 
Windows : bin\runner.bat -Dapps=&lt;siddhi-file-path&gt;

   Eg: If exported siddhi app in Siddhi home directory,
       ./bin/runner.sh -Dapps=API-Request-Throttler.siddhi
</pre></div>
</td></tr></table>

</li>
<li>
<p>Download the mock <a href="https://github.com/mohanvive/siddhi-mock-services/releases/download/v1.0.0/logservice-1.0.0.jar">logging service</a> which is used to demonstrate the capability of Siddhi HTTP sink. Execute the below command to run the mock server.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>java -jar logservice-1.0.0.jar
</pre></div>
</td></tr></table>

</li>
<li>
<p>Invoke the apiRequest service with the following cURL request for more than 10 times within a minute time period. Please make sure to change the <code>userEmail</code> property value to an email address that you could use to test the email alerting purposes.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>curl -v -X POST -d &#39;{ &quot;event&quot;: { &quot;apiName&quot;: &quot;order-mgt-v1&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;tier&quot;: &quot;silver&quot;, &quot;user&quot;:&quot;mohan&quot;, &quot;userEmail&quot;:&quot;example@wso2.com&quot;}}&#39; &quot;http://localhost:8006/apiRequest&quot; -H &quot;Content-Type:application/json&quot;
</pre></div>
</td></tr></table>

</li>
<li>
<p>You can see the output log in the console. Here, you will be able to see the alert log printed as shown below.</p>
<p><img alt="console_output_vm" src="../images/console-output-vm.png" title="Console output" /></p>
</li>
<li>
<p>At the same time, you could also see the events received to HTTP mock service endpoint (started in step #5) via its log as below.</p>
<p><img alt="mock_service_output_vm" src="../images/mock-service-output-vm.png" title="Mock service output" /></p>
</li>
</ol>
<h3 id="deploy-on-docker">Deploy on Docker<a class="headerlink" href="#deploy-on-docker" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create a folder locally on your host machine (eg: <code>/home/siddhi-apps</code>) and copy the Siddhi app into it.</p>
</li>
<li>
<p>Pull the latest Siddhi Runner image from [Siddhiio Docker Hub] (https://hub.docker.com/u/siddhiio).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker pull siddhiio/siddhi-runner-alpine:5.1.0-alpha
</pre></div>
</td></tr></table>

</li>
<li>
<p>Start SiddhiApp by executing the following docker command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker run -it -p 8006:8006 -v /home/siddhi-apps:/apps -e EMAIL_PASSWORD=siddhi123 -e EMAIL_USERNAME=siddhi.gke.user -e SENDER_EMAIL_ADDRESS=siddhi.gke.user@gmail.com -e LOGGER_SERVICE_HOST=10.100.0.99 siddhiio/siddhi-runner-alpine:5.1.0-alpha -Dapps=/apps/API-Request-Throttler.siddhi
</pre></div>
</td></tr></table>

<p>NOTE: In the above provided Siddhi app, there are some environmental variables (EMAIL_PASSWORD, EMAIL_USERNAME, and SENDER_EMAIL_ADDRESS) which are required to be set to send email alerts based on the Siddhi queries defined. Again, there is a mock service configured to receive the throttle decisions (instructions given below), and its host is configured via LOGGER_SERVICE_HOST environment property. 
Hence, make sure to add proper values for the environmental variables in the above command.</p>
</li>
<li>
<p>Download the mock <a href="https://github.com/mohanvive/siddhi-mock-services/releases/download/v1.0.0/logservice-1.0.0.jar">logging service</a> which is used to demonstrate the capability of Siddhi HTTP sink. Execute the below command to run the mock server.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    java -jar logservice-1.0.0.jar
</pre></div>
</td></tr></table>

</li>
<li>
<p>Invoke the apiRequest service with the following cURL request for more than 10 times within a minute time period. Please make sure to change the <code>userEmail</code> property value to an email address that you could use to test the email alerting purposes.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    curl -v -X POST -d &#39;{ &quot;event&quot;: { &quot;apiName&quot;: &quot;order-mgt-v1&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;tier&quot;: &quot;silver&quot;, &quot;user&quot;:&quot;mohan&quot;, &quot;userEmail&quot;:&quot;example@wso2.com&quot;}}&#39; &quot;http://localhost:8006/apiRequest&quot; -H &quot;Content-Type:application/json&quot;
</pre></div>
</td></tr></table>

</li>
<li>
<p>Since you have started the docker in interactive mode you can see the output in its console as below. 
(If it is not started in the interactive mode then you can run <code>docker exec -it  &lt;docker-container-id&gt; sh</code> command, go into the container and check the log file in <code>home/siddhi_user/siddhi-runner/wso2/runner/logs/carbon.log</code> file)</p>
<p><img alt="console_output_docker" src="../images/console-output-docker.png" title="Console output" /></p>
</li>
<li>
<p>At the same time, you could also see the events received to HTTP mock service endpoint (started in step #4) via its log as below.</p>
<p><img alt="mock_service_output_docker" src="../images/mock-service-output-docker.png" title="Mock service output" /></p>
</li>
<li>
<p>If there are more than 10 requests get throttled within 1 hour then the API invoker will receive an email (as shown in the 'Testing' section).</p>
</li>
</ol>
<h3 id="deploy-on-kubernetes">Deploy on Kubernetes<a class="headerlink" href="#deploy-on-kubernetes" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Install Siddhi Operator</p>
<ul>
<li>
<p>To install the Siddhi Kubernetes operator run the following commands.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl apply -f https://github.com/siddhi-io/siddhi-operator/releases/download/v0.2.0-alpha/00-prereqs.yaml
kubectl apply -f https://github.com/siddhi-io/siddhi-operator/releases/download/v0.2.0-alpha/01-siddhi-operator.yaml
</pre></div>
</td></tr></table>

</li>
<li>
<p>You can verify the installation by making sure the following deployments are running in your Kubernetes cluster.</p>
<p><img alt="kubernetes_siddhi-deployments" src="../images/kubernetes-siddhi-deployments.png" title="K8S Siddhi deployments" /></p>
</li>
</ul>
</li>
<li>
<p>Download the mock <a href="https://github.com/mohanvive/siddhi-mock-services/releases/download/v1.0.0/logservice-1.0.0.jar">logging service</a> 
which is used to demonstrate the capability of Siddhi HTTP sink. Execute the below command to run the mock server.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    java -jar logservice-1.0.0.jar
</pre></div>
</td></tr></table>

</li>
<li>
<p>Siddhi applications can be deployed on Kubernetes using the Siddhi operator.</p>
<ul>
<li>
<p>Before deploying the apps you have to define an <a href="https://kubernetes.github.io/ingress-nginx/deploy/#provider-specific-steps">Ingress</a>, this is because there is an HTTP endpoint in the Siddhi app you have written and you will be sending events to that.</p>
</li>
<li>
<p>To deploy the above created Siddhi app, you have to create a custom resource object YAML file (with the kind as SiddhiProcess) as following</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">siddhi.io/v1alpha2</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SiddhiProcess</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">api-throttler-app</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">apps</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">script</span><span class="p">:</span> <span class="p p-Indicator">|</span>
        <span class="no">@App:name(&#39;API-Request-Throttler&#39;)</span>
        <span class="no">@App:description(&#39;Enforcesthrottling to API requests &#39;)</span>

        <span class="no">-- HTTP endpoint which listens for api request related events</span>
        <span class="no">@source(type = &#39;http&#39;, receiver.url = &quot;http://0.0.0.0:8006/apiRequest&quot;, basic.auth.enabled = &quot;false&quot;, </span>
            <span class="no">@map(type = &#39;json&#39;))</span>
        <span class="no">define stream APIRequestStream (apiName string, version string, tier string, user string, userEmail string);</span>

        <span class="no">-- HTTP sink to publich throttle decisions. For testing purpose, there is a mock logger service provided </span>
        <span class="no">@sink(type = &#39;http&#39;, publisher.url = &quot;http://${LOGGER_SERVICE_HOST}:8080/logger&quot;, method = &quot;POST&quot;, </span>
            <span class="no">@map(type = &#39;json&#39;))</span>
        <span class="no">@sink(type = &#39;log&#39;, @map(type = &#39;text&#39;))</span>
        <span class="no">define stream ThrottleOutputStream (apiName string, version string, user string, tier string, userEmail string, isThrottled bool);</span>

        <span class="no">-- Email sink to send alerts</span>
        <span class="no">@sink(type = &#39;log&#39;, @map(type = &#39;text&#39;))</span>
        <span class="no">@sink(type = &#39;email&#39;, username = &quot;${EMAIL_USERNAME}&quot;, address = &quot;${SENDER_EMAIL_ADDRESS}&quot;, password = &quot;${EMAIL_PASSWORD}&quot;, </span>
        <span class="no">subject = &quot;Upgrade API Subscription Tier&quot;, to = &quot;{{userEmail}}&quot;, host = &quot;smtp.gmail.com&quot;, port = &quot;465&quot;, ssl.enable = &quot;true&quot;, auth = &quot;true&quot;, </span>
            <span class="no">@map(type = &#39;text&#39;, </span>
                <span class="no">@payload(&quot;&quot;&quot;</span>
                    <span class="no">Hi {{user}}</span>

                    <span class="no">You have subscribed to API called {{apiName}}:{{version}} with {{tier}} tier.</span>
                    <span class="no">Based on our records, it seems you are hitting the upper limit of the API requests in a frequent manner. </span>

                    <span class="no">We kindly request you to consider upgrading to next API subscription tier to avoid this in the future. </span>

                    <span class="no">Thanks, </span>
                    <span class="no">API Team&quot;&quot;&quot;)))</span>
        <span class="no">define stream UserNotificationStream (user string, apiName string, version string, tier string, userEmail string, throttledCount long);</span>

        <span class="no">@info(name = &#39;Query to find users who needs to be throttled based on tier `silver`&#39;)</span>
        <span class="no">from APIRequestStream[tier == &quot;silver&quot;]#window.timeBatch(1 min, 0, true) </span>
        <span class="no">select apiName, version, user, tier, userEmail, count() as totalRequestCount </span>
            <span class="no">group by apiName, version, user </span>
            <span class="no">having totalRequestCount == 10 or totalRequestCount == 0 </span>
        <span class="no">insert all events into ThrottledStream;</span>

        <span class="no">@info(name = &#39;Query to find users who needs to be throttled based on tier `gold`&#39;)</span>
        <span class="no">from APIRequestStream[tier == &quot;gold&quot;]#window.timeBatch(1 min, 0, true) </span>
        <span class="no">select apiName, version, user, tier, userEmail, count() as totalRequestCount </span>
            <span class="no">group by apiName, version, user </span>
            <span class="no">having totalRequestCount == 100 or totalRequestCount == 0 </span>
        <span class="no">insert all events into ThrottledStream;</span>

        <span class="no">@info(name = &#39;Query to add a flag for throttled request&#39;)</span>
        <span class="no">from ThrottledStream </span>
        <span class="no">select apiName, version, user, tier, userEmail, ifThenElse(totalRequestCount == 0, false, true) as isThrottled </span>
        <span class="no">insert into ThrottleOutputStream;</span>

        <span class="no">@info(name = &#39;Query to find frequently throttled users - who have throttled more than 10 times in the last hour&#39;)</span>
        <span class="no">from ThrottleOutputStream[isThrottled]#window.time(1 hour) </span>
        <span class="no">select user, apiName, version, tier, userEmail, count() as throttledCount </span>
            <span class="no">group by user, apiName, version, tier </span>
            <span class="no">having throttledCount &gt; 10 </span>
        <span class="no">output first every 15 min </span>
        <span class="no">insert into UserNotificationStream;</span>

  <span class="nt">container</span><span class="p">:</span>
    <span class="nt">env</span><span class="p">:</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL_PASSWORD</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;siddhi123&quot;</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL_USERNAME</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;siddhi.gke.user&quot;</span>
      <span class="p p-Indicator">-</span> 
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SENDER_EMAIL_ADDRESS</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;siddhi.gke.user@gmail.com&quot;</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LOGGER_SERVICE_HOST</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;10.100.0.99&quot;</span>

    <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;siddhiio/siddhi-runner-ubuntu:5.1.0-alpha&quot;</span>
</pre></div>
</td></tr></table>

<p>NOTE: In the above provided Siddhi app, there are some environmental variables (EMAIL_PASSWORD, EMAIL_USERNAME, and SENDER_EMAIL_ADDRESS) which are required to be set to send email alerts based on the Siddhi queries defined. Again, there is a mock service configured to receive the throttle decisions (instructions given below), and its host is configured via LOGGER_SERVICE_HOST environment property. 
Hence, make sure to add proper values for the environmental variables in the above YAML file (check the <code>env</code> section of the YAML file).</p>
</li>
<li>
<p>Now, let’s create the above resource in the Kubernetes cluster with the following command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span> kubectl create -f &lt;absolute-yaml-file-path&gt;/API-Request-Throttler.yaml
</pre></div>
</td></tr></table>

</li>
<li>
<p>Once, Siddhi app is successfully deployed. You can verify its health using the following commands</p>
<p><img alt="kubernetes_output" src="../images/kubernetes-output.png" title="Kubectl console outputs" /></p>
</li>
<li>
<p>Then, add the host <code>siddhi</code> and related external IP (ADDRESS) to the <code>/etc/hosts</code> file in your machine. For Docker for Mac , external IP is <code>0.0.0.0</code>. For Minikube, you have to use Minikube IP as the external IP. Hence, run minikube ip command to get the IP of the Minikube cluster.</p>
</li>
<li>
<p>You can find the alert logs in the Siddhi runner log file. To see the Siddhi runner log file, first, invoke below command to get the pods.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl get pods
</pre></div>
</td></tr></table>

<p>Then, find the pod name of the Siddhi app deployed, and invoke below command to view the logs.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl logs &lt;siddhi-app-pod-name&gt; -f
</pre></div>
</td></tr></table>

<p>Eg: as shown below image,</p>
<p><img alt="kubernetes_get_pods" src="../images/kubernetes-get-pods.png" title="Kubectl get pods command output" /></p>
</li>
<li>
<p>Invoke the apiRequest service with below cURL request for more than 10 times within a minute. Please make sure to change the <code>userEmail</code> property value to an email address that you could use to test the email alerting purposes.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>curl -v -X POST -d &#39;{ &quot;event&quot;: { &quot;apiName&quot;: &quot;order-mgt-v1&quot;, &quot;version&quot;: &quot;1.0.0&quot;, &quot;tier&quot;: &quot;silver&quot;, &quot;user&quot;:&quot;mohan&quot;, &quot;userEmail&quot;:&quot;example@wso2.com&quot;}}&#39; &quot;http://siddhi/api-throttler-app-0/8006/apiRequest&quot; -H &quot;Content-Type:application/json&quot;
</pre></div>
</td></tr></table>

</li>
<li>
<p>Then, you will be able to see the throttle decisions as console logs (as given below).</p>
<p><img alt="console_output_kubernetes" src="../images/console-output-kubernetes.png" title="Console output" /></p>
</li>
<li>
<p>At the same time, you could also see the events received to HTTP mock service endpoint (started in step #2) via its log as below.</p>
<p><img alt="mock_service_output_kubernetes" src="../images/mock-service-output-kubernetes.png" title="Mock service output" /></p>
</li>
<li>
<p>If there are more than 10 requests get throttled within 1 hour then the API invoker will receive an email (as shown in the 'Testing' section).</p>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Refer <a href="https://siddhi.io/en/v5.1/docs/siddhi-as-a-kubernetes-microservice/">here</a> to get more details about running Siddhi on Kubernetes.</p>
</div>
</li>
</ol>
                
                  
                
              
  <a href="#" class="cd-top text--replace js-cd-top">Top</a>

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../overview/" title="Overview" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Overview
              </span>
            </div>
          </a>
        
        
          <a href="../../fault-tolerance/guide/" title="Fault Tolerance & Error Handling" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Fault Tolerance & Error Handling
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Siddhi - Documentation
          </div>
        
        &copy;2019 <a href="https://wso2.com/">WSO2</a>
      </div>
      
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
    
      <a href="/community/#community-collaboration" class="md-footer-social__link fa fa-slack"></a>
    
      <a href="https://github.com/siddhi-io/siddhi" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://medium.com/siddhi-io" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://twitter.com/siddhi_io" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.youtube.com/channel/UCZT5sE-0g22GuvWQu7ezVqg" class="md-footer-social__link fa fa-youtube"></a>
    
      <a href="https://www.linkedin.com/groups/13553064" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
        <script src="../../../../assets/lib/highlightjs/highlight.min.js"></script>
      
        <script src="../../../../assets/js/theme.js"></script>
      
        <script src="../../../../assets/lib/backtotop/js/util.js"></script>
      
        <script src="../../../../assets/lib/backtotop/js/main.js"></script>
      
    
  </body>
</html>