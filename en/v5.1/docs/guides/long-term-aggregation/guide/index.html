<!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->





<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cloud Native Stream Processor">
      
      
        <link rel="canonical" href="http://siddhi.io/en/v5.1/docs/guides/long-term-aggregation/guide/">
      
      
        <meta name="author" content="WSO2">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Long-running time based Aggregations - Siddhi</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../../assets/lib/highlightjs/default.min.css">
    
      <link rel="stylesheet" href="../../../../assets/css/theme.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-103065-28", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#long-running-time-based-aggregations" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->

<header class="md-header" data-md-component="header" id="page-header" data-url=""
        data-lang="en">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://siddhi.io/en/v5.1/" title="Siddhi"
           class="md-header-nav__button md-logo">
          
            <img src="../../../../images/siddhi-logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Siddhi
            </span>
            <span class="md-header-nav__topic">
              Long-running time based Aggregations
            </span>
          
        </div>
        <div class="md-flex__ellipsis md-header__version-select">
            <div class="mb-tabs__dropdown version-select">
                <a class="md-tabs__link md-tabs__dropdown-link" href="#!" data-target="version-select-dropdown">
                  v5.1</a>
                <ul id="version-select-dropdown" class="mb-tabs__dropdown-content" tabindex="0">
                    <!-- Versions will added here dynamically -->
                    <li class="md-tabs__item mb-tabs__dropdown">
                        <a href="#" id="show-all-versions-link">Show all</a>
                    </li>
                </ul>
            </div>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
        </div>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
        <li class="md-tabs__item home_icon">
            <a href="/" title="Siddhi Home" class="md-tabs__link md-tabs__link--active">
                <i class="fa fa-home"></i>
            </a>
        </li>
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../download/" title="Download" class="md-tabs__link">
          Download
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../quick-start/" title="Quick Start" class="md-tabs__link">
          Quick Start
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../" title="Documentation" class="md-tabs__link md-tabs__link--active">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/community/" title="Community" class="md-tabs__link">
          Community
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../development/" title="Development" class="md-tabs__link">
          Development
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/license/" title="License" class="md-tabs__link">
          License
        </a>
      
    </li>
  

      
    </ul>
    <div class="quick_links">
        
        <a href="https://github.com/siddhi-io/www/edit/v5.1/en/docs/docs/guides/long-term-aggregation/guide.md" target="blank" id="editIcon" title="Edit this page"
           title="Edit this page" class="md-icon md-content__icon nav_link edit_link"></a>
        
    </div>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
    <label class="md-nav__title md-nav__title--site" for="__drawer">
      <a href="http://siddhi.io/en/v5.1/" title="Siddhi"
         class="md-nav__button md-logo">
        
          <img src="../../../../images/siddhi-logo.svg" width="48" height="48">
        
      </a>
      Siddhi
    </label>
    
      <div class="md-nav__source">
        


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
      </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Download
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Download
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Quick Start
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Quick Start
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4" checked>
    
    <label class="md-nav__link" for="nav-3-4">
      Use case Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Use case Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../alerts-for-thresholds/guide/" title="Alerts Based on Thresholds" class="md-nav__link">
      Alerts Based on Thresholds
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fault-tolerance/guide/" title="Fault Tolerance & Error Handling" class="md-nav__link">
      Fault Tolerance & Error Handling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns-and-trends/guide/" title="Patterns & Trends Over Time" class="md-nav__link">
      Patterns & Trends Over Time
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database-static-rule-processing/guide/" title="Static Rule Processing using Database Rules" class="md-nav__link">
      Static Rule Processing using Database Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrate-various-enterprise-systems/guide/" title="Integrate Various Enterprise Systems" class="md-nav__link">
      Integrate Various Enterprise Systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime-movie-recommendation/guide/" title="Realtime predictions with pre-trained ML models" class="md-nav__link">
      Realtime predictions with pre-trained ML models
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Long-running time based Aggregations
      </label>
    
    <a href="./" title="Long-running time based Aggregations" class="md-nav__link md-nav__link--active">
      Long-running time based Aggregations
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scenario-generating-alerts-based-on-long-running-summarization" title="Scenario - Generating alerts based on long-running summarization" class="md-nav__link">
    Scenario - Generating alerts based on long-running summarization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" title="What you'll build" class="md-nav__link">
    What you'll build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-requirements" title="Mandatory Requirements" class="md-nav__link">
    Mandatory Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Requirements needed to deploy Siddhi in Docker/Kubernetes" class="md-nav__link">
    Requirements needed to deploy Siddhi in Docker/Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implement-streaming-queries" title="Implement Streaming Queries" class="md-nav__link">
    Implement Streaming Queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-mysql" title="Setup MySQL" class="md-nav__link">
    Setup MySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tryout" title="Tryout" class="md-nav__link">
    Tryout
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-mock-data-generator" title="Run Mock Data Generator" class="md-nav__link">
    Run Mock Data Generator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-the-siddhi-app" title="Invoking the Siddhi App" class="md-nav__link">
    Invoking the Siddhi App
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-on-vm-bare-metal" title="Deploy on VM/ Bare Metal" class="md-nav__link">
    Deploy on VM/ Bare Metal
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-runner-configuration" title="Siddhi Runner Configuration" class="md-nav__link">
    Siddhi Runner Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-docker" title="Deploy on Docker" class="md-nav__link">
    Deploy on Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_2" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-docker-configuration" title="Siddhi Docker Configuration" class="md-nav__link">
    Siddhi Docker Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-kubernetes" title="Deploy on Kubernetes" class="md-nav__link">
    Deploy on Kubernetes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_3" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-kubernetes-configuration" title="Siddhi Kubernetes configuration" class="md-nav__link">
    Siddhi Kubernetes configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tooling/" title="Tooling" class="md-nav__link">
      Tooling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../query-guide/" title="Query Guide" class="md-nav__link">
      Query Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Siddhi APIs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Siddhi APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/latest/" title="latest" class="md-nav__link">
      latest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/5.1.0/" title="5.1.0" class="md-nav__link">
      5.1.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">
    
    <label class="md-nav__link" for="nav-3-8">
      REST API Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        REST API Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/siddhi-app-api/" title="Siddhi App APIs" class="md-nav__link">
      Siddhi App APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/on-demand-query-api/" title="On-Demand Query APIs" class="md-nav__link">
      On-Demand Query APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/health-check-api/" title="Health Check APIs" class="md-nav__link">
      Health Check APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/store-api/" title="Store APIs (Deprecated)" class="md-nav__link">
      Store APIs (Deprecated)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/default-ports/" title="Default Ports" class="md-nav__link">
      Default Ports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/http-status-code/" title="HTTP Status Codes" class="md-nav__link">
      HTTP Status Codes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-java-library/" title="Siddhi Java Library" class="md-nav__link">
      Siddhi Java Library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-local-microservice/" title="Siddhi Local Microservice" class="md-nav__link">
      Siddhi Local Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-docker-microservice/" title="Siddhi Docker Microservice" class="md-nav__link">
      Siddhi Docker Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-kubernetes-microservice/" title="Siddhi Kubernetes Microservice" class="md-nav__link">
      Siddhi Kubernetes Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-python-library/" title="Siddhi Python Library" class="md-nav__link">
      Siddhi Python Library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../config-guide/" title="Configuration Guide" class="md-nav__link">
      Configuration Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Community
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Community
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/source/" title="Source" class="md-nav__link">
      Source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/build/" title="Build" class="md-nav__link">
      Build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      License
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        License
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
    </ul>
  </nav>  
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scenario-generating-alerts-based-on-long-running-summarization" title="Scenario - Generating alerts based on long-running summarization" class="md-nav__link">
    Scenario - Generating alerts based on long-running summarization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" title="What you'll build" class="md-nav__link">
    What you'll build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-requirements" title="Mandatory Requirements" class="md-nav__link">
    Mandatory Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Requirements needed to deploy Siddhi in Docker/Kubernetes" class="md-nav__link">
    Requirements needed to deploy Siddhi in Docker/Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implement-streaming-queries" title="Implement Streaming Queries" class="md-nav__link">
    Implement Streaming Queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-mysql" title="Setup MySQL" class="md-nav__link">
    Setup MySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tryout" title="Tryout" class="md-nav__link">
    Tryout
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-mock-data-generator" title="Run Mock Data Generator" class="md-nav__link">
    Run Mock Data Generator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-the-siddhi-app" title="Invoking the Siddhi App" class="md-nav__link">
    Invoking the Siddhi App
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-on-vm-bare-metal" title="Deploy on VM/ Bare Metal" class="md-nav__link">
    Deploy on VM/ Bare Metal
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-runner-configuration" title="Siddhi Runner Configuration" class="md-nav__link">
    Siddhi Runner Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-docker" title="Deploy on Docker" class="md-nav__link">
    Deploy on Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_2" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-docker-configuration" title="Siddhi Docker Configuration" class="md-nav__link">
    Siddhi Docker Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-kubernetes" title="Deploy on Kubernetes" class="md-nav__link">
    Deploy on Kubernetes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_3" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-kubernetes-configuration" title="Siddhi Kubernetes configuration" class="md-nav__link">
    Siddhi Kubernetes configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
  
                
                  <a href="https://github.com/siddhi-io/www/edit/v5.1/en/docs/docs/guides/long-term-aggregation/guide.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="long-running-time-based-aggregations">Long-running time based Aggregations<a class="headerlink" href="#long-running-time-based-aggregations" title="Permanent link">&para;</a></h1>
<p>In this guide, you will understand one of the common requirements of Analytics which is aggregating data.</p>
<h2 id="scenario-generating-alerts-based-on-long-running-summarization">Scenario - Generating alerts based on long-running summarization<a class="headerlink" href="#scenario-generating-alerts-based-on-long-running-summarization" title="Permanent link">&para;</a></h2>
<p>Aggregation is a mandatory need in any system as it allows users to spot trends and anomalies easily  which can lead to actions that will benefit an organization or the business. Aggregated data can also be processed easily to get the information needed for a business requirement decision.</p>
<p>The following sections are available in this guide.</p>
<ul>
<li><a href="#what-you'll-build">What you'll build</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#deployment">Deployment &amp; Output</a></li>
</ul>
<h2 id="what-youll-build">What you'll build<a class="headerlink" href="#what-youll-build" title="Permanent link">&para;</a></h2>
<p>Let's consider a real world use case to implement the aggregation requirement. This will help you to understand Siddhi Stream Processing construct, Named Aggregations. Let’s jump into the use case directly.</p>
<p>Let's assume you are a data analyst in the 'X' online shopping mall. 'X' shopping mall daily offers deals to customers to boost their sales. Each day past sales is analysed such that recommendation can be given on what items to be put up for Daily deals and more importantly out of all sellers, whose items to be used in Daily Deals.</p>
<p>Let's take a simple logic to select Daily Deals, you will analyse the last 10 days of sales and get the products which has a lower amount of sales, lets say 100 units. For these products we will select sellers who has the highest sales in the past month and generate an email with top 5 candidates whose products can be offered in the Daily Deal.</p>
<p>Now, let’s understand how this could be implemented in Siddhi engine. For the aggregation use case we will be using a specific function of Siddhi engine, called Named Aggregations.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>Below are the prerequisites that should be considered to implement the above use case.</p>
<h3 id="mandatory-requirements">Mandatory Requirements<a class="headerlink" href="#mandatory-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://siddhi.io/en/v5.1/download/">Siddhi tooling VM/Local distribution</a></li>
<li>One of the <a href="https://siddhi.io/en/v5.1/download/">Siddhi runner distributions</a></li>
<li>VM/Local Runtime</li>
<li>Docker Image</li>
<li>K8S Operator (commands are given in deployment section)</li>
<li>Java 8 or higher</li>
</ul>
<h3 id="requirements-needed-to-deploy-siddhi-in-dockerkubernetes">Requirements needed to deploy Siddhi in Docker/Kubernetes<a class="headerlink" href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.docker.com/engine/installation/">Docker</a></li>
<li><a href="https://github.com/kubernetes/minikube#installation">Minikube</a> or <a href="https://console.cloud.google.com/">Google Kubernetes Engine(GKE) Cluster</a> or <a href="https://docs.docker.com/docker-for-mac/install/">Docker for Mac</a></li>
</ul>
<h2 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h2>
<p>When a user checkouts out a sales cart in 'X' online shopping malls website, the website will send the information to Siddhi runtime through HTTP transport.</p>
<ul>
<li>
<p>Siddhi runtime will aggregate the sales data in multiple granularities from seconds to years, grouped by category, product code and seller.</p>
</li>
<li>
<p>Daily at 11.50 pm an alert will be generated to include, Daily Deals product and seller recommendations.</p>
</li>
</ul>
<h3 id="implement-streaming-queries">Implement Streaming Queries<a class="headerlink" href="#implement-streaming-queries" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Start the Siddhi <a href="https://siddhi.io/en/v5.0/docs/tooling/">tooling</a> runtime and go to the editor UI in <a href="http://localhost:9390/editor">http://localhost:9390/editor</a></p>
<p>Follow below steps to start the Siddhi tooling runtime,
* Extract the downloaded zip and navigate to <TOOLING_HOME>/bin. (TOOLING_HOME refers to the extracted folder)
* Issue the following command in the command prompt (Windows) / terminal (Linux/Mac)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>For Windows: tooling.bat
For Linux/Mac: ./tooling.sh
</pre></div>
</td></tr></table>

</li>
<li>
<p>Select File -&gt; New option, then you could either use the source view or design view to write/build the Siddhi Application. You can find the Siddhi Applications below, that implements the requirements mentioned above.</p>
</li>
<li>
<p>Let’s write (develop) the Siddhi Applications, as given below.</p>
</li>
<li>
<p>Once the Siddhi apps are created, you can use the Event Simulator option in the editor to simulate events to streams and perform developer testing.</p>
</li>
</ol>
<p>Siddhi App 1 : Responsible for Aggregating Data</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">name</span><span class="p">(</span><span class="ss">&quot;SalesSummarization&quot;</span><span class="p">)</span>

<span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">description</span><span class="p">(</span><span class="s1">&#39;X online shopping mall - Summarization for sales by category, product and seller&#39;</span><span class="p">)</span>

<span class="o">@</span><span class="k">Source</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">receiver</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://0.0.0.0:8080/sales&#39;</span><span class="p">,</span> <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">SalesStream</span><span class="p">(</span><span class="k">timestamp</span> <span class="n">long</span><span class="p">,</span> <span class="n">categoryName</span> <span class="n">string</span><span class="p">,</span> <span class="n">productName</span> <span class="n">string</span><span class="p">,</span> <span class="n">sellerName</span> <span class="n">string</span><span class="p">,</span> <span class="n">quantity</span> <span class="nb">int</span><span class="p">);</span>

<span class="c1">--Long term Summarization</span>
<span class="o">@</span><span class="n">store</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;rdbms&#39;</span> <span class="p">,</span> 
    <span class="n">jdbc</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;${MYSQL_URL}&#39;</span><span class="p">,</span> 
    <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;${MYSQL_USERNAME}&#39;</span><span class="p">,</span> 
    <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;${MYSQL_PASSWORD}&#39;</span><span class="p">,</span> 
    <span class="n">jdbc</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;com.mysql.jdbc.Driver&#39;</span><span class="p">,</span> 
    <span class="n">pool</span><span class="p">.</span><span class="n">properties</span> <span class="o">=</span> <span class="ss">&quot;maximumPoolSize:1&quot;</span><span class="p">)</span> 
<span class="o">@</span><span class="n">purge</span><span class="p">(</span><span class="n">enable</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span> 
<span class="n">define</span> <span class="n">aggregation</span> <span class="n">SalesAggregation</span> 
<span class="k">from</span> <span class="n">SalesStream</span> 
<span class="k">select</span> <span class="n">categoryName</span><span class="p">,</span> <span class="n">productName</span><span class="p">,</span> <span class="n">sellerName</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="k">as</span> <span class="n">totalSales</span> 
    <span class="k">group</span> <span class="k">by</span> <span class="n">categoryName</span><span class="p">,</span> <span class="n">productName</span><span class="p">,</span> <span class="n">sellerName</span> 
    <span class="k">aggregate</span> <span class="k">by</span> <span class="k">timestamp</span> <span class="k">every</span> <span class="n">sec</span><span class="p">...</span><span class="k">year</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Siddhi App 2: Responsible for Sending alerts</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">name</span><span class="p">(</span><span class="ss">&quot;DailyDealsCandidatesAlert&quot;</span><span class="p">)</span>

<span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">description</span><span class="p">(</span><span class="ss">&quot;Alerts regarding daily deals candidates - 1 product with max 5 sellers who sold the most in past 30 days&quot;</span><span class="p">)</span>

<span class="n">define</span> <span class="k">trigger</span> <span class="n">DailyTrigger</span> <span class="k">at</span> <span class="s1">&#39;0 00 23 ? * MON-FRI&#39;</span><span class="p">;</span>

<span class="o">@</span><span class="k">Source</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">receiver</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://0.0.0.0:8080/dailyDealsAlert&#39;</span><span class="p">,</span> <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">DailyDealsTriggerStream</span><span class="p">(</span><span class="n">emailToBeSent</span> <span class="n">bool</span><span class="p">);</span>

<span class="n">define</span> <span class="n">stream</span> <span class="n">SalesStream</span><span class="p">(</span><span class="k">timestamp</span> <span class="n">long</span><span class="p">,</span> <span class="n">categoryName</span> <span class="n">string</span><span class="p">,</span> <span class="n">productName</span> <span class="n">string</span><span class="p">,</span> <span class="n">sellerName</span> <span class="n">string</span><span class="p">,</span> <span class="n">quantity</span> <span class="nb">int</span><span class="p">);</span>

<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="ss">&quot;${SENDER_EMAIL_ADDRESS}&quot;</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="ss">&quot;${EMAIL_USERNAME}&quot;</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="ss">&quot;${EMAIL_PASSWORD}&quot;</span><span class="p">,</span> 
    <span class="n">subject</span> <span class="o">=</span> <span class="ss">&quot;{{emailSubject}}&quot;</span><span class="p">,</span> <span class="k">to</span> <span class="o">=</span> <span class="ss">&quot;${RECEIVER_EMAIL_ADDRESS}&quot;</span><span class="p">,</span> <span class="k">host</span> <span class="o">=</span> <span class="ss">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="ss">&quot;465&quot;</span><span class="p">,</span> <span class="n">content</span><span class="p">.</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span><span class="p">,</span> 
    <span class="n">ssl</span><span class="p">.</span><span class="n">enable</span> <span class="o">=</span> <span class="ss">&quot;true&quot;</span><span class="p">,</span> <span class="n">auth</span> <span class="o">=</span> <span class="ss">&quot;true&quot;</span><span class="p">,</span> 
    <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> 
        <span class="o">@</span><span class="n">payload</span><span class="p">(</span><span class="ss">&quot;&quot;&quot;</span>
<span class="ss">            Hi, &lt;br/&gt;&lt;br/&gt;</span>
<span class="ss">            Please find the seller candidates for Daily Deal {{dailyDealDate}} below, &lt;br/&gt;&lt;br/&gt;</span>
<span class="ss">            Product &lt;strong&gt;{{productName}}&lt;/strong&gt;-{{categoryName}} sold {{last10DaysSales}} units for the last 10 days&lt;br/&gt;&lt;br/&gt;</span>
<span class="ss">            &lt;table&gt;</span>
<span class="ss">            &lt;tr&gt;</span>
<span class="ss">            &lt;th&gt; Seller Name &lt;/th&gt;</span>
<span class="ss">            &lt;th&gt; Total Sales for the last Month &lt;/th&gt;</span>
<span class="ss">            &lt;/tr&gt;</span>
<span class="ss">            {{candidateInfo}}</span>
<span class="ss">            &lt;/table&gt;</span>
<span class="ss">            &lt;br/&gt;&lt;br/&gt;</span>
<span class="ss">            Thanks, &lt;br/&gt;</span>
<span class="ss">            Analytics Team&quot;&quot;&quot;</span><span class="p">)))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">EmailNotificationStream</span><span class="p">(</span><span class="n">dailyDealDate</span> <span class="n">string</span><span class="p">,</span> <span class="n">emailSubject</span> <span class="n">string</span><span class="p">,</span> <span class="n">productName</span> <span class="n">string</span><span class="p">,</span> <span class="n">categoryName</span> <span class="n">string</span><span class="p">,</span> <span class="n">last10DaysSales</span> <span class="n">long</span><span class="p">,</span> <span class="n">candidateInfo</span> <span class="n">string</span><span class="p">);</span>

<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> 
    <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">DailyDealsSellerCandidates</span> <span class="p">(</span><span class="n">emailToBeSent</span> <span class="n">bool</span><span class="p">,</span> <span class="n">categoryName</span> <span class="n">string</span><span class="p">,</span> <span class="n">productName</span> <span class="n">string</span><span class="p">,</span> <span class="n">last10DaysSales</span> <span class="n">long</span><span class="p">,</span> <span class="n">sellerName</span> <span class="n">string</span><span class="p">,</span> <span class="n">sellersSales</span> <span class="n">long</span><span class="p">);</span>

<span class="c1">--Long term Summarization</span>
<span class="o">@</span><span class="n">store</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;rdbms&#39;</span> <span class="p">,</span> <span class="n">jdbc</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;${MYSQL_URL}&#39;</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="s1">&#39;${MYSQL_USERNAME}&#39;</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;${MYSQL_PASSWORD}&#39;</span><span class="p">,</span> <span class="n">jdbc</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;com.mysql.jdbc.Driver&#39;</span>
    <span class="p">,</span> <span class="n">pool</span><span class="p">.</span><span class="n">properties</span> <span class="o">=</span> <span class="ss">&quot;maximumPoolSize:1&quot;</span><span class="p">)</span> 
<span class="o">@</span><span class="n">purge</span><span class="p">(</span><span class="n">enable</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="n">aggregation</span> <span class="n">SalesAggregation</span> 
<span class="k">from</span> <span class="n">SalesStream</span> 
<span class="k">select</span> <span class="n">categoryName</span><span class="p">,</span> <span class="n">productName</span><span class="p">,</span> <span class="n">sellerName</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span> <span class="k">as</span> <span class="n">totalSales</span> 
    <span class="k">group</span> <span class="k">by</span> <span class="n">categoryName</span><span class="p">,</span> <span class="n">productName</span><span class="p">,</span> <span class="n">sellerName</span> 
    <span class="k">aggregate</span> <span class="k">by</span> <span class="k">timestamp</span> <span class="k">every</span> <span class="n">sec</span><span class="p">...</span><span class="k">year</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;calculateStartEndTimeForHTTPTrigger&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">DailyDealsTriggerStream</span> 
<span class="k">select</span> <span class="n">emailToBeSent</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span><span class="n">timestampInMilliseconds</span><span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">dateSub</span><span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">currentDate</span><span class="p">(),</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">),</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span><span class="n">timestampInMilliseconds</span><span class="p">()</span> <span class="k">as</span> <span class="n">endTime</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">JoinStream</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;calculateStartEndTimeForDailyTrigger&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">DailyTrigger</span> 
<span class="k">select</span> <span class="k">true</span> <span class="k">as</span> <span class="n">emailToBeSent</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span><span class="n">timestampInMilliseconds</span><span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">dateSub</span><span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">currentDate</span><span class="p">(),</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">),</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">triggered_time</span> <span class="k">as</span> <span class="n">endTime</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">JoinStream</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;findLowSalesProduct&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">JoinStream</span> <span class="k">join</span> <span class="n">SalesAggregation</span>
<span class="n">within</span> <span class="n">startTime</span><span class="p">,</span> <span class="n">endTime</span> 
<span class="n">per</span> <span class="s1">&#39;seconds&#39;</span> 
<span class="k">select</span> <span class="n">endTime</span><span class="p">,</span> <span class="n">emailToBeSent</span><span class="p">,</span> <span class="n">categoryName</span><span class="p">,</span> <span class="n">productName</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">totalSales</span><span class="p">)</span> <span class="k">as</span> <span class="n">totalPastSales</span> 
    <span class="k">group</span> <span class="k">by</span> <span class="n">categoryName</span><span class="p">,</span> <span class="n">productName</span> 
    <span class="k">having</span> <span class="n">totalPastSales</span> <span class="o">&lt;</span> <span class="mi">100</span>
    <span class="k">order</span> <span class="k">by</span> <span class="n">totalPastSales</span> <span class="k">desc</span> 
    <span class="k">limit</span> <span class="mi">1</span> 
<span class="k">insert</span> <span class="k">into</span> <span class="n">PastSalesStream</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;findSellersWhoSoldHighestQuantity&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">PastSalesStream</span> <span class="k">as</span> <span class="n">PS</span> <span class="k">join</span> <span class="n">SalesAggregation</span> <span class="k">as</span> <span class="n">SA</span>
    <span class="k">on</span> <span class="n">PS</span><span class="p">.</span><span class="n">categoryName</span> <span class="o">==</span> <span class="n">SA</span><span class="p">.</span><span class="n">categoryName</span> <span class="k">and</span> <span class="n">PS</span><span class="p">.</span><span class="n">productName</span> <span class="o">==</span> <span class="n">SA</span><span class="p">.</span><span class="n">productName</span>
<span class="n">within</span> <span class="n">time</span><span class="p">:</span><span class="n">timestampInMilliseconds</span><span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">dateSub</span><span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">currentDate</span><span class="p">(),</span> <span class="mi">29</span><span class="p">,</span> <span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">),</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">),</span> <span class="n">endTime</span> 
<span class="n">per</span> <span class="s1">&#39;seconds&#39;</span>
<span class="k">select</span> <span class="n">emailToBeSent</span><span class="p">,</span> <span class="n">PS</span><span class="p">.</span><span class="n">categoryName</span><span class="p">,</span> <span class="n">PS</span><span class="p">.</span><span class="n">productName</span><span class="p">,</span> <span class="n">totalPastSales</span> <span class="k">as</span> <span class="n">last10DaysSales</span><span class="p">,</span> <span class="n">sellerName</span><span class="p">,</span> <span class="k">sum</span><span class="p">(</span><span class="n">totalSales</span><span class="p">)</span> <span class="k">as</span> <span class="n">sellersSales</span> 
    <span class="k">group</span> <span class="k">by</span> <span class="n">categoryName</span><span class="p">,</span> <span class="n">productName</span><span class="p">,</span> <span class="n">sellerName</span> 
    <span class="k">order</span> <span class="k">by</span> <span class="n">sellersSales</span> <span class="k">desc</span> 
    <span class="k">limit</span> <span class="mi">5</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">DailyDealsSellerCandidates</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;emailFormatting&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">DailyDealsSellerCandidates</span><span class="p">[</span><span class="n">emailToBeSent</span> <span class="o">==</span> <span class="k">true</span><span class="p">]</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">batch</span><span class="p">()</span> 
<span class="k">select</span> <span class="n">time</span><span class="p">:</span><span class="n">dateAdd</span><span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">currentDate</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dailyDealDate</span><span class="p">,</span> <span class="n">str</span><span class="p">:</span><span class="n">concat</span><span class="p">(</span><span class="ss">&quot;Daily Deals Seller Candidate for &quot;</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span><span class="n">dateAdd</span><span class="p">(</span><span class="n">time</span><span class="p">:</span><span class="n">currentDate</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;DAY&#39;</span><span class="p">,</span> <span class="s1">&#39;yyyy-MM-dd&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">emailSubject</span><span class="p">,</span> <span class="n">productName</span><span class="p">,</span> <span class="n">categoryName</span><span class="p">,</span> <span class="n">last10DaysSales</span><span class="p">,</span> <span class="n">str</span><span class="p">:</span><span class="n">groupConcat</span><span class="p">(</span><span class="n">str</span><span class="p">:</span><span class="n">fillTemplate</span><span class="p">(</span><span class="ss">&quot;&lt;tr&gt;&lt;td&gt;{{1}}&lt;/td&gt;&lt;td&gt;{{2}}&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">,</span> <span class="n">sellerName</span><span class="p">,</span> <span class="n">sellersSales</span><span class="p">),</span> <span class="ss">&quot;&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">candidateInfo</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">EmailNotificationStream</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Source view of the Siddhi apps.</p>
<p>Siddhi App 1</p>
<p><a href="../images/AggregationAppSourceView.png"><img alt="source_view_1" src="../images/AggregationAppSourceView.png" title="Source view of the Siddhi App1" /></a></p>
<p>Siddhi App 2</p>
<p><a href="../images/AlertAppSourceView.png"><img alt="source_view_2" src="../images/AlertAppSourceView.png" title="Source view of the Siddhi App1" /></a></p>
<p>Below are the flow diagram of the above Siddhi Apps.</p>
<p>Siddhi App 1</p>
<p><a href="../images/AggregationAppDesignView.png"><img alt="query_flow" src="../images/AggregationAppDesignView.png" title="Query flow diagram" /></a></p>
<p>Siddhi App 2</p>
<p><a href="../images/AlertAppDesignView.png"><img alt="query_flow_2" src="../images/AlertAppDesignView.png" title="Query flow diagram" /></a></p>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<p>NOTE: In the provided Siddhi app, there are some environmental variables (EMAIL_USERNAME,EMAIL_PASSWORD, SENDER_EMAIL_ADDRESS and RECEIVER_EMAIL_ADDRESS) used which are required to be set to send an email alert based on the Siddhi queries defined. Moreover, we are using a MySQL database backend to persist aggregation data.</p>
<p>Hence, make sure to set the environmental variables with the proper values in the system</p>
<ul>
<li>
<p>SENDER_EMAIL_ADDRESS: Email address of the account used to send email alerts. (eg: 'siddhi.gke.user@gmail.com')</p>
</li>
<li>
<p>EMAIL_USERNAME: Username of the email account which used to send email alerts. (eg: 'siddhi.gke.user')</p>
</li>
<li>
<p>EMAIL_PASSWORD: Password of the email account which used to send email alerts. (eg: 'siddhi123')</p>
</li>
<li>
<p>RECEIVER_EMAIL_ADDRESS: Email address of the account used to receive email alerts.</p>
</li>
<li>
<p>MYSQL_URL: MySQL url used to connect to the database. (eg: 'jdbc:mysql://localhost:3306/testdb?useSSL=false')</p>
</li>
<li>
<p>MYSQL_USERNAME: Username of the MySQL database used to persist aggregated data.</p>
</li>
<li>
<p>MYSQL_PASSWORD: Password of the MySQL database used to persist aggregated data.</p>
</li>
</ul>
<h3 id="setup-mysql">Setup MySQL<a class="headerlink" href="#setup-mysql" title="Permanent link">&para;</a></h3>
<ol>
<li>Download and Install MySQL database as per the guidelines <a href="https://www.mysql.com/downloads/">https://www.mysql.com/downloads/</a></li>
<li>Log in to the MySQL server and create a database called “testdb”</li>
<li>Download the MySQL client connector <a href="https://dev.mysql.com/downloads/connector/j/">jar</a> and add it to <code>jars</code> (if it is non OSGi) or <code>bundles</code> (if it is OSGi bundle) directory of Siddhi distribution</li>
</ol>
<h3 id="tryout">Tryout<a class="headerlink" href="#tryout" title="Permanent link">&para;</a></h3>
<p>When you run the Siddhi app in the editor, you will see below logs getting printed in the editor console.</p>
<p><a href="../images/editor-app-run-mode.png"><img alt="editor_app_run_mode" src="../images/editor-app-run-mode.png" title="Siddhi App Run mode" /></a></p>
<ul>
<li>You could simply simulate some events directly into the stream and test your Siddhi app in the editor itself.</li>
<li>You can also send data for the past 5 days using the siddhi mock data generator.</li>
<li>Then, you can also simulate some events through HTTP to test the application. The following sections explain how you can test the Siddhi app via HTTP using cURL.</li>
</ul>
<h4 id="run-mock-data-generator">Run Mock Data Generator<a class="headerlink" href="#run-mock-data-generator" title="Permanent link">&para;</a></h4>
<p>In the provided Siddhi app, there is an HTTP source configured to receive sales data. For simplicity, you will be mocking this data through a generator . Please download the mock server <a href="https://github.com/niveathika/siddhi-mock-data-generator/releases/download/v2.0.0/siddhi-mock-data-generator-2.0.0.jar">jar</a> and run that mock service by executing the following command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">java -jar siddhi-mock-data-generator-2.0.0.jar</span>
</pre></div>
</td></tr></table>

<h4 id="invoking-the-siddhi-app">Invoking the Siddhi App<a class="headerlink" href="#invoking-the-siddhi-app" title="Permanent link">&para;</a></h4>
<p>As per the Siddhi app that you wrote in the 'Implementation' section, each day at 11pm an email will be generated with the candidates for the Daily Deal tomorrow.</p>
<p>Furthermore, this can be generated by sending a POST request to <code>http://localhost:8080/dailyDealsAlert</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">curl -X POST \</span>
<span class="go">  http://localhost:8080/dailyDealsAlert \</span>
<span class="go">  -k \</span>
<span class="go">  -H &#39;Content-Type: application/json&#39; \</span>
<span class="go">  -d &#39;{</span>
<span class="go">    &quot;emailToBeSent&quot;: true</span>
<span class="go">}&#39;</span>
</pre></div>
</td></tr></table>

<p>If you invoke the above cURL request email alert will be triggered. You can also observe the logs along with the details sent in the email.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">DailyDealsCandidatesAlert : DailyDealsSellerCandidates : [</span>
<span class="go">{&quot;event&quot;:{&quot;emailToBeSent&quot;:true,&quot;categoryName&quot;:&quot;Accessories&quot;,&quot;productName&quot;:&quot;Earring&quot;,&quot;last10DaysSales&quot;:80,&quot;sellerName&quot;:&quot;Malfoy&quot;,&quot;sellersSales&quot;:20}},</span>
<span class="go">{&quot;event&quot;:{&quot;emailToBeSent&quot;:true,&quot;categoryName&quot;:&quot;Accessories&quot;,&quot;productName&quot;:&quot;Earring&quot;,&quot;last10DaysSales&quot;:80,&quot;sellerName&quot;:&quot;George&quot;,&quot;sellersSales&quot;:20}},</span>
<span class="go">{&quot;event&quot;:{&quot;emailToBeSent&quot;:true,&quot;categoryName&quot;:&quot;Accessories&quot;,&quot;productName&quot;:&quot;Earring&quot;,&quot;last10DaysSales&quot;:80,&quot;sellerName&quot;:&quot;Harry&quot;,&quot;sellersSales&quot;:20}},</span>
<span class="go">{&quot;event&quot;:{&quot;emailToBeSent&quot;:true,&quot;categoryName&quot;:&quot;Accessories&quot;,&quot;productName&quot;:&quot;Earring&quot;,&quot;last10DaysSales&quot;:80,&quot;sellerName&quot;:&quot;Molly&quot;,&quot;sellersSales&quot;:10}},</span>
<span class="go">{&quot;event&quot;:{&quot;emailToBeSent&quot;:true,&quot;categoryName&quot;:&quot;Accessories&quot;,&quot;productName&quot;:&quot;Earring&quot;,&quot;last10DaysSales&quot;:80,&quot;sellerName&quot;:&quot;Fred&quot;,&quot;sellersSales&quot;:10}}</span>
<span class="go">]</span>
</pre></div>
</td></tr></table>

<p>Note: The configurations provided in the email sink along with the environment properties will work for Gmail, but if you use other mail servers, please make sure to change the config values accordingly.</p>
<p><a href="../images/simulation-email-output.png"><img alt="simulation_email_output" src="../images/simulation-email-output.png" title="Generated email for th simulation" /></a></p>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h2>
<p>Once you are done with the development, export the Siddhi app that you have developed with 'File' -&gt; 'Export File' option.</p>
<p>You can deploy the Siddhi app using any of the methods listed below.</p>
<h3 id="deploy-on-vm-bare-metal">Deploy on VM/ Bare Metal<a class="headerlink" href="#deploy-on-vm-bare-metal" title="Permanent link">&para;</a></h3>
<h4 id="prerequisites_1">Prerequisites<a class="headerlink" href="#prerequisites_1" title="Permanent link">&para;</a></h4>
<p>First, please make sure that necessary prerequisites are met as given the <a href="#testing">Testing section</a>. MySQL is required to try out the use case.</p>
<p>Then, as given in <a href="#setup-mysql">Setup MySQL</a> section. Download the MySQL database and install it. Then create a database called “testdb” in the MySQL database.</p>
<p>Environmental variables related to Email and MySQL needs to be exported.</p>
<h4 id="siddhi-runner-configuration">Siddhi Runner Configuration<a class="headerlink" href="#siddhi-runner-configuration" title="Permanent link">&para;</a></h4>
<ol>
<li>Download the latest Siddhi Runner <a href="https://github.com/siddhi-io/distribution/releases/download/v5.1.0/siddhi-runner-5.1.0.zip">distribution</a>.</li>
<li>Unzip the <code>siddhi-runner-x.x.x.zip</code>.</li>
<li>Configure the necessary environmental variables. Refer <a href="#Testing">Testing</a></li>
<li>
<p>Start Siddhi app with the runner config by executing the following commands from the distribution directory.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">Linux/Mac : ./bin/runner.sh -Dapps=&lt;siddhi-files-directory&gt;</span>
<span class="go">Windows : bin\runner.bat -Dapps=&lt;siddhi-files-directory&gt;</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>If pointing to different DB, run the mock data generator to add data for past 5 days sales. Download the <a href="https://github.com/niveathika/siddhi-mock-data-generator/releases/download/v2.0.0/siddhi-mock-data-generator-2.0.0.jar">mock data generator</a>. Execute the below command to run the mock data generator.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">java -jar siddhi-mock-data-generator-2.0.0.jar</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>Invoke the dailyDealsAlert service with the following cURL request. You can set <code>emailToBeSent</code> as false to not send an email but only to observe the logs.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">curl -X POST \</span>
<span class="go">http://localhost:8080/dailyDealsAlert \</span>
<span class="go">-k \</span>
<span class="go">-H &#39;Content-Type: application/json&#39; \</span>
<span class="go">-d &#39;{</span>
<span class="go">    &quot;emailToBeSent&quot;: true</span>
<span class="go">}&#39;</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>You can see the output log in the console. Here, you will be able to see the alert log printed as shown below.</p>
<p><a href="../images/console-output-vm.png"><img alt="console_output_vm" src="../images/console-output-vm.png" title="Console output" /></a></p>
</li>
<li>
<p>At the same time, you will also receive the email alert if <code>emailToBeSent</code> is true.</p>
</li>
</ol>
<h3 id="deploy-on-docker">Deploy on Docker<a class="headerlink" href="#deploy-on-docker" title="Permanent link">&para;</a></h3>
<h4 id="prerequisites_2">Prerequisites<a class="headerlink" href="#prerequisites_2" title="Permanent link">&para;</a></h4>
<p>MySQL is an external dependency for this use case. Hence, you could use the corresponding docker artifacts to test the requirement.</p>
<ol>
<li>
<p>First, you can create a docker network for the deployment as shown below</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">docker network create siddhi-tier --driver bridge</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>Then, you can get the MySQL docker image from <a href="https://hub.docker.com/_/mysql">here</a> and run it with below command. We are going to use mysql version 5.7.27.</p>
<p><a href="../images/mysql-docker-pull.png"><img alt="mysql_docker_pull" src="../images/mysql-docker-pull.png" title="MySQL Docker Pull Command" /></a></p>
</li>
<li>
<p>Start the MySQL docker images with below command,</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">docker run -d --name mysql-server --network siddhi-tier  -e MYSQL_DATABASE=testdb -e MYSQL_ROOT_PASSWORD=root mysql:5.7.27</span>
</pre></div>
</td></tr></table>

<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Check if the image is started correctly by using <code>docker ps</code>.
The above command will start mysql server with credentials <code>root:root</code> and create a database <code>testdb</code></p>
</div>
</li>
<li>
<p>Now, you have configured necessary prerequisites that required to run the use case.</p>
</li>
</ol>
<h4 id="siddhi-docker-configuration">Siddhi Docker Configuration<a class="headerlink" href="#siddhi-docker-configuration" title="Permanent link">&para;</a></h4>
<p>Siddhi docker artifacts can be exported from the Editor UI as follows,</p>
<ol>
<li>
<p>Start the Siddhi <a href="https://siddhi.io/en/v5.0/docs/tooling/">tooling</a> runtime and go to the editor UI in <a href="http://localhost:9390/editor">http://localhost:9390/editor</a></p>
<p>Follow below steps to start the Siddhi tooling runtime.
* Extract the downloaded zip and navigate to <TOOLING_HOME>/bin. (TOOLING_HOME refers to the extracted folder)
* Issue the following command in the command prompt (Windows) / terminal (Linux/Mac)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>For Windows: tooling.bat
For Linux/Mac: ./tooling.sh
</pre></div>
</td></tr></table>

</li>
<li>
<p>Go to Export -&gt; For Docker Option to export and push the docker image.</p>
<ul>
<li>
<p>Step 1: Select both siddhi apps
    <a href="../images/docker/step1.png"><img alt="export_docker_select_siddhi_app" src="../images/docker/step1.png" title="Export docker artifacts Step 1" /></a></p>
</li>
<li>
<p>Step 2: No need to template siddhi apps as it is already a template
    <a href="../images/docker/step2.png"><img alt="export_docker_template_siddhi_app" src="../images/docker/step2.png" title="Export docker artifacts Step 1" /></a></p>
</li>
<li>
<p>Step 3: Default configs can be used
    <a href="../images/docker/step3.png"><img alt="export_docker_add_configuration" src="../images/docker/step3.png" title="Export docker artifacts Step 3" /></a></p>
</li>
<li>
<p>Step 4: Fill the template variables</p>
<div class="admonition info">
<p class="admonition-title">Setting MYSQL_URL</p>
<p>Since we are using MySQL docker container MySQL URL should be <code>jdbc:mysql://&lt;mysql docker container name&gt;:3306/&lt;created DB&gt;?useSSL=false</code> i.e <code>jdbc:mysql://mysql-server:3306/testdb?useSSL=false</code> by default</p>
</div>
<p><a href="../images/docker/step4.png"><img alt="export_docker_fill_template_values" src="../images/docker/step4.png" title="Export docker artifacts Step 4" /></a></p>
</li>
<li>
<p>Step 5: Select MySQL connector to use
    <a href="../images/docker/step5.png"><img alt="export_docker_select_bundles" src="../images/docker/step5.png" title="Export docker artifacts Step 5" /></a></p>
</li>
<li>
<p>Step 6: Push to docker repository
    <a href="../images/docker/step6.png"><img alt="export_docker_push_to_docker" src="../images/docker/step6.png" title="Export docker artifacts Step 6" /></a></p>
</li>
</ul>
</li>
<li>
<p>Then, you can run the Siddhi docker image that you created with necessary external dependencies to work with MySQL.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">docker run --network siddhi-tier -p 8080:8080 -it  &lt;docker-image-name&gt;  </span>
</pre></div>
</td></tr></table>

<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Here port 8080 is bound with localhost:8080 to run the mock-data generator</p>
</div>
</li>
<li>
<p>You can use the sample mock data generator to add data for past 5 days sales. Download the <a href="https://github.com/niveathika/siddhi-mock-data-generator/releases/download/v2.0.0/siddhi-mock-data-generator-2.0.0.jar">mock data generator</a>. Execute the below command to run the mock data generator.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">java -jar siddhi-mock-data-generator-2.0.0.jar</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>Invoke the dailyDealsAlert service with the following cURL request. You can set <code>emailToBeSent</code> as false to not send an email but only to observe the logs.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">curl -X POST \</span>
<span class="go">http://localhost:8080/dailyDealsAlert \</span>
<span class="go">-k \</span>
<span class="go">-H &#39;Content-Type: application/json&#39; \</span>
<span class="go">-d &#39;{</span>
<span class="go">    &quot;emailToBeSent&quot;: true</span>
<span class="go">}&#39;</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>You can see the output log in the console. Here, you will be able to see the alert log printed as shown below.</p>
<p><a href="../images/console-output-docker.png"><img alt="console_output_docker" src="../images/console-output-docker.png" title="Console output" /></a></p>
</li>
</ol>
<h3 id="deploy-on-kubernetes">Deploy on Kubernetes<a class="headerlink" href="#deploy-on-kubernetes" title="Permanent link">&para;</a></h3>
<h4 id="prerequisites_3">Prerequisites<a class="headerlink" href="#prerequisites_3" title="Permanent link">&para;</a></h4>
<p>MySQL is an external dependency for this use case. Hence, you could use the corresponding docker artifacts to test the requirement.</p>
<ol>
<li>
<p>It is advisable to create a namespace in Kubernetes to follow below steps.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">kubectl create ns agg-guide</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>There are some prerequisites that you should meet to tryout below SiddhiProcess. Such as configure MySQL database in Kubernetes. First, configure the MySQL server within the created namespace as in Step 1. You can use the official <a href="https://github.com/helm/charts/tree/master/stable/mysql">helm chart</a> provided for MySQL.</p>
<ul>
<li>
<p>First, install the MySQL helm chart as shown below,</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">helm install --name mysql-server --namespace=agg-guide --set mysqlRootPassword=root,mysqlUser=root,mysqlDatabase=testdb stable/mysql</span>
</pre></div>
</td></tr></table>

<p>Here, you can define the root password to connect to the MYSQL database and also define the database name. BTW, make sure to do <code>helm init --tiller-namespace=agg-guide</code> if it is not done yet.</p>
<p>Verify pods are running with <code>kubectl get pods --namespace=agg-guide</code></p>
</li>
<li>
<p>Then, you can set a port forwarding to the MySQL service which allows you to connect from the Host.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">kubectl port-forward svc/mysql-server 13300:3306 --namespace=agg-guide</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>Then, you can login to the MySQL server from your host machine as shown below.</p>
<p><a href="../images/k8s-mysql-db-info.png"><img alt="docker_mysql_db_info" src="../images/k8s-mysql-db-info.png" title="MySQL Docker Database Details" /></a></p>
</li>
</ul>
</li>
<li>
<p>Afterwards, you can install Siddhi Operator</p>
<ul>
<li>
<p>To install the Siddhi Kubernetes operator run the following commands.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">kubectl apply -f https://github.com/siddhi-io/siddhi-operator/releases/download/v0.2.1/00-prereqs.yaml  --namespace=agg-guide</span>
<span class="go">kubectl apply -f https://github.com/siddhi-io/siddhi-operator/releases/download/v0.2.1/01-siddhi-operator.yaml --namespace=agg-guide</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>You can verify the installation by making sure the following deployments are running in your Kubernetes cluster.</p>
<p><a href="../images/k8s-pods.png"><img alt="kubernetes_siddhi-pods" src="../images/k8s-pods.png" title="K8S Siddhi Pods" /></a></p>
<p><a href="../images/k8s-svc.png"><img alt="kubernetes_siddhi-svc" src="../images/k8s-svc.png" title="K8S Siddhi Services" /></a></p>
</li>
</ul>
</li>
<li>
<p>Enable <a href="https://kubernetes.github.io/ingress-nginx/deploy/">ingress</a></p>
<ul>
<li>
<p>Mandatory Commands for all clusters</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/mandatory.yaml</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>Docker for Mac/Docker for Windows</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/provider/cloud-generic.yaml</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>Minikube</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">minikube addons enable ingress</span>
</pre></div>
</td></tr></table>

</li>
<li>
<p>GKE</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/provider/cloud-generic.yaml</span>
</pre></div>
</td></tr></table>

</li>
</ul>
</li>
<li>
<p>Configure Kubernetes cluster IP as “siddhi” hostname in your /etc/hosts file.</p>
<ul>
<li>Minikube: add minikube IP to the “/etc/hosts” file as host “siddhi”, Run “minikube ip” command in terminal to get the minikube IP.</li>
<li>Docker for Mac: use 0.0.0.0 to the /etc/hosts file as host “siddhi”.</li>
<li>Docker for Windows: use IP that resolves to host.docker.internal in the /etc/hosts file as host “siddhi”.</li>
<li>GKE: Obtain the external IP (EXTERNAL-IP) of the Ingress resources by listing down the Kubernetes Ingresses.</li>
</ul>
</li>
</ol>
<h4 id="siddhi-kubernetes-configuration">Siddhi Kubernetes configuration<a class="headerlink" href="#siddhi-kubernetes-configuration" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>To deploy the above created Siddhi app, we have to create custom resource object yaml file (with the kind as SiddhiProcess). Kubernetes CRD can be exported from the Siddhi <a href="https://siddhi.io/en/v5.0/docs/tooling/">tooling</a> runtime with the editor UI in <a href="http://localhost:9390/editor">http://localhost:9390/editor</a></p>
<ul>
<li>
<p>Select the Export -&gt; For Kubernetes Option</p>
</li>
<li>
<p>Steps 1- 5 is the same for both artifacts.</p>
</li>
<li>
<p>In Step 6, push the docker image with different name to Docker deployment.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>This docker image will be different to the one pushed in Docker deployment, since only base image with additional bundles will be push to the docker in Kubernetes deployment.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Ensure that the pushed docker image is public</p>
</div>
</li>
<li>
<p>Step 7 : Let's create non-distributed and stateless deployment
    <a href="../images/step7.png"><img alt="export_docker_kubernetes_config" src="../images/step7.png" title="Export kubernetes artifacts Step 7" /></a></p>
</li>
<li>
<p>Extract siddhi-kubernetes.zip</p>
</li>
</ul>
</li>
<li>
<p>Now,  let’s create the above resource in the Kubernetes  cluster with below command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">kubectl --namespace=agg-guide apply -f &lt;absolute-path&gt;/siddhi-kubernetes/siddhi-process.yaml</span>
</pre></div>
</td></tr></table>

<p>Once, siddhi apps are successfully deployed. You can verify its health with below Kubernetes commands</p>
<p><a href="../images/k8s-pods-with-siddhi.png"><img alt="kubernetes_pods_with_siddhi" src="../images/k8s-pods-with-siddhi.png" title="Kubernetes Pods" /></a></p>
</li>
<li>
<p>You can use the sample mock data generator to add data for past 5 days sales. Download the <a href="https://github.com/niveathika/siddhi-mock-data-generator/releases/download/v2.0.0/siddhi-mock-data-generator-2.0.0.jar">mock data generator</a>. Execute the below command to run the mock data generator.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">java -jar siddhi-mock-data-generator-2.0.0.jar siddhi/siddhi-aggregation-guide-0/8080</span>
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Hostname of the HTTP Source<p>Here the hostname will include deployment name along with the port with syntax, <code>&lt;IP&gt;/&lt;DEPLOYMENT_NAME&gt;/&lt;PORT&gt;</code>.
The above sample is for artifacts generated with process name, <code>siddhi-aggregation-guide</code> in Step 6 of the Export Dialog.</p>
</p>
</div>
</li>
<li>
<p>Invoke the dailyDealsAlert service with the following cURL request. You can set <code>emailToBeSent</code> as false to not send an email but only to observe the logs.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="go">curl -X POST \</span>
<span class="go">http://siddhi/siddhi-aggregation-guide-1/8080/dailyDealsAlert \</span>
<span class="go">-k \</span>
<span class="go">-H &#39;Content-Type: application/json&#39; \</span>
<span class="go">-d &#39;{</span>
<span class="go">    &quot;emailToBeSent&quot;: true</span>
<span class="go">}&#39;</span>
</pre></div>
</td></tr></table>

<div class="admonition note">
<p class="admonition-title">Hostname of the HTTP Source<p>Here the hostname will include deployment name along with the port with syntax, <code>&lt;IP&gt;/&lt;DEPLOYMENT_NAME&gt;/&lt;PORT&gt;</code>.
The above sample is for artifacts generated with process name, <code>siddhi-aggregation-guide</code> in Step 6 of the Export Dialog.</p>
</p>
</div>
</li>
<li>
<p>You can see the output log in the console. Here, you will be able to see the alert log printed as shown below.</p>
<p><a href="../images/k8s-console-output.png"><img alt="kubernetes_siddhi_console_output" src="../images/k8s-console-output.png" title="Kubernetes Console Output" /></a></p>
<div class="admonition info">
<p class="admonition-title">Refer <a href="https://siddhi.io/en/v5.1/docs/siddhi-as-a-kubernetes-microservice/">here</a> to get more details about running Siddhi on Kubernetes.</p>
</div>
</li>
</ol>
                
                  
                
              
  <a href="#" class="cd-top text--replace js-cd-top">Top</a>

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../realtime-movie-recommendation/guide/" title="Realtime predictions with pre-trained ML models" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Realtime predictions with pre-trained ML models
              </span>
            </div>
          </a>
        
        
          <a href="../../../tooling/" title="Tooling" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Tooling
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Siddhi - Documentation
          </div>
        
        &copy;2019 <a href="https://wso2.com/">WSO2</a>
      </div>
      
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
    
      <a href="/community/#community-collaboration" class="md-footer-social__link fa fa-slack"></a>
    
      <a href="https://github.com/siddhi-io/siddhi" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://medium.com/siddhi-io" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://twitter.com/siddhi_io" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/groups/13553064" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
        <script src="../../../../assets/lib/highlightjs/highlight.min.js"></script>
      
        <script src="../../../../assets/js/theme.js"></script>
      
        <script src="../../../../assets/lib/backtotop/js/util.js"></script>
      
        <script src="../../../../assets/lib/backtotop/js/main.js"></script>
      
    
  </body>
</html>