<!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->





<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cloud Native Stream Processor">
      
      
        <link rel="canonical" href="http://siddhi.io/en/v5.1/docs/guides/patterns-and-trends/guide/">
      
      
        <meta name="author" content="WSO2">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Patterns & Trends Over Time - Siddhi</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../../assets/lib/highlightjs/default.min.css">
    
      <link rel="stylesheet" href="../../../../assets/css/theme.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-103065-28", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#analyze-event-occurrence-patterns-and-trends-over-time" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->

<header class="md-header" data-md-component="header" id="page-header" data-url=""
        data-lang="en">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://siddhi.io/en/v5.1/" title="Siddhi"
           class="md-header-nav__button md-logo">
          
            <img src="../../../../images/siddhi-logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Siddhi
            </span>
            <span class="md-header-nav__topic">
              Patterns & Trends Over Time
            </span>
          
        </div>
        <div class="md-flex__ellipsis md-header__version-select">
            <div class="mb-tabs__dropdown version-select">
                <a class="md-tabs__link md-tabs__dropdown-link" href="#!" data-target="version-select-dropdown">
                  v5.1</a>
                <ul id="version-select-dropdown" class="mb-tabs__dropdown-content" tabindex="0">
                    <!-- Versions will added here dynamically -->
                    <li class="md-tabs__item mb-tabs__dropdown">
                        <a href="#" id="show-all-versions-link">Show all</a>
                    </li>
                </ul>
            </div>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
        </div>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
        <li class="md-tabs__item home_icon">
            <a href="/" title="Siddhi Home" class="md-tabs__link md-tabs__link--active">
                <i class="fa fa-home"></i>
            </a>
        </li>
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../download/" title="Download" class="md-tabs__link">
          Download
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../quick-start/" title="Quick Start" class="md-tabs__link">
          Quick Start
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../" title="Documentation" class="md-tabs__link md-tabs__link--active">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/community/" title="Community" class="md-tabs__link">
          Community
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../development/" title="Development" class="md-tabs__link">
          Development
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/license/" title="License" class="md-tabs__link">
          License
        </a>
      
    </li>
  

      
    </ul>
    <div class="quick_links">
        
        <a href="https://github.com/siddhi-io/www/edit/v5.1/en/docs/docs/guides/patterns-and-trends/guide.md" target="blank" id="editIcon" title="Edit this page"
           title="Edit this page" class="md-icon md-content__icon nav_link edit_link"></a>
        
    </div>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
    <label class="md-nav__title md-nav__title--site" for="__drawer">
      <a href="http://siddhi.io/en/v5.1/" title="Siddhi"
         class="md-nav__button md-logo">
        
          <img src="../../../../images/siddhi-logo.svg" width="48" height="48">
        
      </a>
      Siddhi
    </label>
    
      <div class="md-nav__source">
        


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
      </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Download
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Download
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Quick Start
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Quick Start
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4" checked>
    
    <label class="md-nav__link" for="nav-3-4">
      Use case Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Use case Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../alerts-for-thresholds/guide/" title="Alerts Based on Thresholds" class="md-nav__link">
      Alerts Based on Thresholds
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fault-tolerance/guide/" title="Fault Tolerance & Error Handling" class="md-nav__link">
      Fault Tolerance & Error Handling
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Patterns & Trends Over Time
      </label>
    
    <a href="./" title="Patterns & Trends Over Time" class="md-nav__link md-nav__link--active">
      Patterns & Trends Over Time
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scenario-optimize-rider-requests-in-a-taxi-service-company" title="Scenario - Optimize Rider Requests in a Taxi Service Company" class="md-nav__link">
    Scenario - Optimize Rider Requests in a Taxi Service Company
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" title="What you'll build" class="md-nav__link">
    What you'll build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-requirements" title="Mandatory Requirements" class="md-nav__link">
    Mandatory Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Requirements needed to deploy Siddhi in Docker/Kubernetes" class="md-nav__link">
    Requirements needed to deploy Siddhi in Docker/Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implement-streaming-queries" title="Implement Streaming Queries" class="md-nav__link">
    Implement Streaming Queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-mysql" title="Setup MySQL" class="md-nav__link">
    Setup MySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tryout" title="Tryout" class="md-nav__link">
    Tryout
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-the-siddhi-app" title="Invoking the Siddhi App" class="md-nav__link">
    Invoking the Siddhi App
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-on-vm-bare-metal" title="Deploy on VM/ Bare Metal" class="md-nav__link">
    Deploy on VM/ Bare Metal
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-runtime-configuration" title="Siddhi Runtime Configuration" class="md-nav__link">
    Siddhi Runtime Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-docker" title="Deploy on Docker" class="md-nav__link">
    Deploy on Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_2" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-docker-configuration" title="Siddhi Docker Configuration" class="md-nav__link">
    Siddhi Docker Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-kubernetes" title="Deploy on Kubernetes" class="md-nav__link">
    Deploy on Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database-static-rule-processing/guide/" title="Static Rule Processing using Database Rules" class="md-nav__link">
      Static Rule Processing using Database Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrate-various-enterprise-systems/guide/" title="Integrate Various Enterprise Systems" class="md-nav__link">
      Integrate Various Enterprise Systems
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime-movie-recommendation/guide/" title="Realtime predictions with pre-trained ML models" class="md-nav__link">
      Realtime predictions with pre-trained ML models
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tooling/" title="Tooling" class="md-nav__link">
      Tooling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../query-guide/" title="Query Guide" class="md-nav__link">
      Query Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Siddhi APIs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Siddhi APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/latest/" title="latest" class="md-nav__link">
      latest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/5.1.0/" title="5.1.0" class="md-nav__link">
      5.1.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">
    
    <label class="md-nav__link" for="nav-3-8">
      REST API Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        REST API Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/siddhi-app-api/" title="Siddhi App APIs" class="md-nav__link">
      Siddhi App APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/on-demand-query-api/" title="On-Demand Query APIs" class="md-nav__link">
      On-Demand Query APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/health-check-api/" title="Health Check APIs" class="md-nav__link">
      Health Check APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/http-status-code/" title="HTTP Status Codes" class="md-nav__link">
      HTTP Status Codes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/store-api/" title="Store APIs (Deprecated)" class="md-nav__link">
      Store APIs (Deprecated)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-java-library/" title="Siddhi Java library" class="md-nav__link">
      Siddhi Java library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-local-microservice/" title="Siddhi Local Microservice" class="md-nav__link">
      Siddhi Local Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-docker-microservice/" title="Siddhi Docker Microservice" class="md-nav__link">
      Siddhi Docker Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-kubernetes-microservice/" title="Siddhi Kubernetes Microservice" class="md-nav__link">
      Siddhi Kubernetes Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../config-guide/" title="Configuration Guide" class="md-nav__link">
      Configuration Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Community
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Community
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/source/" title="Source" class="md-nav__link">
      Source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/build/" title="Build" class="md-nav__link">
      Build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      License
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        License
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
    </ul>
  </nav>  
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scenario-optimize-rider-requests-in-a-taxi-service-company" title="Scenario - Optimize Rider Requests in a Taxi Service Company" class="md-nav__link">
    Scenario - Optimize Rider Requests in a Taxi Service Company
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" title="What you'll build" class="md-nav__link">
    What you'll build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-requirements" title="Mandatory Requirements" class="md-nav__link">
    Mandatory Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Requirements needed to deploy Siddhi in Docker/Kubernetes" class="md-nav__link">
    Requirements needed to deploy Siddhi in Docker/Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implement-streaming-queries" title="Implement Streaming Queries" class="md-nav__link">
    Implement Streaming Queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-mysql" title="Setup MySQL" class="md-nav__link">
    Setup MySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tryout" title="Tryout" class="md-nav__link">
    Tryout
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-the-siddhi-app" title="Invoking the Siddhi App" class="md-nav__link">
    Invoking the Siddhi App
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-on-vm-bare-metal" title="Deploy on VM/ Bare Metal" class="md-nav__link">
    Deploy on VM/ Bare Metal
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-runtime-configuration" title="Siddhi Runtime Configuration" class="md-nav__link">
    Siddhi Runtime Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-docker" title="Deploy on Docker" class="md-nav__link">
    Deploy on Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_2" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-docker-configuration" title="Siddhi Docker Configuration" class="md-nav__link">
    Siddhi Docker Configuration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-kubernetes" title="Deploy on Kubernetes" class="md-nav__link">
    Deploy on Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
  
                
                  <a href="https://github.com/siddhi-io/www/edit/v5.1/en/docs/docs/guides/patterns-and-trends/guide.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="analyze-event-occurrence-patterns-and-trends-over-time">Analyze Event Occurrence Patterns and Trends Over Time<a class="headerlink" href="#analyze-event-occurrence-patterns-and-trends-over-time" title="Permanent link">&para;</a></h1>
<p>In this guide, we are going to discuss a unique and appealing feature of a complex event processing system which is <code>Patterns and Trends</code>. Patterns and Trends are highly utilized in various business domains for the day to day business activities and growth. To understand these capabilities, we are going to consider a Taxi service use case.</p>
<h2 id="scenario-optimize-rider-requests-in-a-taxi-service-company">Scenario - Optimize Rider Requests in a Taxi Service Company<a class="headerlink" href="#scenario-optimize-rider-requests-in-a-taxi-service-company" title="Permanent link">&para;</a></h2>
<p>Taxi service is one of the emerging businesses in metro cities. There are a lot of Taxi service companies such as UBER, LYFT, OLA, GRAB, etc.. are in the market. Due to the number of competitors in the market passengers have the freedom to select their preferred Taxi service based on cost, waiting time, etc..  As a passenger, the main requirement is to find a Taxi within a short time (less waiting time). Then, it is important to understand the rider requests and effectively use the available drivers/riders. In this, identifying the trend of passenger request will help to get more passengers and increase the business overall.</p>
<p>The following sections are available in this guide.</p>
<ul>
<li><a href="#what-youll-build">What you'll build</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#deployment">Deployment &amp; Output</a></li>
</ul>
<h2 id="what-youll-build">What you'll build<a class="headerlink" href="#what-youll-build" title="Permanent link">&para;</a></h2>
<p>You will be implementing a scenario to identify the increasing trend of rider requests over time and direct required riders to that specific geographical area to increase the chance of getting more rides. You will be using Siddhi streaming engine and related stream processing capabilities to achieve the requirement. Let’s jump into the use case directly.</p>
<p>Let’s consider a Taxi service company called <code>myTaxi</code>. myTaxi is one of the startup Taxi service companies in the city and they have launched very recently. As per the analysis, they have found that they are a lot of ride cancellations happened over the last few months because the waiting time for the taxi is high. Even Though, myTaxi has enough riders they are not around the expected area where there is a sudden peak for rider requests. Then, they have decided to integrate a Stream Processing system to analyze the patterns and trends in real-time and act accordingly. </p>
<p>In this solution, passengers use the myTaxi mobile application to book Taxi and those events are received to the myTaxi request processing system, it sends those events to Siddhi Stream Processor through TCP endpoint. Siddhi process those incoming events to identify predefined trends and patterns. Once a specific trend/patterns are identified then Siddhi sends those required trend/pattern specific attributes for further processing. In this case, that information is stored in a database.</p>
<p><img alt="mytaxi_usecase" src="../images/mytaxi-usecase.png" title="Rider Requests in a Taxi Service Company" /></p>
<p>Now, let’s understand how this could be implemented in Siddhi engine.</p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>Below are the prerequisites that should be considered to implement the above use case.</p>
<h3 id="mandatory-requirements">Mandatory Requirements<a class="headerlink" href="#mandatory-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://siddhi.io/en/v5.1/download/">Siddhi tooling VM/Local distribution</a></li>
<li>One of the <a href="https://siddhi.io/en/v5.1/download/">Siddhi runner distributions</a> <ul>
<li>VM/Local Runtime</li>
<li>Docker Image</li>
<li>K8S Operator (commands are given in deployment section)</li>
</ul>
</li>
<li><a href="https://www.mysql.com">MySQL Database</a></li>
<li>Java 8 or higher</li>
</ul>
<h3 id="requirements-needed-to-deploy-siddhi-in-dockerkubernetes">Requirements needed to deploy Siddhi in Docker/Kubernetes<a class="headerlink" href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.docker.com/engine/installation/">Docker</a></li>
<li><a href="https://github.com/kubernetes/minikube#installation">Minikube</a> or <a href="https://console.cloud.google.com/">Google Kubernetes Engine(GKE) Cluster</a> or <a href="https://docs.docker.com/docker-for-mac/install/">Docker for Mac</a></li>
</ul>
<h2 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h2>
<h3 id="implement-streaming-queries">Implement Streaming Queries<a class="headerlink" href="#implement-streaming-queries" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Start the Siddhi <a href="https://siddhi.io/en/v5.0/docs/tooling/">tooling</a> runtime and go to the editor UI in http://localhost:9390/editor </p>
<p>Follow below steps to start the Siddhi tooling runtime.
* Extract the downloaded zip and navigate to <TOOLING_HOME>/bin. (TOOLING_HOME refers to the extracted folder) 
* Issue the following command in the command prompt (Windows) / terminal (Linux/Mac)
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>For Windows: tooling.bat
For Linux/Mac: ./tooling.sh
</pre></div>
</td></tr></table></p>
</li>
<li>
<p>Select File -&gt; New option, then you could either use the source view or design view to write/build the Siddhi Application. You can find the Siddhi Application bellow, that implements the requirements mentioned above.</p>
</li>
<li>
<p>Let’s write (develop) the Siddhi Application, as given below.</p>
</li>
<li>
<p>Once the Siddhi app is created, you can use the Event Simulator option in the editor to simulate events to streams and perform developer testing.</p>
</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">name</span><span class="p">(</span><span class="ss">&quot;Taxi-Rider-Requests-Processing-App&quot;</span><span class="p">)</span>
<span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">description</span><span class="p">(</span><span class="ss">&quot;Siddhi application that processes Taxi Rider request events&quot;</span><span class="p">)</span>

<span class="c1">-- TCP source which accepts Taxi rider requests</span>
<span class="o">@</span><span class="k">source</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;tcp&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="s1">&#39;taxiRideRequests&#39;</span><span class="p">,</span> <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">TaxiRideEventStream</span><span class="p">(</span><span class="n">id</span> <span class="n">long</span><span class="p">,</span> <span class="n">time</span> <span class="n">string</span><span class="p">,</span> <span class="n">passengerId</span> <span class="n">string</span><span class="p">,</span> <span class="n">passengerName</span> <span class="n">string</span><span class="p">,</span> <span class="n">pickUpAddress</span> <span class="n">string</span><span class="p">,</span> <span class="n">pickUpZone</span> <span class="n">string</span><span class="p">,</span> 
<span class="n">dropOutAddress</span> <span class="n">string</span><span class="p">,</span> <span class="n">routingDetails</span> <span class="n">string</span><span class="p">,</span> <span class="n">expectedFare</span> <span class="n">double</span><span class="p">,</span> <span class="n">status</span> <span class="n">string</span><span class="p">,</span> <span class="n">passengerGrade</span> <span class="n">string</span><span class="p">,</span> <span class="n">additionalNote</span> <span class="n">string</span><span class="p">);</span>

<span class="c1">-- For testing purposes, offer messages are logged in console. </span>
<span class="c1">-- This could be further extended to send as sms to the premium users</span>
<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> 
    <span class="o">@</span><span class="n">payload</span><span class="p">(</span><span class="ss">&quot;&quot;&quot;</span>
<span class="ss">Hi {{passengerName}}</span>

<span class="ss">    Unfortunately, you couldn&#39;t travel with us Today. We apologise for the high waiting time.</span>
<span class="ss">    As a token of apology please accept {{offerAmount}} USD off from your next ride.</span>

<span class="ss">Truly, </span>
<span class="ss">MyTaxi Team&quot;&quot;&quot;</span><span class="p">)))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">InstantOfferAlertStream</span><span class="p">(</span><span class="n">passengerName</span> <span class="n">string</span><span class="p">,</span> <span class="n">pickUpZone</span> <span class="n">string</span><span class="p">,</span> <span class="n">offerAmount</span> <span class="n">double</span><span class="p">);</span>

<span class="c1">-- RDBMS event table which stores events related to the requirement of need more riders</span>
<span class="o">@</span><span class="n">store</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="ss">&quot;rdbms&quot;</span><span class="p">,</span> <span class="n">jdbc</span><span class="p">.</span><span class="n">url</span><span class="o">=</span><span class="ss">&quot;${MYSQL_DB_URL}&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="ss">&quot;${MYSQL_USERNAME}&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="ss">&quot;${MYSQL_PASSWORD}&quot;</span> <span class="p">,</span> <span class="n">jdbc</span><span class="p">.</span><span class="n">driver</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="ss">&quot;com.mysql.jdbc.Driver&quot;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">NeedMoreRidersTable</span> <span class="p">(</span><span class="n">systemTime</span> <span class="n">string</span><span class="p">,</span> <span class="k">zone</span> <span class="n">string</span><span class="p">);</span>

<span class="c1">-- Email sink which send email alerts to the manager of MyTaxi</span>
<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="ss">&quot;${EMAIL_USERNAME}&quot;</span><span class="p">,</span> <span class="n">address</span> <span class="o">=</span> <span class="ss">&quot;${SENDER_EMAIL_ADDRESS}&quot;</span><span class="p">,</span> <span class="n">password</span> <span class="o">=</span> <span class="ss">&quot;${EMAIL_PASSWORD}&quot;</span><span class="p">,</span> 
<span class="n">subject</span> <span class="o">=</span> <span class="ss">&quot;[Need Immediate Attention] High Waiting Time&quot;</span><span class="p">,</span> <span class="k">to</span> <span class="o">=</span> <span class="ss">&quot;${MANAGER_EMAIL_ADDRESS}&quot;</span><span class="p">,</span> <span class="k">host</span> <span class="o">=</span> <span class="ss">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="n">port</span> <span class="o">=</span> <span class="ss">&quot;465&quot;</span><span class="p">,</span> <span class="n">ssl</span><span class="p">.</span><span class="n">enable</span> <span class="o">=</span> <span class="ss">&quot;true&quot;</span><span class="p">,</span> <span class="n">auth</span> <span class="o">=</span> <span class="ss">&quot;true&quot;</span><span class="p">,</span> 
  <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span> 
    <span class="o">@</span><span class="n">payload</span><span class="p">(</span><span class="ss">&quot;&quot;&quot;</span>
<span class="ss">Hi,</span>

<span class="ss">    There is an increasing trend of ride cancellations in the {{zone}} area due to high waiting time.  </span>
<span class="ss">    Increasing trend is detected at {{systemTime}}.</span>
<span class="ss">    Please take immediate action to sort this out.</span>

<span class="ss">Thanks...&quot;&quot;&quot;</span><span class="p">)))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">AttentionRequiredCancellationStream</span> <span class="p">(</span><span class="n">systemTime</span> <span class="n">string</span><span class="p">,</span> <span class="k">zone</span> <span class="n">string</span><span class="p">,</span> <span class="n">lastNoOfCancellations</span> <span class="n">long</span><span class="p">);</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ride-cancellation-identifier&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="k">every</span> <span class="n">e1</span><span class="o">=</span><span class="n">TaxiRideEventStream</span><span class="p">[</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Assigned&#39;</span><span class="p">]</span> <span class="o">-&gt;</span> 
        <span class="n">e2</span><span class="o">=</span><span class="n">TaxiRideEventStream</span><span class="p">[</span><span class="n">e1</span><span class="p">.</span><span class="n">passengerId</span> <span class="o">==</span> <span class="n">passengerId</span> <span class="k">and</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;Cancelled&#39;</span> <span class="k">and</span> <span class="n">additionalNote</span> <span class="o">==</span> <span class="s1">&#39;WT is High&#39;</span><span class="p">]</span>
        <span class="n">within</span> <span class="mi">30</span> <span class="n">seconds</span> 
<span class="k">select</span> <span class="n">e2</span><span class="p">.</span><span class="n">passengerName</span><span class="p">,</span> <span class="n">e1</span><span class="p">.</span><span class="n">passengerGrade</span><span class="p">,</span> <span class="n">e1</span><span class="p">.</span><span class="n">pickUpZone</span><span class="p">,</span> <span class="n">e1</span><span class="p">.</span><span class="n">expectedFare</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">TaxiRideCancelStream</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Offer-for-premium-users&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">TaxiRideCancelStream</span><span class="p">[</span><span class="n">passengerGrade</span> <span class="o">==</span> <span class="s1">&#39;Premium&#39;</span><span class="p">]</span>
<span class="k">select</span> <span class="n">passengerName</span><span class="p">,</span> <span class="n">pickUpZone</span><span class="p">,</span> <span class="n">math</span><span class="p">:</span><span class="n">floor</span><span class="p">(</span><span class="n">expectedFare</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">.</span><span class="mi">0</span> <span class="k">as</span> <span class="n">offerAmount</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">InstantOfferAlertStream</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Frequently-ride-cancellation-identifier&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">TaxiRideCancelStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="n">timeBatch</span><span class="p">(</span><span class="mi">1</span> <span class="k">min</span><span class="p">)</span>
<span class="k">select</span> <span class="n">pickUpZone</span><span class="p">,</span> <span class="k">count</span><span class="p">()</span> <span class="k">as</span> <span class="n">totalCancellations</span><span class="p">,</span> <span class="n">time</span><span class="p">:</span><span class="n">currentTimestamp</span><span class="p">()</span> <span class="k">as</span> <span class="n">systemTime</span>
<span class="k">group</span> <span class="k">by</span> <span class="n">pickUpZone</span>
<span class="k">having</span> <span class="n">totalCancellations</span> <span class="o">&gt;</span> <span class="mi">3</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">NeedMoreRidersStream</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Dump-needMoreRider-events&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">NeedMoreRidersStream</span>
<span class="k">select</span> <span class="n">systemTime</span><span class="p">,</span> <span class="n">pickUpZone</span> <span class="k">as</span> <span class="k">zone</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">NeedMoreRidersTable</span><span class="p">;</span>

<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Ride-cancellation-increasing-trend-identifer&#39;</span><span class="p">)</span> 
<span class="n">partition</span> <span class="k">with</span> <span class="p">(</span><span class="n">pickUpZone</span> <span class="k">of</span> <span class="n">NeedMoreRidersStream</span><span class="p">)</span>
<span class="k">begin</span>
    <span class="k">from</span> <span class="n">e1</span> <span class="o">=</span> <span class="n">NeedMoreRidersStream</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">NeedMoreRidersStream</span><span class="p">[</span><span class="n">totalCancellations</span> <span class="o">&gt;</span> <span class="n">e1</span><span class="p">.</span><span class="n">totalCancellations</span><span class="p">],</span> 
        <span class="n">e3</span> <span class="o">=</span> <span class="n">NeedMoreRidersStream</span><span class="p">[</span><span class="n">totalCancellations</span> <span class="o">&gt;</span> <span class="n">e2</span><span class="p">.</span><span class="n">totalCancellations</span><span class="p">]</span>
    <span class="k">select</span> <span class="n">e3</span><span class="p">.</span><span class="n">systemTime</span><span class="p">,</span> <span class="n">e1</span><span class="p">.</span><span class="n">pickUpZone</span> <span class="k">as</span> <span class="k">zone</span><span class="p">,</span> <span class="n">e3</span><span class="p">.</span><span class="n">totalCancellations</span> <span class="k">as</span> <span class="n">lastNoOfCancellations</span>
    <span class="k">insert</span> <span class="k">into</span> <span class="n">AttentionRequiredCancellationStream</span><span class="p">;</span>
<span class="k">end</span><span class="p">;</span> 
</pre></div>
</td></tr></table>

<p>Source view of the Siddhi app.
<img alt="source_view" src="../images/source-view.jpg" title="Source view of the Siddhi App" /></p>
<p>Below is the flow diagram of the above Siddhi App.</p>
<p><img alt="query_flow" src="../images/query-flow.png" title="Query flow diagram" /></p>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<p>NOTE: In the above provided Siddhi app, there are some environmental variables (MYSQL_DB_URL, MYSQL_USERNAME, and  MYSQL_PASSWORD)  are used. These values are required to be set to try out the scenario end to end. MYSQL related environmental variables are required to store the events of stream <code>NeedMoreRidersStream</code>. Environmental variables EMAIL_PASSWORD, EMAIL_USERNAME, SENDER_EMAIL_ADDRESS and MANAGER_EMAIL_ADDRESS  are used to send an email alert when there is an increasing trend of cancellation on specific area.</p>
<ul>
<li>MYSQL_DB_URL: MySQL database jdbc url to persist failed events. (eg: 'jdbc:mysql://localhost:3306/MyTaxi')</li>
<li>MYSQL_USERNAME: Username of the user account to connect MySQL database. (eg: 'root')</li>
<li>MYSQL_PASSWORD: Password of the user account to connect MySQL database. (eg: 'root')</li>
<li>EMAIL_USERNAME: Username of the email account which used to send email alerts. (eg: 'siddhi.gke.user')</li>
<li>EMAIL_PASSWORD: Password of the email account which used to send email alerts. (eg: 'siddhi123')</li>
<li>SENDER_EMAIL_ADDRESS: Email address of the account used to send email alerts. (eg: 'siddhi.gke.user@gmail.com')</li>
<li>MANAGER_EMAIL_ADDRESS: Destination Email address where escalation mails are sent. (eg: 'manager@mytaxi.com')</li>
</ul>
<h3 id="setup-mysql">Setup MySQL<a class="headerlink" href="#setup-mysql" title="Permanent link">&para;</a></h3>
<ol>
<li>Download and Install MySQL database as per the guidelines (https://www.mysql.com/downloads/)</li>
<li>Log in to the MySQL server and create a database called “MyTaxi”</li>
<li>Download the MySQL client connector <a href="https://dev.mysql.com/downloads/connector/j/">jar</a> and add it to <code>jars</code> (if it is non OSGI) or <code>bundles</code> (if it is OSGI bundle) directory of Siddhi distribution</li>
</ol>
<h3 id="tryout">Tryout<a class="headerlink" href="#tryout" title="Permanent link">&para;</a></h3>
<p>There are multiple options available to test the developed Siddhi App. As mentioned in the previous step you could simply simulate some events directly into the stream and test your queries.</p>
<p>But, if you are willing to test the end to end flow (from an input source to sink) then you can start the Siddhi app in the editor itself. In this guide, we are going to run the Siddhi App in the editor itself. </p>
<p>Once the server is started, you will see below logs get printed in the editor console.</p>
<p><img alt="editor_app_run_mode" src="../images/editor-app-run-mode.png" title="Siddhi App Run mode" /></p>
<p>As written in the above Siddhi application, taxi ride requests are accepted by the TCP endpoint of the Siddhi Stream Processor; those events are pushed to a stream called <code>taxiRideEventStream</code>. The first query is written to identify the pattern of rider cancellation after rider request within 30 seconds due to high waiting time. If such a pattern is identified then system will the user grade and grant some offers for subsequent rides for <code>premium</code> users. </p>
<p>Parallelly, Stream Processor keep tracking the number of ride cancellations for each minute and if it found a situation of more than 3 ride cancellation then the system will identify that area/zone and send that details to next processing system to take necessary action. In the above query, such events are pushed to a database table. </p>
<p>There is another query which continuously listens for the total number of cancellations for each minute and looking for increasing trend of ride cancellations and notifies accordingly. In this situation, if the Streaming system sends an email alert to the manager of the MyTaxi for his/her further consideration.</p>
<h3 id="invoking-the-siddhi-app">Invoking the Siddhi App<a class="headerlink" href="#invoking-the-siddhi-app" title="Permanent link">&para;</a></h3>
<p>To try out the above use case, you have to send a set of events in a certain order to match with the query conditions. There is a sample TCP publisher could publish events in such an order. Hence, you could use the sample publisher given in <a href="https://github.com/mohanvive/siddhi-sample-clients/releases/download/v1.0.0/tcp-producer-1.0.0-jar-with-dependencies.jar">here</a>. </p>
<p>Then you can execute below command to run the TCP client. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>java -jar tcp-producer-1.0.0-jar-with-dependencies.jar 
</pre></div>
</td></tr></table>

<p>It will take nearly 3 minutes to publish events which required to test all the flows in the given Siddhi app.</p>
<p><img alt="tcp_publisher-command" src="../images/tcp-publisher-command.png" title="Command to Execute Sample TCP Publisher" /></p>
<p>When you are publishing events to Siddhi Stream processor, you could see the logs that get printed in Siddhi Stream processor side as well. There are related to instant offer alerts. Once, TCP publisher completes publishing events then you could check the email alert which is generated.</p>
<p><img alt="test_email_alert" src="../images/test-email-alert.png" title="Escalation Email Alert" /></p>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h2>
<p>Once you are done with the development, export the Siddhi app that you have developed with 'File' -&gt; 'Export File' option.</p>
<p>You can deploy the Siddhi app using any of the methods listed below. </p>
<h3 id="deploy-on-vm-bare-metal">Deploy on VM/ Bare Metal<a class="headerlink" href="#deploy-on-vm-bare-metal" title="Permanent link">&para;</a></h3>
<h4 id="prerequisites_1">Prerequisites<a class="headerlink" href="#prerequisites_1" title="Permanent link">&para;</a></h4>
<p>First, please make sure that necessary prerequisites are met as given the <a href="#testing">Testing section</a>. MySQL is required to try out the use case. </p>
<p>Then, as given in the <a href="#setup-mysql">Setup MySQL</a> section. Download the MySQL database and install it. Then create a database called “MyTaxi” in the MySQL database.</p>
<h4 id="siddhi-runtime-configuration">Siddhi Runtime Configuration<a class="headerlink" href="#siddhi-runtime-configuration" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Make sure to set the necessary environmental variables as given above.</p>
<p>Note: In the above provided Siddhi app, there are some environmental variables (MYSQL_DB_URL, MYSQL_USERNAME, and  MYSQL_PASSWORD)  are used. These values are required to be set to try out the scenario end to end. MYSQL related environmental variables are required to store the events of stream <code>NeedMoreRidersStream</code> . Environmental variables EMAIL_PASSWORD, EMAIL_USERNAME, SENDER_EMAIL_ADDRESS and MANAGER_EMAIL_ADDRESS  are used to send an email alert when there is an increasing trend of cancellation on specific area. 
Hence, make sure to set the environmental variables with the proper values in the system (make sure to follow necessary steps based on the underneath operating system).  </p>
</li>
<li>
<p>Download the latest Siddhi Runner <a href="https://github.com/siddhi-io/distribution/releases/download/v5.1.0-alpha/siddhi-runner-5.1.0-alpha.zip">distribution</a>.</p>
</li>
<li>Unzip the <code>siddhi-runner-x.x.x.zip</code>.</li>
<li>
<p>You have to copy necessary Mysql client jar to Siddhi runner distribution to connect with MySQL database. Copy the MySQL client connector jar to <code>jars</code> (if it is non OSGI) or <code>bundles</code> (if it is OSGI bundle) directory of Siddhi runner.
    Please refer <a href="https://siddhi.io/en/v5.1/docs/config-guide/#adding-to-siddhi-local-microservice">this</a> for information.</p>
</li>
<li>
<p>Start Siddhi app with the runner config by executing the following commands from the distribution directory.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Linux/Mac : ./bin/runner.sh -Dapps=&lt;siddhi-file-path&gt; 
Windows : bin\runner.bat -Dapps=&lt;siddhi-file-path&gt; 

   Eg: If exported siddhi app in Siddhi home directory,
       ./bin/runner.sh -Dapps=Taxi-Rider-Requests-Processing-App.siddhi
</pre></div>
</td></tr></table>

<p><img alt="siddhi_runner_console" src="../images/siddhi-runner-console.png" title="Siddhi Runner Console" /> </p>
</li>
<li>
<p>Once server is started, download the sample TCP event generator from <a href="https://github.com/mohanvive/siddhi-sample-clients/releases/download/v1.0.0/tcp-producer-1.0.0-jar-with-dependencies.jar">here</a> and execute below command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>java -jar tcp-producer-1.0.0-jar-with-dependencies.jar tcp://localhost:9892/taxiRideRequests
</pre></div>
</td></tr></table>

<p>Above event publishes send binary events through TCP to the TCP endpoint defined in the Siddhi application. You can change the TCP endpoint url by passing them as java arguments. If not, sample client consider <code>tcp://localhost:9892/taxiRideRequests</code> as the TCP endpoint url.</p>
<div class="admonition info">
<p class="admonition-title">You can find the sample client source code in <a href="https://github.com/mohanvive/siddhi-sample-clients">here</a></p>
</div>
</li>
<li>
<p>In this situation, you can find the logs printed in the Siddhi runner console/log, events related to <code>NeedMoreRidersStream</code>  are stored in the database table and escalation email is sent to the manager when there is an increasing trend found in the cancellations.</p>
<p><img alt="instant_offer_in_logs" src="../images/instant-offer-in-logs.png" title="Instant Offers to Premium Users" /></p>
<p><img alt="need_more_riders_table" src="../images/need-more-riders-table.png" title="Need More Riders Data in Database" /></p>
<p><img alt="escalation_email_alert" src="../images/escalation-email-alert.png" title="Escalation Mail to Manager" /></p>
</li>
</ol>
<h3 id="deploy-on-docker">Deploy on Docker<a class="headerlink" href="#deploy-on-docker" title="Permanent link">&para;</a></h3>
<h4 id="prerequisites_2">Prerequisites<a class="headerlink" href="#prerequisites_2" title="Permanent link">&para;</a></h4>
<p>MySQL is an external dependency for this use case. Hence, you could use the corresponding MySQL docker artifact to test the requirement.</p>
<ol>
<li>
<p>First, you can create a docker network for the deployment as shown below
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker network create siddhi-tier --driver bridge
</pre></div>
</td></tr></table></p>
</li>
<li>
<p>Then, you can get the MySQL docker image from <a href="https://hub.docker.com/_/mysql">here</a> and run it with below command. We are going to use mysql version 5.7.27.</p>
<p><img alt="mysql_docker_pull" src="../images/mysql-docker-pull.png" title="MySQL Docker Pull Command" /></p>
</li>
<li>
<p>Start the MySQL docker images with below command,</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker run --name mysql-server --network siddhi-tier -e MYSQL_ROOT_PASSWORD=root e1e1680ac726
</pre></div>
</td></tr></table>

<div class="admonition info">
<p class="admonition-title"><code>e1e1680ac726</code> is the MySQL docker image id in this case</p>
</div>
</li>
<li>
<p>Login to the MySQL docker instance and create a database called “MyTaxi”.</p>
<p><img alt="db_creation" src="../images/db_creation.png" title="Create MyTaxi Database in MySQL" /> </p>
</li>
<li>
<p>Now, you have configured necessary prerequisites that required to run the use case. </p>
</li>
</ol>
<h4 id="siddhi-docker-configuration">Siddhi Docker Configuration<a class="headerlink" href="#siddhi-docker-configuration" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>Since, MySQL client jar is required for the Siddhi runner; you have to create the docker image accordingly. Below is the sample Docker file created</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>FROM siddhiio/siddhi-runner-base-alpine:5.1.0-alpha
MAINTAINER Siddhi IO Docker Maintainers &quot;siddhi-dev@googlegroups.com&quot;

ARG HOST_BUNDLES_DIR=./files/bundles
ARG HOST_JARS_DIR=./files/jars
ARG JARS=${RUNTIME_SERVER_HOME}/jars
ARG BUNDLES=${RUNTIME_SERVER_HOME}/bundles

# copy bundles &amp; jars to the siddhi-runner distribution
COPY --chown=siddhi_user:siddhi_io ${HOST_JARS_DIR}/ ${JARS}

# expose ports
EXPOSE 9090 9443 9712 9612 7711 7611 7070 7443

RUN bash ${RUNTIME_SERVER_HOME}/bin/install-jars.sh

STOPSIGNAL SIGINT

ENTRYPOINT [&quot;/home/siddhi_user/siddhi-runner/bin/runner.sh&quot;,  &quot;--&quot;]
</pre></div>
</td></tr></table>

<p>Here, you have to create a folder called <code>jars</code> to add necessary external client dependencies to the docker image.</p>
<p><img alt="directory_tree_structure" src="../images/tree-structure.png" title="Directory Tree Structure" /> </p>
<p>You can refer the official Siddhi documentation <a href="https://siddhi.io/en/v5.1/docs/config-guide/#adding-to-siddhi-docker-microservice">reference</a> for this purpose.</p>
</li>
<li>
<p>Once, Dockerfile is created you can create the docker image with below command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker build -t siddhi_mysql .
</pre></div>
</td></tr></table>

</li>
<li>
<p>Then, you can run the Siddhi docker image that you created with necessary external dependencies to work with MySQL. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker run --network siddhi-tier -it -p 9892:9892  -v /Users/mohan/siddhi-apps/:/siddhi-apps  -e MYSQL_DB_URL=jdbc:mysql://mysql-server:3306/MyTaxi -e MYSQL_USERNAME=root -e MYSQL_PASSWORD=root -e EMAIL_USERNAME=siddhi.gke.user -e EMAIL_PASSWORD=siddhi123 -e SENDER_EMAIL_ADDRESS=siddhi.gke.user@gmail.com -e MANAGER_EMAIL_ADDRESS=mohan@wso2.com siddhi_mysql:latest -Dapps=/siddhi-apps/Taxi-Rider-Requests-Processing-App.siddhi
</pre></div>
</td></tr></table>

<p>Note: In the above provided Siddhi app, there are some environmental variables (MYSQL_DB_URL, MYSQL_USERNAME, and  MYSQL_PASSWORD)  are used. These values are required to be set to try out the scenario end to end. MYSQL related environmental variables are required to store the events of stream <code>NeedMoreRidersStream</code> . Environmental variables EMAIL_PASSWORD, EMAIL_USERNAME, SENDER_EMAIL_ADDRESS and MANAGER_EMAIL_ADDRESS  are used to send an email alert when there is an increasing trend of cancellation on specific area. </p>
</li>
<li>
<p>You can use the sample <a href="https://github.com/mohanvive/siddhi-sample-clients/releases/download/v1.0.0/tcp-producer-1.0.0-jar-with-dependencies.jar">TCP event publisher</a>  to simulate required events. Use the below command to publish events to TCP endpoint.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>java -jar tcp-producer-1.0.0-jar-with-dependencies.jar tcp://localhost:9892/taxiRideRequests
</pre></div>
</td></tr></table>

</li>
<li>
<p>Then, you could see below logs get printed in the Siddhi runner console/log, events related to <code>NeedMoreRidersStream</code>  are stored in the database table and escalation email is sent to the manager when there is an increasing trend found in the cancellations. </p>
<p><img alt="docker_instant_offer_in_logs" src="../images/docker-instant-offer-in-logs.png" title="Instant Offers to Premium Users" /></p>
<p><img alt="docker_need_more_riders_table" src="../images/docker-need-more-riders-table.png" title="Need More Riders Data in Database" /></p>
<p><img alt="docker_escalation_email_alert" src="../images/docker-escalation-email-alert.png" title="Escalation Mail to Manager" /></p>
</li>
</ol>
<h3 id="deploy-on-kubernetes">Deploy on Kubernetes<a class="headerlink" href="#deploy-on-kubernetes" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>It is advisable to create a namespace in Kubernetes to follow below steps.
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl create ns siddhi-mysql-test
</pre></div>
</td></tr></table></p>
</li>
<li>
<p>There is a prerequisite that you should meet to tryout below SiddhiProcess; configuring MySQL database server within the above created namespace. You can use the official <a href="https://github.com/helm/charts/tree/master/stable/mysql">helm chart</a> provided for MySQL.</p>
<ul>
<li>
<p>First, install the MySQL helm chart as shown below,
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>helm install --name mysql-db --namespace=siddhi-mysql-test --set mysqlRootPassword=root,mysqlDatabase=MyTaxi stable/mysql
</pre></div>
</td></tr></table></p>
<p>Here, you can define the root password to connect to the MYSQL database and also define the database name. BTW, make sure to do <code>helm init</code> if it is not done yet.</p>
</li>
<li>
<p>Then, you can set a port forwarding to the MySQL service which allows you to connect from the Host.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl port-forward svc/mysql-db 13306:3306 --namespace=siddhi-mysql-test
</pre></div>
</td></tr></table>

</li>
<li>
<p>Then, you can login to the MySQL server from your host machine as shown below.</p>
<p><img alt="docke_mysql_db_indo" src="../images/k8s-mysql-db-info.png" title="MySQL Docker Database Details" /> </p>
</li>
</ul>
</li>
<li>
<p>Then, you can install Siddhi Operator</p>
<ul>
<li>
<p>To install the Siddhi Kubernetes operator run the following commands.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl apply -f https://github.com/siddhi-io/siddhi-operator/releases/download/v0.2.0-alpha/00-prereqs.yaml  --namespace=siddhi-mysql-test
kubectl apply -f https://github.com/siddhi-io/siddhi-operator/releases/download/v0.2.0-alpha/01-siddhi-operator.yaml --namespace=siddhi-mysql-test
</pre></div>
</td></tr></table>

</li>
<li>
<p>You can verify the installation by making sure the following deployments are running in your Kubernetes cluster.</p>
<p><img alt="kubernetes_siddhi-pods-svc" src="../images/k8s-pods-and-svc.png" title="K8S Siddhi Pods &amp; Services" /></p>
</li>
</ul>
</li>
<li>
<p>Siddhi applications can be deployed on Kubernetes using the Siddhi operator.</p>
<ul>
<li>
<p>To deploy the above created Siddhi app, we have to create custom resource object yaml file (with the kind as SiddhiProcess) as given below</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">siddhi.io/v1alpha2</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SiddhiProcess</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">taxi-rider-requests-processing-app</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">apps</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">script</span><span class="p">:</span> <span class="p p-Indicator">|</span>
        <span class="no">@App:name(&quot;Taxi-Rider-Requests-Processing-App&quot;)</span>
        <span class="no">@App:description(&quot;Siddhi application that processes Taxi Rider request events&quot;)</span>

        <span class="no">-- TCP source which accepts Taxi rider requests</span>
        <span class="no">@source(type=&#39;tcp&#39;, context=&#39;taxiRideRequests&#39;, @map(type=&#39;binary&#39;))</span>
        <span class="no">define stream TaxiRideEventStream(id long, time string, passengerId string, passengerName string, pickUpAddress string, pickUpZone string, </span>
        <span class="no">dropOutAddress string, routingDetails string, expectedFare double, status string, passengerGrade string, additionalNote string);</span>

        <span class="no">-- For testing purposes, offer messages are logged in console. </span>
        <span class="no">-- This could be further extended to send as sms to the premium users</span>
        <span class="no">@sink(type=&#39;log&#39;, @map(type = &#39;text&#39;, </span>
            <span class="no">@payload(&quot;&quot;&quot;</span>
        <span class="no">Hi {{passengerName}}</span>

            <span class="no">Unfortunately, you couldn&#39;t travel with us Today. We apologise for the high waiting time.</span>
            <span class="no">As a token of apology please accept {{offerAmount}} USD off from your next ride.</span>

        <span class="no">Truly, </span>
        <span class="no">MyTaxi Team&quot;&quot;&quot;)))</span>
        <span class="no">define stream InstantOfferAlertStream(passengerName string, pickUpZone string, offerAmount double);</span>

        <span class="no">-- RDBMS event table which stores events related to the requirement of need more riders</span>
        <span class="no">@store(type=&quot;rdbms&quot;, jdbc.url=&quot;${MYSQL_DB_URL}&quot;, username=&quot;${MYSQL_USERNAME}&quot;, password=&quot;${MYSQL_PASSWORD}&quot; , jdbc.driver.name=&quot;com.mysql.jdbc.Driver&quot;)</span>
        <span class="no">define table NeedMoreRidersTable (systemTime string, zone string);</span>

        <span class="no">-- Email sink which send email alerts to the manager of MyTaxi</span>
        <span class="no">@sink(type = &#39;email&#39;, username = &quot;${EMAIL_USERNAME}&quot;, address = &quot;${SENDER_EMAIL_ADDRESS}&quot;, password = &quot;${EMAIL_PASSWORD}&quot;, </span>
        <span class="no">subject = &quot;[Need Immediate Attention] High Waiting Time&quot;, to = &quot;${MANAGER_EMAIL_ADDRESS}&quot;, host = &quot;smtp.gmail.com&quot;, port = &quot;465&quot;, ssl.enable = &quot;true&quot;, auth = &quot;true&quot;, </span>
          <span class="no">@map(type = &#39;text&#39;, </span>
            <span class="no">@payload(&quot;&quot;&quot;</span>
        <span class="no">Hi,</span>

            <span class="no">There is an increasing trend of ride cancellations in the {{zone}} area due to high waiting time.  </span>
            <span class="no">Increasing trend is detected at {{systemTime}}.</span>
            <span class="no">Please take immediate action to sort this out.</span>

        <span class="no">Thanks...&quot;&quot;&quot;)))</span>
        <span class="no">define stream AttentionRequiredCancellationStream (systemTime string, zone string, lastNoOfCancellations long);</span>

        <span class="no">@info(name=&#39;Ride-cancellation-identifier&#39;) </span>
        <span class="no">from every e1=TaxiRideEventStream[status == &#39;Assigned&#39;] -&gt; </span>
                <span class="no">e2=TaxiRideEventStream[e1.passengerId == passengerId and status == &#39;Cancelled&#39; and additionalNote == &#39;WT is High&#39;]</span>
                <span class="no">within 30 seconds </span>
        <span class="no">select e2.passengerName, e1.passengerGrade, e1.pickUpZone, e1.expectedFare</span>
        <span class="no">insert into TaxiRideCancelStream;</span>

        <span class="no">@info(name=&#39;Offer-for-premium-users&#39;) </span>
        <span class="no">from TaxiRideCancelStream[passengerGrade == &#39;Premium&#39;]</span>
        <span class="no">select passengerName, pickUpZone, math:floor(expectedFare) / 2.0 as offerAmount</span>
        <span class="no">insert into InstantOfferAlertStream;</span>

        <span class="no">@info(name=&#39;Frequently-ride-cancellation-identifier&#39;) </span>
        <span class="no">from TaxiRideCancelStream#window.timeBatch(1 min)</span>
        <span class="no">select pickUpZone, count() as totalCancellations, time:currentTimestamp() as systemTime</span>
        <span class="no">group by pickUpZone</span>
        <span class="no">having totalCancellations &gt; 3</span>
        <span class="no">insert into NeedMoreRidersStream;</span>

        <span class="no">@info(name=&#39;Dump-needMoreRider-events&#39;) </span>
        <span class="no">from NeedMoreRidersStream</span>
        <span class="no">select systemTime, pickUpZone as zone</span>
        <span class="no">insert into NeedMoreRidersTable;</span>

        <span class="no">@info(name=&#39;Ride-cancellation-increasing-trend-identifer&#39;) </span>
        <span class="no">partition with (pickUpZone of NeedMoreRidersStream)</span>
        <span class="no">begin</span>
            <span class="no">from e1 = NeedMoreRidersStream, e2 = NeedMoreRidersStream[totalCancellations &gt; e1.totalCancellations], </span>
                <span class="no">e3 = NeedMoreRidersStream[totalCancellations &gt; e2.totalCancellations]</span>
            <span class="no">select e3.systemTime, e1.pickUpZone as zone, e3.totalCancellations as lastNoOfCancellations</span>
            <span class="no">insert into AttentionRequiredCancellationStream;</span>
        <span class="no">end; </span>

  <span class="nt">persistentVolumeClaim</span><span class="p">:</span> 
      <span class="nt">accessModes</span><span class="p">:</span> 
        <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
      <span class="nt">resources</span><span class="p">:</span> 
        <span class="nt">requests</span><span class="p">:</span> 
          <span class="nt">storage</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">1Gi</span>
      <span class="nt">storageClassName</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">hostpath</span>
      <span class="nt">volumeMode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Filesystem</span>

  <span class="nt">container</span><span class="p">:</span>
    <span class="nt">env</span><span class="p">:</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_DB_URL</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;jdbc:mysql://mysql-db:3306/MyTaxi&quot;</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_USERNAME</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;root&quot;</span>
      <span class="p p-Indicator">-</span> 
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_PASSWORD</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;root&quot;</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL_PASSWORD</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;siddhi123&quot;</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">EMAIL_USERNAME</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;siddhi.gke.user&quot;</span>
      <span class="p p-Indicator">-</span> 
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SENDER_EMAIL_ADDRESS</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;siddhi.gke.user@gmail.com&quot;</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MANAGER_EMAIL_ADDRESS</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;mohan@wso2.com&quot;</span>

    <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;mohanvive/siddhi_mysql:latest&quot;</span>        
</pre></div>
</td></tr></table>

<p>Note: In the above provided Siddhi app, there are some environmental variables (MYSQL_DB_URL, MYSQL_USERNAME, and  MYSQL_PASSWORD)  are used. These values are required to be set to try out the scenario end to end. MYSQL related environmental variables are required to store the events of stream <code>NeedMoreRidersStream</code> . Environmental variables EMAIL_PASSWORD, EMAIL_USERNAME, SENDER_EMAIL_ADDRESS and MANAGER_EMAIL_ADDRESS  are used to send an email alert when there is an increasing trend of cancellation on specific area. Hence, make sure to add proper values for the environmental variables in the above yaml file (check the ‘env’ section of the yaml file).</p>
<p>Here, you can use the docker image that created in the  section since you need a docker images with required extensions and client jars to test it in Kubernetes.</p>
</li>
<li>
<p>Now,  let’s create the above resource in the Kubernetes  cluster with below command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl --namespace=siddhi-mysql-test create -f &lt;absolute-yaml-file-path&gt;/taxi-rider-requests-processing-app.yaml
</pre></div>
</td></tr></table>

<p>Once, siddhi app is successfully deployed. You can verify its health with below Kubernetes commands</p>
<p><img alt="kubernetes_pods_with_mysql" src="../images/k8s-pods-with-siddhi.png" title="Kubernetes Deployment &amp; Pods" /></p>
</li>
<li>
<p>You can find the alert logs in the siddhi runner log file. To see the Siddhi runner log file, you can invoke below command.
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl get pods
</pre></div>
</td></tr></table></p>
<p>Then, find the pod name of the siddhi app deployed. Then invoke below command,</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl logs &lt;siddhi-app-pod-name&gt; -f
</pre></div>
</td></tr></table>

</li>
<li>
<p>Then, you can set a port forwarding to the Siddhi TCP endpoint which allows you to connect from the Host with below command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl port-forward svc/taxi-rider-requests-processing-app-0 9892:9892 --namespace=siddhi-mysql-test   
</pre></div>
</td></tr></table>

<p><img alt="tco_port_forwarding" src="../images/tcp-port-forwarding.png" title="Kubernetes TCP Port Forwarding" /></p>
</li>
<li>
<p>Then execute below command to send TCP events to Siddhi Stream Processor.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>java -jar tcp-producer-1.0.0-jar-with-dependencies.jar tcp://0.0.0.0:9892/taxiRideRequests
</pre></div>
</td></tr></table>

</li>
<li>
<p>Then, you could see below logs get printed in the Siddhi runner console/log, events related to <code>NeedMoreRidersStream</code>  are stored in the database table and escalation email is sent to the manager when there is an increasing trend found in the cancellations.  </p>
<p><img alt="k8s_instant_offer_in_logs" src="../images/k8s-instant-offer-in-logs.png" title="Instant Offers to Premium Users" /></p>
<p><img alt="k8s_need_more_riders_table" src="../images/k8s-need-more-riders-table.png" title="Need More Riders Data in Database" /></p>
<p><img alt="k8s_escalation_email_alert" src="../images/k8s-escalation-email-alert.png" title="Escalation Mail to Manager" /></p>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Refer <a href="https://siddhi.io/en/v5.1/docs/siddhi-as-a-kubernetes-microservice/">here</a> to get more details about running Siddhi on Kubernetes.</p>
</div>
</li>
</ol>
                
                  
                
              
  <a href="#" class="cd-top text--replace js-cd-top">Top</a>

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../fault-tolerance/guide/" title="Fault Tolerance & Error Handling" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Fault Tolerance & Error Handling
              </span>
            </div>
          </a>
        
        
          <a href="../../database-static-rule-processing/guide/" title="Static Rule Processing using Database Rules" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Static Rule Processing using Database Rules
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Siddhi - Documentation
          </div>
        
        &copy;2019 <a href="https://wso2.com/">WSO2</a>
      </div>
      
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
    
      <a href="/community/#community-collaboration" class="md-footer-social__link fa fa-slack"></a>
    
      <a href="https://github.com/siddhi-io/siddhi" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://medium.com/siddhi-io" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://twitter.com/siddhi_io" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/groups/13553064" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
        <script src="../../../../assets/lib/highlightjs/highlight.min.js"></script>
      
        <script src="../../../../assets/js/theme.js"></script>
      
        <script src="../../../../assets/lib/backtotop/js/util.js"></script>
      
        <script src="../../../../assets/lib/backtotop/js/main.js"></script>
      
    
  </body>
</html>