<!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->





<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cloud Native Stream Processor">
      
      
        <link rel="canonical" href="http://siddhi.io/en/v5.1/docs/guides/integrate-various-enterprise-systems/guide/">
      
      
        <meta name="author" content="WSO2">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Integrate Various Enterprise Systems - Siddhi</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../../assets/lib/highlightjs/default.min.css">
    
      <link rel="stylesheet" href="../../../../assets/css/theme.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-103065-28", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#retrieve-and-publish-data-fromto-various-enterprise-systems" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->

<header class="md-header" data-md-component="header" id="page-header" data-url=""
        data-lang="en">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://siddhi.io/en/v5.1/" title="Siddhi"
           class="md-header-nav__button md-logo">
          
            <img src="../../../../images/siddhi-logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Siddhi
            </span>
            <span class="md-header-nav__topic">
              Integrate Various Enterprise Systems
            </span>
          
        </div>
        <div class="md-flex__ellipsis md-header__version-select">
            <div class="mb-tabs__dropdown version-select">
                <a class="md-tabs__link md-tabs__dropdown-link" href="#!" data-target="version-select-dropdown">
                  v5.1</a>
                <ul id="version-select-dropdown" class="mb-tabs__dropdown-content" tabindex="0">
                    <!-- Versions will added here dynamically -->
                    <li class="md-tabs__item mb-tabs__dropdown">
                        <a href="#" id="show-all-versions-link">Show all</a>
                    </li>
                </ul>
            </div>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
        </div>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
        <li class="md-tabs__item home_icon">
            <a href="/" title="Siddhi Home" class="md-tabs__link md-tabs__link--active">
                <i class="fa fa-home"></i>
            </a>
        </li>
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../download/" title="Download" class="md-tabs__link">
          Download
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../quick-start/" title="Quick Start" class="md-tabs__link">
          Quick Start
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../" title="Documentation" class="md-tabs__link md-tabs__link--active">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/community/" title="Community" class="md-tabs__link">
          Community
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../development/" title="Development" class="md-tabs__link">
          Development
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/license/" title="License" class="md-tabs__link">
          License
        </a>
      
    </li>
  

      
    </ul>
    <div class="quick_links">
        
        <a href="https://github.com/siddhi-io/www/edit/v5.1/en/docs/docs/guides/integrate-various-enterprise-systems/guide.md" target="blank" id="editIcon" title="Edit this page"
           title="Edit this page" class="md-icon md-content__icon nav_link edit_link"></a>
        
    </div>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
    <label class="md-nav__title md-nav__title--site" for="__drawer">
      <a href="http://siddhi.io/en/v5.1/" title="Siddhi"
         class="md-nav__button md-logo">
        
          <img src="../../../../images/siddhi-logo.svg" width="48" height="48">
        
      </a>
      Siddhi
    </label>
    
      <div class="md-nav__source">
        


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
      </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Download
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Download
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Quick Start
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Quick Start
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4" checked>
    
    <label class="md-nav__link" for="nav-3-4">
      Use case Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Use case Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../alerts-for-thresholds/guide/" title="Alerts Based on Thresholds" class="md-nav__link">
      Alerts Based on Thresholds
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fault-tolerance/guide/" title="Fault Tolerance & Error Handling" class="md-nav__link">
      Fault Tolerance & Error Handling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns-and-trends/guide/" title="Patterns & Trends Over Time" class="md-nav__link">
      Patterns & Trends Over Time
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database-static-rule-processing/guide/" title="Static Rule Processing using Database Rules" class="md-nav__link">
      Static Rule Processing using Database Rules
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Integrate Various Enterprise Systems
      </label>
    
    <a href="./" title="Integrate Various Enterprise Systems" class="md-nav__link md-nav__link--active">
      Integrate Various Enterprise Systems
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scenario" title="Scenario" class="md-nav__link">
    Scenario
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" title="What You'll Build" class="md-nav__link">
    What You'll Build
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vehicle-locator-subsystem" title="Vehicle Locator Subsystem" class="md-nav__link">
    Vehicle Locator Subsystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notifier-subsystem" title="Notifier Subsystem" class="md-nav__link">
    Notifier Subsystem
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-requirements" title="Mandatory Requirements" class="md-nav__link">
    Mandatory Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Requirements needed to deploy Siddhi in Docker/Kubernetes" class="md-nav__link">
    Requirements needed to deploy Siddhi in Docker/Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vehicle-locator" title="Vehicle Locator" class="md-nav__link">
    Vehicle Locator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notifier" title="Notifier" class="md-nav__link">
    Notifier
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-mongodb" title="Setup MongoDB" class="md-nav__link">
    Setup MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-mysql" title="Setup MySQL" class="md-nav__link">
    Setup MySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-nats-streaming-cluster" title="Setup NATS Streaming Cluster" class="md-nav__link">
    Setup NATS Streaming Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configurations" title="Configurations" class="md-nav__link">
    Configurations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tryout" title="Tryout" class="md-nav__link">
    Tryout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-on-vm-bare-metal" title="Deploy on VM/ Bare Metal" class="md-nav__link">
    Deploy on VM/ Bare Metal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-docker" title="Deploy on Docker" class="md-nav__link">
    Deploy on Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisite" title="Prerequisite" class="md-nav__link">
    Prerequisite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-docker-configurations" title="Siddhi Docker Configurations" class="md-nav__link">
    Siddhi Docker Configurations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-kubernetes" title="Deploy on Kubernetes" class="md-nav__link">
    Deploy on Kubernetes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-kubernetes-configurations" title="Siddhi Kubernetes Configurations" class="md-nav__link">
    Siddhi Kubernetes Configurations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-mongodb_1" title="Setup MongoDB" class="md-nav__link">
    Setup MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-mysql_1" title="Setup MySQL" class="md-nav__link">
    Setup MySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-nats-streaming" title="Setup NATS Streaming" class="md-nav__link">
    Setup NATS Streaming
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-siddhi-operator" title="Setup Siddhi Operator" class="md-nav__link">
    Setup Siddhi Operator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../realtime-movie-recommendation/guide/" title="Realtime predictions with pre-trained ML models" class="md-nav__link">
      Realtime predictions with pre-trained ML models
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tooling/" title="Tooling" class="md-nav__link">
      Tooling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../query-guide/" title="Query Guide" class="md-nav__link">
      Query Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Siddhi APIs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Siddhi APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/latest/" title="latest" class="md-nav__link">
      latest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/5.1.0/" title="5.1.0" class="md-nav__link">
      5.1.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">
    
    <label class="md-nav__link" for="nav-3-8">
      REST API Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        REST API Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/siddhi-app-api/" title="Siddhi App APIs" class="md-nav__link">
      Siddhi App APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/on-demand-query-api/" title="On-Demand Query APIs" class="md-nav__link">
      On-Demand Query APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/health-check-api/" title="Health Check APIs" class="md-nav__link">
      Health Check APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/store-api/" title="Store APIs (Deprecated)" class="md-nav__link">
      Store APIs (Deprecated)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/default-ports/" title="Default Ports" class="md-nav__link">
      Default Ports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/http-status-code/" title="HTTP Status Codes" class="md-nav__link">
      HTTP Status Codes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-java-library/" title="Siddhi Java library" class="md-nav__link">
      Siddhi Java library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-local-microservice/" title="Siddhi Local Microservice" class="md-nav__link">
      Siddhi Local Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-docker-microservice/" title="Siddhi Docker Microservice" class="md-nav__link">
      Siddhi Docker Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-kubernetes-microservice/" title="Siddhi Kubernetes Microservice" class="md-nav__link">
      Siddhi Kubernetes Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../config-guide/" title="Configuration Guide" class="md-nav__link">
      Configuration Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Community
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Community
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/source/" title="Source" class="md-nav__link">
      Source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/build/" title="Build" class="md-nav__link">
      Build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      License
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        License
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
    </ul>
  </nav>  
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scenario" title="Scenario" class="md-nav__link">
    Scenario
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" title="What You'll Build" class="md-nav__link">
    What You'll Build
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vehicle-locator-subsystem" title="Vehicle Locator Subsystem" class="md-nav__link">
    Vehicle Locator Subsystem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notifier-subsystem" title="Notifier Subsystem" class="md-nav__link">
    Notifier Subsystem
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-requirements" title="Mandatory Requirements" class="md-nav__link">
    Mandatory Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Requirements needed to deploy Siddhi in Docker/Kubernetes" class="md-nav__link">
    Requirements needed to deploy Siddhi in Docker/Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#vehicle-locator" title="Vehicle Locator" class="md-nav__link">
    Vehicle Locator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#notifier" title="Notifier" class="md-nav__link">
    Notifier
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-mongodb" title="Setup MongoDB" class="md-nav__link">
    Setup MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-mysql" title="Setup MySQL" class="md-nav__link">
    Setup MySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-nats-streaming-cluster" title="Setup NATS Streaming Cluster" class="md-nav__link">
    Setup NATS Streaming Cluster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configurations" title="Configurations" class="md-nav__link">
    Configurations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tryout" title="Tryout" class="md-nav__link">
    Tryout
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-on-vm-bare-metal" title="Deploy on VM/ Bare Metal" class="md-nav__link">
    Deploy on VM/ Bare Metal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-docker" title="Deploy on Docker" class="md-nav__link">
    Deploy on Docker
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisite" title="Prerequisite" class="md-nav__link">
    Prerequisite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-docker-configurations" title="Siddhi Docker Configurations" class="md-nav__link">
    Siddhi Docker Configurations
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-kubernetes" title="Deploy on Kubernetes" class="md-nav__link">
    Deploy on Kubernetes
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites_1" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#siddhi-kubernetes-configurations" title="Siddhi Kubernetes Configurations" class="md-nav__link">
    Siddhi Kubernetes Configurations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-mongodb_1" title="Setup MongoDB" class="md-nav__link">
    Setup MongoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-mysql_1" title="Setup MySQL" class="md-nav__link">
    Setup MySQL
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-nats-streaming" title="Setup NATS Streaming" class="md-nav__link">
    Setup NATS Streaming
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-siddhi-operator" title="Setup Siddhi Operator" class="md-nav__link">
    Setup Siddhi Operator
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
  
                
                  <a href="https://github.com/siddhi-io/www/edit/v5.1/en/docs/docs/guides/integrate-various-enterprise-systems/guide.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="retrieve-and-publish-data-fromto-various-enterprise-systems">Retrieve and Publish Data from/to Various Enterprise Systems<a class="headerlink" href="#retrieve-and-publish-data-fromto-various-enterprise-systems" title="Permanent link">&para;</a></h1>
<p>This guide illustrates how you can receive data from various enterprise systems, process it, and then send processed data into other systems.</p>
<h2 id="scenario">Scenario<a class="headerlink" href="#scenario" title="Permanent link">&para;</a></h2>
<p>Paris becomes very busy in the rush hours. Most of the people trying to go to offices in the morning and children try to go to school. In the afternoon all those people trying to go back to their premises. The traffic becomes high in those hours. If there is a bad weather condition in those rush hours the traffic might increase up to a certain level.</p>
<p>Partis Transport Management Authority (Paris TMA) is accountable for handling all the traffic in Paris. They have noticed this increase in traffic due to the bad weather conditions in several areas. To reduce this traffic, they try to build a system that notifies all users if there are bad weather conditions in a particular area. Paris TMA uses a centralized database to receive notifications about bad weather conditions. Besides, they are tracking locations of all the vehicles in Paris city. If some incident happens, this system will notify all the users that are near to that area.</p>
<p>After completing this guide you will understand how to receive various inputs from heterogeneous systems (like NATS, RDBMS, MongoDB), process it, and send back processed outputs in various formats like Email notification.</p>
<h2 id="what-youll-build">What You'll Build<a class="headerlink" href="#what-youll-build" title="Permanent link">&para;</a></h2>
<p>The implementation of the ParisTMA system represented in the following architecture diagram. The overall architecture can be expressed as the following subsystems.</p>
<h3 id="vehicle-locator-subsystem">Vehicle Locator Subsystem<a class="headerlink" href="#vehicle-locator-subsystem" title="Permanent link">&para;</a></h3>
<p>The vehicle locator subsystem is responsible for receiving the location of each subscriber and update subscriber database collection with their current location. The process of this subsystem showed in step 01-03 in the architecture diagram. The location of a vehicle, input to the NATS cluster as a JSON object like below.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;vehicleId&quot;</span><span class="p">:</span> <span class="s2">&quot;v001&quot;</span><span class="p">,</span>
    <span class="nt">&quot;currentArea&quot;</span><span class="p">:</span> <span class="s2">&quot;a002&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>The Siddhi app called ParisTMAVehicleLocator will listen to those messages that come to the NATS cluster and periodically update the Mongo database with those current locations. This Mongo database contained all the information relevant to subscribers along with their current location.</p>
<h3 id="notifier-subsystem">Notifier Subsystem<a class="headerlink" href="#notifier-subsystem" title="Permanent link">&para;</a></h3>
<p>The process of the notifier subsystem illustrated in step 04-07 in the architecture diagram. The notifier subsystem triggers the process when our system receives weather update to the RDBMS as shown in step 04. The ParisTMANotifier Siddhi app will handle all the logical execution of this notification process. There exists a <a href="https://github.com/siddhi-io/siddhi-io-cdc">CDC</a> source which listens to the changes of the RDBMS. When some weather notification inserts into the RDBMS, the ParisTMANotifier Siddhi app retrieves this insert event. That insert event will contain the area that this weather incident happened. Using that area, ParisTMANotifier filters out all the subscribers that are in that given area using the subscriber collection in the Mongo database. To all those subscribers ParisTMANotifier will send an email notification about this incident.</p>
<p><img alt="Architecture Diagram" src="../images/architecture.png" title="Architecture Diagram" /></p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<h3 id="mandatory-requirements">Mandatory Requirements<a class="headerlink" href="#mandatory-requirements" title="Permanent link">&para;</a></h3>
<ol>
<li><a href="https://siddhi.io/en/v5.1/download/">Siddhi tooling VM/Local distribution</a></li>
<li>One of the <a href="https://siddhi.io/en/v5.1/download/">Siddhi runner distributions</a><ol>
<li>VM/Local Runtime</li>
<li>Docker Image</li>
<li>K8s Operator (commands are given in deployment section)</li>
</ol>
</li>
<li><a href="https://www.mysql.com/">MySQL database</a></li>
<li><a href="https://docs.mongodb.com/manual/installation/">Mongo database</a></li>
<li><a href="https://nats-io.github.io/docs/nats_streaming/gettingstarted/install.html">NATS streaming server</a></li>
<li><a href="https://www.oracle.com/java/technologies/jdk8-downloads.html">Java 8</a> or higher</li>
</ol>
<h3 id="requirements-needed-to-deploy-siddhi-in-dockerkubernetes">Requirements needed to deploy Siddhi in Docker/Kubernetes<a class="headerlink" href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Permanent link">&para;</a></h3>
<ol>
<li><a href="https://docs.docker.com/install/">Docker</a></li>
<li>Kubernetes cluster<ol>
<li><a href="https://github.com/kubernetes/minikube#installation">Minikube</a></li>
<li><a href="https://console.cloud.google.com">Google Kubernetes Engine(GKE)</a></li>
<li><a href="https://docs.docker.com/docker-for-mac/install/">Docker for Mac</a></li>
</ol>
</li>
<li><a href="https://helm.sh/docs/using_helm/">Helm</a></li>
<li>Refer to <a href="https://github.com/siddhi-io/siddhi-operator/blob/master/docs/gke-setup.md">this documentation about Configuring a Google Kubernetes Engine (GKE) Cluster</a> to deploy Siddhi apps in GKE.</li>
</ol>
<h2 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h2>
<p>As illustrated in the previous architecture diagram you will need Siddhi apps called ParisTMAVehicleLocator and ParisTMANotifier.</p>
<ol>
<li>Start the <a href="https://siddhi.io/en/v5.0/docs/tooling/">Siddhi tooling</a> runtime and go to the editor UI in http://localhost:9390/editor</li>
<li>Use the following steps to start the Siddhi tooling runtime. Extract the downloaded zip and navigate to /bin. (TOOLING_HOME refers to the extracted folder). Use the following command in the command prompt (Windows) / terminal (Linux/Mac).
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>For Windows: tooling.bat
For Linux/Mac: ./tooling.sh
</pre></div>
</td></tr></table></li>
<li>Select File -&gt; New option, then you could either use the source view or design view to write/build the Siddhi Application. You can find the Siddhi Application bellow, that implements the requirements mentioned above.</li>
</ol>
<p>Let’s write (develop) the Siddhi Application, as given below.</p>
<p>Once the Siddhi app is created, you can use the Event Simulator option in the editor to simulate events to streams and perform developer testing. The implementation of those apps is described in the following subtopics.</p>
<div class="admonition note">
<p class="admonition-title">Siddhi Query Guide</p>
<p>The execution steps and the logic of the Siddhi query described as comments in the following Siddhi app. Therefore here we are not going to explain in detail here. For more details about Siddhi queries please refer <a href="https://siddhi.io/en/v5.1/docs/query-guide/">Siddhi query guide</a>.</p>
</div>
<h3 id="vehicle-locator">Vehicle Locator<a class="headerlink" href="#vehicle-locator" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">name</span><span class="p">(</span><span class="ss">&quot;ParisTMAVehicleLocator&quot;</span><span class="p">)</span>
<span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">description</span><span class="p">(</span><span class="ss">&quot;Listen to the events send by NATS about vehicle locations and periodically update the Mongo database.&quot;</span><span class="p">)</span>

<span class="cm">/*</span>
<span class="cm">Purpose:</span>
<span class="cm">    The ParisTMA has subscribers that subscribe to get the service. All the subscriber details are saved in the Mongo database. In that database ParisTMA stores the current location of subscriber vehicles. The events related to current locations come as TCP requests through NATS. This app listens to those events and eventually update the database with the current location of each subscriber.</span>

<span class="cm">Input:</span>
<span class="cm">        NATS event with JSON payload: </span>
<span class="cm">        {</span>
<span class="cm">            &quot;vehicleId&quot;: &quot;v001&quot;,</span>
<span class="cm">            &quot;currentArea&quot;: &quot;a002&quot;</span>
<span class="cm">        }</span>

<span class="cm">Output:</span>
<span class="cm">    Update the collection(subscriber) documents of MongoDB(parisTma).</span>

<span class="cm">*/</span>

<span class="c1">-- NATS source that listens to the events</span>
<span class="o">@</span><span class="k">source</span><span class="p">(</span>
    <span class="k">type</span><span class="o">=</span><span class="s1">&#39;nats&#39;</span><span class="p">,</span> 
    <span class="k">cluster</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="s1">&#39;${STAN_CLUSTER_ID}&#39;</span><span class="p">,</span> 
    <span class="n">destination</span><span class="o">=</span><span class="s1">&#39;VehicleInputTunnel&#39;</span><span class="p">,</span> 
    <span class="n">bootstrap</span><span class="p">.</span><span class="n">servers</span><span class="o">=</span><span class="s1">&#39;${STAN_SERVER_URL}&#39;</span><span class="p">,</span> 
    <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">CurrentVehicleAreaInputStream</span><span class="p">(</span><span class="n">vehicleId</span> <span class="n">string</span><span class="p">,</span> <span class="n">currentArea</span> <span class="n">string</span><span class="p">);</span>

<span class="c1">-- MongoDB store</span>
<span class="o">@</span><span class="n">store</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;mongodb&#39;</span><span class="p">,</span> <span class="n">mongodb</span><span class="p">.</span><span class="n">uri</span><span class="o">=</span><span class="s1">&#39;${MONGODB_URI}&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">subscriber</span><span class="p">(</span><span class="n">vehicleId</span> <span class="n">string</span><span class="p">,</span> <span class="n">currentArea</span> <span class="n">string</span><span class="p">);</span>

<span class="c1">-- Retrieves events from NATS source and update in MongoDB</span>
<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;update-or-insert-subscriber-location&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">CurrentVehicleAreaInputStream</span>
<span class="k">update</span> <span class="k">or</span> <span class="k">insert</span> <span class="k">into</span> <span class="n">subscriber</span> 
<span class="k">on</span> <span class="n">subscriber</span><span class="p">.</span><span class="n">vehicleId</span><span class="o">==</span><span class="n">vehicleId</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h3 id="notifier">Notifier<a class="headerlink" href="#notifier" title="Permanent link">&para;</a></h3>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">name</span><span class="p">(</span><span class="ss">&quot;ParisTMANotifier&quot;</span><span class="p">)</span>
<span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">description</span><span class="p">(</span><span class="ss">&quot;Listen to the CDC events about the weather updates and send notifications to the subscribed users.&quot;</span><span class="p">)</span>

<span class="cm">/*</span>
<span class="cm">Purpose:</span>
<span class="cm">    The ParisTMA has subscribers that subscribe to get the service. All the subscriber details are saved in the Mongo database. In that database ParisTMA stores the current location of subscriber vehicles. There is a separate system handle by the Paris weather forecast organization. They periodically update the MySQL database called &#39;paristma&#39; with recent weather incidents. This app listens to those insertions using CDC and sends notifications to the subscribers who are in that particular area that incident happens.</span>

<span class="cm">Input:</span>
<span class="cm">    CDC insertions.</span>

<span class="cm">Output:</span>
<span class="cm">    Email to users that notifying about the incident. </span>
<span class="cm">    Note: Even you can change this email notification to an SMS notification calling an SMS provider.</span>
<span class="cm">*/</span>

<span class="c1">-- CDC source that listens to insertions of the Incident table</span>
<span class="o">@</span><span class="k">source</span><span class="p">(</span>
    <span class="k">type</span><span class="o">=</span><span class="s1">&#39;cdc&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="o">=</span><span class="s1">&#39;${MYSQL_URL}&#39;</span><span class="p">,</span>
    <span class="n">username</span><span class="o">=</span><span class="s1">&#39;siddhi_user&#39;</span><span class="p">,</span>
    <span class="n">password</span><span class="o">=</span><span class="s1">&#39;siddhiio&#39;</span><span class="p">,</span>
    <span class="k">table</span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Incident&#39;</span><span class="p">,</span>
    <span class="k">operation</span><span class="o">=</span><span class="s1">&#39;insert&#39;</span><span class="p">,</span>
    <span class="o">@</span><span class="k">map</span><span class="p">(</span>
        <span class="k">type</span><span class="o">=</span><span class="s1">&#39;keyvalue&#39;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">IncidentInputStream</span><span class="p">(</span><span class="n">incidentId</span> <span class="nb">int</span><span class="p">,</span> <span class="n">incidentName</span> <span class="n">string</span><span class="p">,</span> <span class="n">incidentType</span> <span class="n">string</span><span class="p">,</span> <span class="n">incidentDetails</span> <span class="n">string</span><span class="p">,</span> <span class="n">incidentArea</span> <span class="n">string</span><span class="p">);</span>

<span class="c1">-- MongoDB store of subscribers</span>
<span class="o">@</span><span class="n">store</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;mongodb&#39;</span><span class="p">,</span> <span class="n">mongodb</span><span class="p">.</span><span class="n">uri</span><span class="o">=</span><span class="s1">&#39;${MONGODB_URI}&#39;</span><span class="p">)</span>
<span class="n">define</span> <span class="k">table</span> <span class="n">subscriber</span><span class="p">(</span><span class="n">vehicleId</span> <span class="n">string</span><span class="p">,</span> <span class="n">currentArea</span> <span class="n">string</span><span class="p">,</span> <span class="n">subscriberName</span> <span class="n">string</span><span class="p">,</span> <span class="n">subscriberEmail</span> <span class="n">string</span><span class="p">);</span>

<span class="c1">-- Email sink to send notifications</span>
<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="ss">&quot;${PARIS_TMA_EMAIL}&quot;</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="ss">&quot;${PARIS_TMA_EMAIL}&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="ss">&quot;${PARIS_TMA_EMAIL_PASSWORD}&quot;</span><span class="p">,</span> 
      <span class="n">subject</span><span class="o">=</span><span class="ss">&quot;Weather Notification in {{incidentArea}}&quot;</span><span class="p">,</span> <span class="k">to</span><span class="o">=</span><span class="ss">&quot;{{subscriberEmail}}&quot;</span><span class="p">,</span> <span class="k">host</span><span class="o">=</span><span class="ss">&quot;smtp.gmail.com&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="ss">&quot;465&quot;</span><span class="p">,</span> 
      <span class="n">ssl</span><span class="p">.</span><span class="n">enable</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="ss">&quot;true&quot;</span><span class="p">,</span> 
      <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> 
           <span class="o">@</span><span class="n">payload</span><span class="p">(</span><span class="ss">&quot;&quot;&quot;</span>
<span class="ss">            Hi {{subscriberName}}</span>

<span class="ss">            Recent reports state that there is {{incidentName}} in your area {{incidentArea}}. It is in {{incidentType}} state right now. </span>

<span class="ss">            The report state that {{incidentDetails}}.</span>

<span class="ss">            Thanks, </span>
<span class="ss">            Paris Transport Management Authority&quot;&quot;&quot;</span><span class="p">)))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">UserNotificationStream</span> <span class="p">(</span><span class="n">subscriberName</span> <span class="n">string</span><span class="p">,</span> <span class="n">subscriberEmail</span> <span class="n">string</span><span class="p">,</span> <span class="n">incidentName</span> <span class="n">string</span><span class="p">,</span> <span class="n">incidentType</span> <span class="n">string</span><span class="p">,</span> <span class="n">incidentDetails</span> <span class="n">string</span><span class="p">,</span> <span class="n">incidentArea</span> <span class="n">string</span><span class="p">);</span>

<span class="c1">-- Listen to the insertions in IncidentInputStream and join it with subscriber collection in MongoDB to get user information. Send notifications using that user information.</span>
<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;listen-and-notify&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">IncidentInputStream</span><span class="o">#</span><span class="n">window</span><span class="p">.</span><span class="k">length</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">join</span> <span class="n">subscriber</span>
<span class="k">on</span> <span class="n">IncidentInputStream</span><span class="p">.</span><span class="n">incidentArea</span><span class="o">==</span><span class="n">subscriber</span><span class="p">.</span><span class="n">currentArea</span>
<span class="k">select</span> 
    <span class="n">subscriber</span><span class="p">.</span><span class="n">subscriberName</span><span class="p">,</span> 
    <span class="n">subscriber</span><span class="p">.</span><span class="n">subscriberEmail</span><span class="p">,</span> 
    <span class="n">IncidentInputStream</span><span class="p">.</span><span class="n">incidentName</span><span class="p">,</span> 
    <span class="n">IncidentInputStream</span><span class="p">.</span><span class="n">incidentType</span><span class="p">,</span> 
    <span class="n">IncidentInputStream</span><span class="p">.</span><span class="n">incidentDetails</span><span class="p">,</span> 
    <span class="n">IncidentInputStream</span><span class="p">.</span><span class="n">incidentArea</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">UserNotificationStream</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<h3 id="setup-mongodb">Setup MongoDB<a class="headerlink" href="#setup-mongodb" title="Permanent link">&para;</a></h3>
<p>Refer <a href="https://docs.mongodb.com/manual/installation/">this link</a> to install MongoDB in your local machine. The ParisTMA system uses a Mongo database called <code>parisTma</code> and that parisTma collection contained a collection called the <code>subscriber</code>. In order to connect to the Mongo database, the Siddhi runtime will use a user called <code>siddhi_user</code> that identified by password <code>siddhiio</code>. You can create those MongoDB databases, collections, users and insert data using the following MongoDB commands.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>&gt; use parisTma
&gt; db.createCollection<span class="o">(</span><span class="s2">&quot;subscriber&quot;</span><span class="o">)</span>
&gt; db.createUser<span class="o">(</span>
   <span class="o">{</span>    user: <span class="s2">&quot;siddhi_user&quot;</span>,
      pwd: <span class="s2">&quot;siddhiio&quot;</span>,
      roles:<span class="o">[{</span>role: <span class="s2">&quot;userAdmin&quot;</span> , db:<span class="s2">&quot;parisTma&quot;</span><span class="o">}]</span>
   <span class="o">}</span>
<span class="o">)</span>

&gt; db.subscriber.insert<span class="o">({</span>
   vehicleId: <span class="s1">&#39;v001&#39;</span>,
   currentArea: <span class="s1">&#39;a001&#39;</span>,
   subscriberName: <span class="s1">&#39;John Dus&#39;</span>,
   subscriberEmail: <span class="s1">&#39;b.wathsala.bw@gmail.com&#39;</span>
<span class="o">})</span>

&gt; db.subscriber.insert<span class="o">({</span>
   vehicleId: <span class="s1">&#39;v002&#39;</span>,
   currentArea: <span class="s1">&#39;a002&#39;</span>,
   subscriberName: <span class="s1">&#39;Natalie Jonson&#39;</span>,
   subscriberEmail: <span class="s1">&#39;b.wathsala.bw@gmail.com&#39;</span>
<span class="o">})</span>

&gt; db.subscriber.insert<span class="o">({</span>
   vehicleId: <span class="s1">&#39;v003&#39;</span>,
   currentArea: <span class="s1">&#39;a003&#39;</span>,
   subscriberName: <span class="s1">&#39;Mark Norman&#39;</span>,
   subscriberEmail: <span class="s1">&#39;buddhik@wso2.com&#39;</span>
<span class="o">})</span>
</pre></div>
</td></tr></table>

<h3 id="setup-mysql">Setup MySQL<a class="headerlink" href="#setup-mysql" title="Permanent link">&para;</a></h3>
<p>After that, you have to create a MySQL database called <code>paristma</code>. It contained a table called <code>Incident</code> to store all the weather incidents happened recently. To access the MySQL database you also need to create a user called <code>siddhi_user</code> that identified by password <code>siddhiio</code>. The incident table will look like the following.</p>
<p><img alt="MySQL Incident Table" src="../images/mysql-incident-table.png" title="MySQL Incident Table" /></p>
<p>To connect to the MySQL database Siddhi tooling runtime needs the MySQL client library. You can download the <a href="https://dev.mysql.com/downloads/connector/j/5.1.html">MySQL JAR from here</a> and then add the JAR to the <code>${TOOLING_HOME}/jars</code> directory.</p>
<p>This example uses the Siddhi CDC in the default(listening) mode. The listening mode needs to change the configurations as described <a href="https://github.com/siddhi-io/siddhi-io-cdc">here</a>. For example, you have to add the following configurations to the <code>my.cnf</code> file.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">[</span>mysqld<span class="o">]</span>
server-id         <span class="o">=</span> <span class="m">223344</span>
<span class="nv">log_bin</span>           <span class="o">=</span> mysql-bin
<span class="nv">binlog_format</span>     <span class="o">=</span> row
<span class="nv">binlog_row_image</span>  <span class="o">=</span> full
<span class="nv">expire_logs_days</span>  <span class="o">=</span> <span class="m">10</span>
<span class="nv">gtid_mode</span>                 <span class="o">=</span> on
<span class="nv">enforce_gtid_consistency</span>  <span class="o">=</span> on
<span class="nv">binlog_rows_query_log_events</span> <span class="o">=</span> on
log-error<span class="o">=</span>/var/log/mysql/mysql.err
log-bin <span class="o">=</span> /var/log/mysql/mysql-replication.log
</pre></div>
</td></tr></table>

<h3 id="setup-nats-streaming-cluster">Setup NATS Streaming Cluster<a class="headerlink" href="#setup-nats-streaming-cluster" title="Permanent link">&para;</a></h3>
<p>Now you need to <a href="https://nats-io.github.io/docs/nats_streaming/gettingstarted/install.html">install a NATS streaming server</a>. For example, to install the NATS streaming cluster in MacOS use the following commands.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ brew install nats-streaming-server
</pre></div>
</td></tr></table>

<p>After the installation runs the NATS streaming cluster as below.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ nats-streaming-server
</pre></div>
</td></tr></table>

<p>The Siddhi app runtime will need the following JARs to connect to the NATS streaming server. Download those JARs using the following links and add those JARs to <code>${TOOLING_HOME}/jars</code> directory.</p>
<ul>
<li><a href="https://mvnrepository.com/artifact/io.nats/java-nats-streaming/2.1.2">Java NATS streaming</a></li>
<li><a href="https://mvnrepository.com/artifact/io.nats/jnats/2.3.0">JNATS</a></li>
</ul>
<p>It also needs the Protobuf bundle. Download the Protobuf bundle using the following link and add the bundle to ${TOOLING_HOME}/bundles directory.</p>
<ul>
<li><a href="https://mvnrepository.com/artifact/com.google.protobuf/protobuf-java/3.6.1">Protobuf</a></li>
</ul>
<h3 id="configurations">Configurations<a class="headerlink" href="#configurations" title="Permanent link">&para;</a></h3>
<p>The above Siddhi apps receive the MySQL, MongoDB, and NATS connections details as environment variables. For local deployments for testing these apps, you have to set up those environmental variables as follows.</p>
<ol>
<li>STAN_CLUSTER_ID=<code>test-cluster</code></li>
<li>STAN_SERVER_URL=<code>nats://localhost:4222</code></li>
<li>MONGODB_URI=<code>mongodb://127.0.0.1:27017/parisTma?&amp;gssapiServiceName=mongodb</code></li>
<li>MYSQL_URL=<code>jdbc:mysql://127.0.0.1:3306/paristma</code></li>
<li>PARIS_TMA_EMAIL=<code>&lt;TEST_EMAIL&gt;</code></li>
<li>PARIS_TMA_EMAIL_PASSWORD=<code>&lt;TEST_EMAIL_PASSWORD&gt;</code></li>
</ol>
<h3 id="tryout">Tryout<a class="headerlink" href="#tryout" title="Permanent link">&para;</a></h3>
<p>After all those configurations and setups you will be able to starts the both Siddhi apps without any error. Testing the app can be done in two levels.</p>
<ol>
<li>Update the vehicle location periodically</li>
<li>Send notifications</li>
</ol>
<p>To test the vehicle location updates you have to send a request to the NATS streaming server. You can send the request using various NATS clients. In this use case, you can use NATS streaming Go language client to easily send requests. To do that you need to have to install Golang in your machine. Or else you can use other clients like (<a href="https://github.com/nats-io/stan.java">Java</a>, <a href="https://github.com/nats-io/stan.js">JS</a>, <a href="https://github.com/nats-io/stan.py">Python</a>, or <a href="https://github.com/nats-io/stan.rb">Ruby</a> etc). You can use following Golang commands to send a request to the NATS streaming cluster.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ go get github.com/nats-io/stan.go/
$ go run <span class="nv">$GOPATH</span>/src/github.com/nats-io/stan.go/examples/stan-pub/main.go -s localhost:4222 -c test-cluster VehicleInputTunnel <span class="s2">&quot;{\&quot;vehicleId\&quot;: \&quot;v001\&quot;, \&quot;currentArea\&quot;:\&quot;a003\&quot;}&quot;</span>
</pre></div>
</td></tr></table>

<p>To run the notification Siddhi app you just need to insert data entry to the Incident table. When you do that it the Siddhi app will simply send an email to the subscribers like below.</p>
<p><img alt="Email" src="../images/email.png" title="Email" /></p>
<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h2>
<h3 id="deploy-on-vm-bare-metal">Deploy on VM/ Bare Metal<a class="headerlink" href="#deploy-on-vm-bare-metal" title="Permanent link">&para;</a></h3>
<ol>
<li>First, you have to set up prerequisites as described in the previous sections.<ol>
<li><a href="#setup-mongodb">Setup MongoDB</a></li>
<li><a href="#setup-mysql">Setup MySQL</a></li>
<li><a href="#setup-nats-streaming-cluster">Setup NATS Streaming</a></li>
</ol>
</li>
<li>Download the <a href="https://siddhi.io/en/v5.1/download/">Siddhi runner distribution pack from here</a> and unzip it.</li>
<li>Download relevant JARs and add those JARs to <code>${RUNNER_HOME}/jars</code> directory.<ol>
<li><a href="https://dev.mysql.com/downloads/connector/j/5.1.html">MySQL</a></li>
<li><a href="https://mvnrepository.com/artifact/io.nats/java-nats-streaming/2.1.2">Java NATS streaming</a></li>
<li><a href="https://mvnrepository.com/artifact/io.nats/jnats/2.3.0">JNATS</a></li>
</ol>
</li>
<li>Download Protobuf bundle and add the bundle to <code>${RUNNER_HOME}/bundles</code> directory.<ol>
<li><a href="https://mvnrepository.com/artifact/com.google.protobuf/protobuf-java/3.6.1">Protobuf</a></li>
</ol>
</li>
<li>Copy your Siddhi file into <code>&lt;RUNNER_HOME&gt;/wso2/runner/deployment/siddhi-files</code></li>
<li>Start the following binary file to run the Siddhi runner server.
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>For Linux/Mac: &lt;RUNNER_HOME&gt;/bin/runner.sh
For Windows: &lt;RUNNER_HOME&gt;/bin/runner.bat
</pre></div>
</td></tr></table></li>
<li>Now you can try out the sample as described in this <a href="#tryout">tryout section</a>.</li>
</ol>
<h3 id="deploy-on-docker">Deploy on Docker<a class="headerlink" href="#deploy-on-docker" title="Permanent link">&para;</a></h3>
<h4 id="prerequisite">Prerequisite<a class="headerlink" href="#prerequisite" title="Permanent link">&para;</a></h4>
<p><a href="https://docs.docker.com/install/">Install Docker</a> in your machine.</p>
<h4 id="siddhi-docker-configurations">Siddhi Docker Configurations<a class="headerlink" href="#siddhi-docker-configurations" title="Permanent link">&para;</a></h4>
<p>In the tooling editor itself, you can export your Siddhi app into a runnable docker artifact. You can go to <code>Export-&gt;For Docker</code> and it will give to a zip file that contained the following files.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>├── Dockerfile
├── bundles
│   └── protobuf-java-3.6.1.jar
├── configurations.yaml
├── jars
│   ├── java_nats_streaming_2.1.2.jar
│   ├── jnats_2.3.0.jar
│   └── mysql-connector-java-5.1.45-bin.jar
└── siddhi-files
    ├── ParisTMANotifier.siddhi
    └── ParisTMAVehicleLocator.siddhi
</pre></div>
</td></tr></table>

<p>When you export the apps as a Docker, it will ask for the templated values to be filled. You have to use the following values for those templated values.</p>
<ol>
<li>STAN_CLUSTER_ID=<code>test-cluster</code></li>
<li>STAN_SERVER_URL=<code>nats://nats:4222</code></li>
<li>MONGODB_URI=<code>mongodb://mongodb:27017/parisTma?&amp;gssapiServiceName=mongodb</code></li>
<li>MYSQL_URL=<code>jdbc:mysql://mysqldb:3306/paristma</code></li>
<li>PARIS_TMA_EMAIL=<code>&lt;TEST_EMAIL&gt;</code></li>
<li>PARIS_TMA_EMAIL_PASSWORD=<code>&lt;TEST_EMAIL_PASSWORD&gt;</code></li>
</ol>
<p>In order to change the configurations of MySQL Docker container you have create <code>my.cnf</code> file in your current directory and add the following content to that file. Also create directory called <code>mysql</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">[</span>mysqld<span class="o">]</span>
server-id         <span class="o">=</span> <span class="m">223344</span>
<span class="nv">log_bin</span>           <span class="o">=</span> mysql-bin
<span class="nv">binlog_format</span>     <span class="o">=</span> row
<span class="nv">binlog_row_image</span>  <span class="o">=</span> full
<span class="nv">expire_logs_days</span>  <span class="o">=</span> <span class="m">10</span>
<span class="nv">gtid_mode</span>                 <span class="o">=</span> on
<span class="nv">enforce_gtid_consistency</span>  <span class="o">=</span> on
<span class="nv">binlog_rows_query_log_events</span> <span class="o">=</span> on
log-error<span class="o">=</span>/var/log/mysql/mysql.err
log-bin <span class="o">=</span> /var/log/mysql/mysql-replication.log
</pre></div>
</td></tr></table>

<p>Now you need to have a Docker compose file like below to set up all the prerequisites. This compose file contains volume mounts to change configurations of the MySQL container.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="s">&quot;3&quot;</span>
<span class="nt">services</span><span class="p">:</span>
    <span class="nt">backend</span><span class="p">:</span>
        <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">paristma-notifier</span>
        <span class="nt">user</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">802:802</span>
        <span class="nt">build</span><span class="p">:</span>
          <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
          <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">./Dockerfile</span>
        <span class="nt">links</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mysqldb</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mongodb</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">nats</span>
        <span class="nt">networks</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
        <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">on-failure</span>

    <span class="nt">mysqldb</span><span class="p">:</span>
        <span class="nt">image</span><span class="p">:</span> <span class="s">&#39;mysql:5.7&#39;</span>
        <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">paristma-mysqldb</span>
        <span class="nt">environment</span><span class="p">:</span>
            <span class="nt">MYSQL_USER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">siddhi_user</span>
            <span class="nt">MYSQL_PASSWORD</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">siddhiio</span>
            <span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">siddhiio</span>
        <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="s">&quot;3304:3306&quot;</span>
        <span class="nt">networks</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
        <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">on-failure</span>
        <span class="nt">volumes</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./my.cnf:/etc/my.cnf</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./mysql:/var/log/mysql</span>
        <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">--sql_mode=&quot;&quot;</span>

    <span class="nt">mongodb</span><span class="p">:</span>
        <span class="nt">image</span><span class="p">:</span> <span class="s">&#39;mongo:4.0.4&#39;</span>
        <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">paristma-mongodb</span>
        <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="s">&quot;27017-27019:27017-27019&quot;</span>
        <span class="nt">networks</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
        <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">on-failure</span>

    <span class="nt">nats</span><span class="p">:</span>
        <span class="nt">image</span><span class="p">:</span> <span class="s">&#39;nats-streaming:0.16.2-linux&#39;</span>
        <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">paristma-nats</span>
        <span class="nt">ports</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="s">&quot;4223:4223&quot;</span>
            <span class="p p-Indicator">-</span> <span class="s">&quot;8223:8223&quot;</span>
        <span class="nt">networks</span><span class="p">:</span>
            <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">default</span>
        <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">on-failure</span>
</pre></div>
</td></tr></table>

<p>Now you can start each containers.</p>
<ol>
<li>First, you need to build the Docker composer.
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker-compose build
</pre></div>
</td></tr></table></li>
<li>Starts the MySQL container using the following command and set up the MySQL database as <a href="#setup-mysql">described above</a>.
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker-compose up -d mysqldb
</pre></div>
</td></tr></table></li>
<li>Then, starts the MongoDB container using the following command and set up the MongoDB database as <a href="#setup-mongodb">described above</a>.
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker-compose up -d mongodb
</pre></div>
</td></tr></table></li>
<li>After that, starts the NATS container using the following command.
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker-compose up -d nats
</pre></div>
</td></tr></table></li>
<li>Finally, start the Siddhi backend runtime.
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker-compose up -d backend
</pre></div>
</td></tr></table>
When you insert data entry to the Incident table, the Siddhi app will simply send an email to the subscribers like below.</li>
</ol>
<p><img alt="Email" src="../images/email.png" title="Email" /></p>
<h3 id="deploy-on-kubernetes">Deploy on Kubernetes<a class="headerlink" href="#deploy-on-kubernetes" title="Permanent link">&para;</a></h3>
<h4 id="prerequisites_1">Prerequisites<a class="headerlink" href="#prerequisites_1" title="Permanent link">&para;</a></h4>
<ol>
<li>Kubernetes cluster<ol>
<li><a href="https://github.com/kubernetes/minikube#installation">Minikube</a></li>
<li><a href="https://console.cloud.google.com">Google Kubernetes Engine(GKE)</a></li>
<li><a href="https://docs.docker.com/docker-for-mac/install/">Docker for Mac</a></li>
</ol>
</li>
<li><a href="https://helm.sh/docs/using_helm/#installing-helm">Install HELM</a></li>
</ol>
<h4 id="siddhi-kubernetes-configurations">Siddhi Kubernetes Configurations<a class="headerlink" href="#siddhi-kubernetes-configurations" title="Permanent link">&para;</a></h4>
<p>In the tooling editor itself, you can export your Siddhi app into a runnable Kubernetes artifact. You can go to <code>Export-&gt;For Kubernetes</code> and it will give to a zip file that contained the following files.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>├── Dockerfile
├── bundles
│   └── protobuf-java-3.6.1.jar
├── configurations.yaml
├── jars
│   ├── java_nats_streaming_2.1.2.jar
│   ├── jnats_2.3.0.jar
│   └── mysql-connector-java-5.1.45-bin.jar
├── siddhi-files
│   ├── ParisTMANotifier.siddhi
│   └── ParisTMAVehicleLocator.siddhi
└── siddhi-process.yaml
</pre></div>
</td></tr></table>

<p>When you export the apps as a Kubernetes, it will ask for the templated values to be filled. You have to use the following values for those templated values.</p>
<ol>
<li>STAN_CLUSTER_ID=<code>siddhi-stan</code></li>
<li>STAN_SERVER_URL=<code>nats://siddhi-nats:4222</code></li>
<li>MONGODB_URI=<code>mongodb://siddhi_user:siddhiio@paristma-mongodb:27017/parisTma</code></li>
<li>MYSQL_URL=<code>jdbc:mysql://mysqldb:3306/paristma</code></li>
<li>PARIS_TMA_EMAIL=<code>&lt;TEST_EMAIL&gt;</code></li>
<li>PARIS_TMA_EMAIL_PASSWORD=<code>&lt;TEST_EMAIL_PASSWORD&gt;</code></li>
</ol>
<h4 id="setup-mongodb_1">Setup MongoDB<a class="headerlink" href="#setup-mongodb_1" title="Permanent link">&para;</a></h4>
<p>Let’s install MongoDB in your Kubernetes cluster using Helm.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ helm install stable/mongodb
$ helm install --name paristma --set volumePermissions.enabled<span class="o">=</span>true,mongodbRootPassword<span class="o">=</span>siddhiio,mongodbUsername<span class="o">=</span>siddhi_user,mongodbPassword<span class="o">=</span>siddhiio,mongodbDatabase<span class="o">=</span>parisTma stable/mongodb 
</pre></div>
</td></tr></table>

<p>Now you can access the MongoDB externally using following commands and set up the Mongo database as <a href="#setup-mongodb">described previously</a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ <span class="nb">export</span> <span class="nv">MONGODB_ROOT_PASSWORD</span><span class="o">=</span><span class="k">$(</span>kubectl get secret --namespace default paristma-mongodb -o <span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.data.mongodb-root-password}&quot;</span> <span class="p">|</span> base64 --decode<span class="k">)</span>

$ kubectl run --namespace default paristma-mongodb-client --rm --tty -i --restart<span class="o">=</span><span class="s1">&#39;Never&#39;</span> --image bitnami/mongodb --command -- mongo admin --host paristma-mongodb --authenticationDatabase admin -u root -p <span class="nv">$MONGODB_ROOT_PASSWORD</span>
</pre></div>
</td></tr></table>

<h4 id="setup-mysql_1">Setup MySQL<a class="headerlink" href="#setup-mysql_1" title="Permanent link">&para;</a></h4>
<p>In order to change the MySQL configurations for the Siddhi CDC extension, you need to create a file called <code>values.yaml</code> with including the following configurations.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>mysqlRootPassword: siddhiio
mysqlUser: siddhi_user
mysqlPassword: siddhiio
mysqlDatabase: paristma
configurationFiles:
    my.cnf: <span class="p">|</span>-
        <span class="o">[</span>mysqld<span class="o">]</span>
        server-id         <span class="o">=</span> <span class="m">223344</span>
        <span class="nv">log_bin</span>           <span class="o">=</span> mysql-bin
        <span class="nv">binlog_format</span>     <span class="o">=</span> row
        <span class="nv">binlog_row_image</span>  <span class="o">=</span> full
        <span class="nv">expire_logs_days</span>  <span class="o">=</span> <span class="m">10</span>
        <span class="nv">gtid_mode</span>                 <span class="o">=</span> on
        <span class="nv">enforce_gtid_consistency</span>  <span class="o">=</span> on
        <span class="nv">binlog_rows_query_log_events</span> <span class="o">=</span> on
        log-error<span class="o">=</span>/var/log/mysql/mysql.err
        log-bin <span class="o">=</span> /var/log/mysql/mysql-replication.log
</pre></div>
</td></tr></table>

<p>Now you can install MySQL in you Kubernetes cluster using Helm.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ helm install --name mysqldb -f values.yaml stable/mysql
</pre></div>
</td></tr></table>

<p>Use Kubernetes port forwading to access MySQL externally using 3307 port and create nessasary tables in the MySQL database as <a href="#setup-mysql">described previously</a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ kubectl port-forward svc/mysql-db <span class="m">3307</span>:3306
</pre></div>
</td></tr></table>

<h4 id="setup-nats-streaming">Setup NATS Streaming<a class="headerlink" href="#setup-nats-streaming" title="Permanent link">&para;</a></h4>
<p>Use the following kubectl commands to set up the NATS streaming cluster.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ kubectl apply -f https://github.com/nats-io/nats-operator/releases/download/v0.5.0/00-prereqs.yaml
$ kubectl apply -f https://github.com/nats-io/nats-operator/releases/download/v0.5.0/10-deployment.yaml
$ kubectl apply -f https://github.com/nats-io/nats-streaming-operator/releases/download/v0.2.2/default-rbac.yaml
$ kubectl apply -f https://github.com/nats-io/nats-streaming-operator/releases/download/v0.2.2/deployment.yaml

$ <span class="nb">echo</span> <span class="s1">&#39;</span>
<span class="s1">---</span>
<span class="s1">apiVersion: &quot;nats.io/v1alpha2&quot;</span>
<span class="s1">kind: &quot;NatsCluster&quot;</span>
<span class="s1">metadata:</span>
<span class="s1">  name: &quot;siddhi-nats&quot;</span>
<span class="s1">spec:</span>
<span class="s1">  size: 1</span>
<span class="s1">&#39;</span> <span class="p">|</span> kubectl apply -f -

$ <span class="nb">echo</span> <span class="s1">&#39;</span>
<span class="s1">---</span>
<span class="s1">apiVersion: &quot;streaming.nats.io/v1alpha1&quot;</span>
<span class="s1">kind: &quot;NatsStreamingCluster&quot;</span>
<span class="s1">metadata:</span>
<span class="s1">  name: &quot;siddhi-stan&quot;</span>
<span class="s1">spec:</span>
<span class="s1">  size: 1</span>
<span class="s1">  natsSvc: &quot;siddhi-nats&quot;</span>
<span class="s1">&#39;</span> <span class="p">|</span> kubectl apply -f -
</pre></div>
</td></tr></table>

<p>For more details about the NATS streaming server, refer to this <a href="https://github.com/nats-io/nats-streaming-operator/tree/v0.2.2">documentation</a>.</p>
<h4 id="setup-siddhi-operator">Setup Siddhi Operator<a class="headerlink" href="#setup-siddhi-operator" title="Permanent link">&para;</a></h4>
<p>Use the following kubectl commands to install the Siddhi operator in your Kubernetes cluster.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ kubectl apply -f https://github.com/siddhi-io/siddhi-operator/releases/download/v0.2.0-beta/00-prereqs.yaml
$ kubectl apply -f https://github.com/siddhi-io/siddhi-operator/releases/download/v0.2.0-beta/01-siddhi-operator.yaml
</pre></div>
</td></tr></table>

<p>Now you need to create your own docker image with including all the custom libraries and configuration changes that you have made. Use following command to build and push the docker image with the tag <code>&lt;DOCKER_HUB_USER_NAME&gt;/siddhi-runner-alpine:latest</code>.</p>
<p><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ docker build -t &lt;DOCKER_HUB_USER_NAME&gt;/siddhi-runner-alpine:latest .
$ docker push &lt;DOCKER_HUB_USER_NAME&gt;/siddhi-runner-alpine:latest
</pre></div>
</td></tr></table>
After the Kubernetes export now you already have this <code>siddhi-process.yaml</code> file.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">siddhi.io/v1alpha2</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SiddhiProcess</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">paris-tma</span>

<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">apps</span><span class="p">:</span>
  <span class="p p-Indicator">-</span> <span class="nt">script</span><span class="p">:</span> <span class="p p-Indicator">|</span>
      <span class="no">@App:name(&quot;ParisTMANotifier&quot;)</span>
      <span class="no">@App:description(&quot;Listen to the CDC events about the weather updates and send notifications to the subscribed users.&quot;)</span>

      <span class="no">/*</span>
      <span class="no">Purpose:</span>
          <span class="no">The ParisTMA has subscribers that subscribe to get the service. All the subscriber details are saved in the Mongo database. In that database ParisTMA stores the current location of subscriber vehicles. There is a separate system handle by the Paris weather forecast organization. They periodically update the MySQL database called &#39;paristma&#39; with recent weather incidents. This app listens to those insertions using CDC and sends notifications to the subscribers who are in that particular area that incident happens.</span>

      <span class="no">Input:</span>
          <span class="no">CDC insertions.</span>

      <span class="no">Output:</span>
          <span class="no">Email to users that notifying about the incident.</span>
          <span class="no">Note: Even you can change this email notification to an SMS notification calling an SMS provider.</span>
      <span class="no">*/</span>

      <span class="no">-- CDC source that listens to insertions of the Incident table</span>
      <span class="no">@source(</span>
          <span class="no">type=&#39;cdc&#39;,</span>
          <span class="no">url=&#39;${MYSQL_URL}&#39;,</span>
          <span class="no">username=&#39;siddhi_user&#39;,</span>
          <span class="no">password=&#39;siddhiio&#39;,</span>
          <span class="no">table.name=&#39;Incident&#39;,</span>
          <span class="no">operation=&#39;insert&#39;,</span>
          <span class="no">@map(</span>
              <span class="no">type=&#39;keyvalue&#39;</span>
          <span class="no">)</span>
      <span class="no">)</span>
      <span class="no">define stream IncidentInputStream(incidentId int, incidentName string, incidentType string, incidentDetails string, incidentArea string);</span>

      <span class="no">-- MongoDB store of subscribers</span>
      <span class="no">@store(type=&#39;mongodb&#39;, mongodb.uri=&#39;${MONGODB_URI}&#39;)</span>
      <span class="no">define table subscriber(vehicleId string, currentArea string, subscriberName string, subscriberEmail string);</span>

      <span class="no">-- Email sink to send notifications</span>
      <span class="no">@sink(type=&#39;email&#39;, username=&quot;${PARIS_TMA_EMAIL}&quot;, address=&quot;${PARIS_TMA_EMAIL}&quot;, password=&quot;${PARIS_TMA_EMAIL_PASSWORD}&quot;,</span>
            <span class="no">subject=&quot;Weather Notification in {{incidentArea}}&quot;, to=&quot;{{subscriberEmail}}&quot;, host=&quot;smtp.gmail.com&quot;, port=&quot;465&quot;,</span>
            <span class="no">ssl.enable=&quot;true&quot;, auth=&quot;true&quot;,</span>
            <span class="no">@map(type=&#39;text&#39;,</span>
                 <span class="no">@payload(&quot;&quot;&quot;</span>
                  <span class="no">Hi {{subscriberName}}</span>

                  <span class="no">Recent reports state that there is {{incidentName}} in your area {{incidentArea}}. It is in {{incidentType}} state right now.</span>

                  <span class="no">The report state that {{incidentDetails}}.</span>

                  <span class="no">Thanks,</span>
                  <span class="no">Paris Transport Management Authority&quot;&quot;&quot;)))</span>
      <span class="no">define stream UserNotificationStream (subscriberName string, subscriberEmail string, incidentName string, incidentType string, incidentDetails string, incidentArea string);</span>

      <span class="no">-- Listen to the insertions in IncidentInputStream and join it with subscriber collection in MongoDB to get user information. Send notifications using that user information.</span>
      <span class="no">@info(name=&#39;listen-and-notify&#39;)</span>
      <span class="no">from IncidentInputStream#window.length(1) join subscriber</span>
      <span class="no">on IncidentInputStream.incidentArea==subscriber.currentArea</span>
      <span class="no">select</span>
          <span class="no">subscriber.subscriberName,</span>
          <span class="no">subscriber.subscriberEmail,</span>
          <span class="no">IncidentInputStream.incidentName,</span>
          <span class="no">IncidentInputStream.incidentType,</span>
          <span class="no">IncidentInputStream.incidentDetails,</span>
          <span class="no">IncidentInputStream.incidentArea</span>
      <span class="no">insert into UserNotificationStream;</span>
  <span class="p p-Indicator">-</span> <span class="nt">script</span><span class="p">:</span> <span class="p p-Indicator">|-</span>
      <span class="no">@App:name(&quot;ParisTMAVehicleLocator&quot;)</span>
      <span class="no">@App:description(&quot;Listen to the events send by NATS about vehicle locations and periodically update the Mongo database.&quot;)</span>

      <span class="no">/*</span>
      <span class="no">Purpose:</span>
          <span class="no">The ParisTMA has subscribers that subscribe to get the service. All the subscriber details are saved in the Mongo database. In that database ParisTMA stores the current location of subscriber vehicles. The events related to current locations come as TCP requests through NATS. This app listens to those events and eventually update the database with the current location of each subscriber.</span>

      <span class="no">Input:</span>
              <span class="no">NATS event with JSON payload:</span>
              <span class="no">{</span>
                  <span class="no">&quot;vehicleId&quot;: &quot;v001&quot;,</span>
                  <span class="no">&quot;currentArea&quot;: &quot;a002&quot;</span>
              <span class="no">}</span>

      <span class="no">Output:</span>
          <span class="no">Update the collection(subscriber) documents of MongoDB(parisTma).</span>

      <span class="no">*/</span>

      <span class="no">-- NATS source that listens to the events</span>
      <span class="no">@source(</span>
          <span class="no">type=&#39;nats&#39;,</span>
          <span class="no">cluster.id=&#39;${STAN_CLUSTER_ID}&#39;,</span>
          <span class="no">destination=&#39;VehicleInputTunnel&#39;,</span>
          <span class="no">bootstrap.servers=&#39;${STAN_SERVER_URL}&#39;,</span>
          <span class="no">@map(type=&#39;json&#39;)</span>
      <span class="no">)</span>
      <span class="no">define stream CurrentVehicleAreaInputStream(vehicleId string, currentArea string);</span>

      <span class="no">-- MongoDB store</span>
      <span class="no">@store(type=&#39;mongodb&#39;, mongodb.uri=&#39;${MONGODB_URI}&#39;)</span>
      <span class="no">define table subscriber(vehicleId string, currentArea string);</span>

      <span class="no">-- Retrieves events from NATS source and update in MongoDB</span>
      <span class="no">@info(name=&#39;update-or-insert-subscriber-location&#39;)</span>
      <span class="no">from CurrentVehicleAreaInputStream</span>
      <span class="no">update or insert into subscriber</span>
      <span class="no">on subscriber.vehicleId==vehicleId;</span>
  <span class="nt">container</span><span class="p">:</span>
    <span class="nt">env</span><span class="p">:</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MYSQL_URL</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">jdbc:mysql://mysqldb:3306/paristma</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MONGODB_URI</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">mongodb://siddhi_user:siddhiio@paristma-mongodb:27017/parisTma</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PARIS_TMA_EMAIL</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;TEST_EMAIL&gt;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PARIS_TMA_EMAIL_PASSWORD</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;TEST_EMAIL_PASSWORD&gt;</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">STAN_CLUSTER_ID</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">siddhi-stan</span>
    <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">STAN_SERVER_URL</span>
      <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">nats://siddhi-nats:4222</span>
    <span class="nt">image</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">&lt;DOCKER_HUB_USER_NAME&gt;/siddhi-runner-alpine:latest</span>
  <span class="nt">runner</span><span class="p">:</span> <span class="p p-Indicator">|</span>
    <span class="no">wso2.carbon:</span>
      <span class="no">id: siddhi-runner</span>
      <span class="no">name: Siddhi Runner Distribution</span>
      <span class="no">ports:</span>
        <span class="no">offset: 0</span>
    <span class="no">transports:</span>
      <span class="no">http:</span>
        <span class="no">listenerConfigurations:</span>
        <span class="no">- id: default</span>
          <span class="no">host: 0.0.0.0</span>
          <span class="no">port: 9090</span>
        <span class="no">- id: msf4j-https</span>
          <span class="no">host: 0.0.0.0</span>
          <span class="no">port: 9443</span>
          <span class="no">scheme: https</span>
          <span class="no">keyStoreFile: ${carbon.home}/resources/security/wso2carbon.jks</span>
          <span class="no">keyStorePassword: wso2carbon</span>
          <span class="no">certPass: wso2carbon</span>
        <span class="no">transportProperties:</span>
        <span class="no">- name: server.bootstrap.socket.timeout</span>
          <span class="no">value: 60</span>
        <span class="no">- name: client.bootstrap.socket.timeout</span>
          <span class="no">value: 60</span>
        <span class="no">- name: latency.metrics.enabled</span>
          <span class="no">value: true</span>
    <span class="no">dataSources:</span>
    <span class="no">- name: WSO2_CARBON_DB</span>
      <span class="no">description: The datasource used for registry and user manager</span>
      <span class="no">definition:</span>
        <span class="no">type: RDBMS</span>
        <span class="no">configuration:</span>
          <span class="no">jdbcUrl: jdbc:h2:${sys:carbon.home}/wso2/${sys:wso2.runtime}/database/WSO2_CARBON_DB;DB_CLOSE_ON_EXIT=FALSE;LOCK_TIMEOUT=60000</span>
          <span class="no">username: wso2carbon</span>
          <span class="no">password: wso2carbon</span>
          <span class="no">driverClassName: org.h2.Driver</span>
          <span class="no">maxPoolSize: 10</span>
          <span class="no">idleTimeout: 60000</span>
          <span class="no">connectionTestQuery: SELECT 1</span>
          <span class="no">validationTimeout: 30000</span>
          <span class="no">isAutoCommit: false</span>
</pre></div>
</td></tr></table>

<p>Now you can install the SiddhiProcess using following <code>kubectl</code> command. Before you install the <code>SiddhiProcess</code> you have to add the docker image tag in the <code>siddhi-process.yaml</code> file. You have to add the docker image name(<DOCKER_HUB_USER_NAME>/siddhi-runner-alpine:latest) in the YAML entry <code>spec.container.image</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ kubectl apply -f siddhi-process.yaml
</pre></div>
</td></tr></table>

<p>If all the Kubernetes artifacts deployed correctly, it will show the status like below.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>$ kubectl get deploy

NAME                      READY     UP-TO-DATE   AVAILABLE   AGE
bold-boxer-mongodb        <span class="m">1</span>/1       <span class="m">1</span>            <span class="m">1</span>           2h
mysqldb                   <span class="m">1</span>/1       <span class="m">1</span>            <span class="m">1</span>           2h
nats-operator             <span class="m">1</span>/1       <span class="m">1</span>            <span class="m">1</span>           2h
nats-streaming-operator   <span class="m">1</span>/1       <span class="m">1</span>            <span class="m">1</span>           2h
paris-tma-0               <span class="m">1</span>/1       <span class="m">1</span>            <span class="m">1</span>           2h
paris-tma-1               <span class="m">1</span>/1       <span class="m">1</span>            <span class="m">1</span>           2h
paristma-mongodb          <span class="m">1</span>/1       <span class="m">1</span>            <span class="m">1</span>           2h
siddhi-operator           <span class="m">1</span>/1       <span class="m">1</span>            <span class="m">1</span>           2h
tiller-deploy             <span class="m">1</span>/1       <span class="m">1</span>            <span class="m">1</span>           2h

$ kubectl get svc

NAME                 TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="o">(</span>S<span class="o">)</span>                      AGE
bold-boxer-mongodb   ClusterIP   <span class="m">10</span>.100.153.173   &lt;none&gt;        <span class="m">27017</span>/TCP                    2h
kubernetes           ClusterIP   <span class="m">10</span>.96.0.1        &lt;none&gt;        <span class="m">443</span>/TCP                      21d
mysqldb              ClusterIP   <span class="m">10</span>.106.112.140   &lt;none&gt;        <span class="m">3306</span>/TCP                     2h
paristma-mongodb     ClusterIP   <span class="m">10</span>.102.211.214   &lt;none&gt;        <span class="m">27017</span>/TCP                    2h
siddhi-nats          ClusterIP   <span class="m">10</span>.110.123.222   &lt;none&gt;        <span class="m">4222</span>/TCP                     2h
siddhi-nats-mgmt     ClusterIP   None             &lt;none&gt;        <span class="m">6222</span>/TCP,8222/TCP,7777/TCP   2h
siddhi-operator      ClusterIP   <span class="m">10</span>.102.157.184   &lt;none&gt;        <span class="m">8383</span>/TCP                     2h
tiller-deploy        ClusterIP   <span class="m">10</span>.103.160.179   &lt;none&gt;        <span class="m">44134</span>/TCP                    2h
$ kubectl get siddhi
NAME        STATUS    READY     AGE
paris-tma   Running   <span class="m">2</span>/2       2h
</pre></div>
</td></tr></table>

<p>When you insert data entry to the Incident table, the Siddhi app will simply send an email to the subscribers like below.</p>
<p><img alt="Email" src="../images/email.png" title="Email" /></p>
                
                  
                
              
  <a href="#" class="cd-top text--replace js-cd-top">Top</a>

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../database-static-rule-processing/guide/" title="Static Rule Processing using Database Rules" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Static Rule Processing using Database Rules
              </span>
            </div>
          </a>
        
        
          <a href="../../realtime-movie-recommendation/guide/" title="Realtime predictions with pre-trained ML models" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Realtime predictions with pre-trained ML models
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Siddhi - Documentation
          </div>
        
        &copy;2019 <a href="https://wso2.com/">WSO2</a>
      </div>
      
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
    
      <a href="/community/#community-collaboration" class="md-footer-social__link fa fa-slack"></a>
    
      <a href="https://github.com/siddhi-io/siddhi" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://medium.com/siddhi-io" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://twitter.com/siddhi_io" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/groups/13553064" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
        <script src="../../../../assets/lib/highlightjs/highlight.min.js"></script>
      
        <script src="../../../../assets/js/theme.js"></script>
      
        <script src="../../../../assets/lib/backtotop/js/util.js"></script>
      
        <script src="../../../../assets/lib/backtotop/js/main.js"></script>
      
    
  </body>
</html>