<!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->





<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Cloud Native Stream Processor">
      
      
        <link rel="canonical" href="http://siddhi.io/en/v5.1/docs/guides/realtime-movie-recommendation/guide/">
      
      
        <meta name="author" content="WSO2">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Realtime Movie Recommendation - Siddhi</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../../../assets/lib/highlightjs/default.min.css">
    
      <link rel="stylesheet" href="../../../../assets/css/theme.css">
    
    
      
        
<script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-103065-28", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#realtime-predictions-with-pre-trained-ml-models" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <!--
 * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
-->

<header class="md-header" data-md-component="header" id="page-header" data-url=""
        data-lang="en">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="http://siddhi.io/en/v5.1/" title="Siddhi"
           class="md-header-nav__button md-logo">
          
            <img src="../../../../images/siddhi-logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Siddhi
            </span>
            <span class="md-header-nav__topic">
              Realtime Movie Recommendation
            </span>
          
        </div>
        <div class="md-flex__ellipsis md-header__version-select">
            <div class="mb-tabs__dropdown version-select">
                <a class="md-tabs__link md-tabs__dropdown-link" href="#!" data-target="version-select-dropdown">
                  v5.1</a>
                <ul id="version-select-dropdown" class="mb-tabs__dropdown-content" tabindex="0">
                    <!-- Versions will added here dynamically -->
                    <li class="md-tabs__item mb-tabs__dropdown">
                        <a href="#" id="show-all-versions-link">Show all</a>
                    </li>
                </ul>
            </div>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
      <div class="md-flex__cell md-flex__cell--shrink">
        <div class="md-header-nav__source">
          


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
        </div>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
        <li class="md-tabs__item home_icon">
            <a href="/" title="Siddhi Home" class="md-tabs__link md-tabs__link--active">
                <i class="fa fa-home"></i>
            </a>
        </li>
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../download/" title="Download" class="md-tabs__link">
          Download
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../quick-start/" title="Quick Start" class="md-tabs__link">
          Quick Start
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../" title="Documentation" class="md-tabs__link md-tabs__link--active">
          Documentation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/community/" title="Community" class="md-tabs__link">
          Community
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../../development/" title="Development" class="md-tabs__link">
          Development
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="/license/" title="License" class="md-tabs__link">
          License
        </a>
      
    </li>
  

      
    </ul>
    <div class="quick_links">
        
        <a href="https://github.com/siddhi-io/www/edit/v5.1/en/docs/docs/guides/realtime-movie-recommendation/guide.md" target="blank" id="editIcon" title="Edit this page"
           title="Edit this page" class="md-icon md-content__icon nav_link edit_link"></a>
        
    </div>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
    <label class="md-nav__title md-nav__title--site" for="__drawer">
      <a href="http://siddhi.io/en/v5.1/" title="Siddhi"
         class="md-nav__button md-logo">
        
          <img src="../../../../images/siddhi-logo.svg" width="48" height="48">
        
      </a>
      Siddhi
    </label>
    
      <div class="md-nav__source">
        


  

<a href="https://github.com/siddhi-io/siddhi/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    Siddhi
  </div>
</a>
      </div>
    
    <ul class="md-nav__list" data-md-scrollfix>
      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Download
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Download
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../download/" title="Download" class="md-nav__link">
      Download
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../release-notes/" title="Release Notes" class="md-nav__link">
      Release Notes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Quick Start
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Quick Start
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    
    <label class="md-nav__link" for="nav-3">
      Documentation
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Documentation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../features/" title="Features" class="md-nav__link">
      Features
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-4" type="checkbox" id="nav-3-4" checked>
    
    <label class="md-nav__link" for="nav-3-4">
      Use case Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-4">
        Use case Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../alerts-for-thresholds/guide/" title="Alerts Based on Thresholds" class="md-nav__link">
      Alerts Based on Thresholds
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../fault-tolerance/guide/" title="Fault Tolerance & Error Handling" class="md-nav__link">
      Fault Tolerance & Error Handling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../patterns-and-trends/guide/" title="Patterns & Trends Over Time" class="md-nav__link">
      Patterns & Trends Over Time
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../database-static-rule-processing/guide/" title="Static Rule Processing using Database Rules" class="md-nav__link">
      Static Rule Processing using Database Rules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../integrate-various-enterprise-systems/guide/" title="Integrate Various Enterprise Systems" class="md-nav__link">
      Integrate Various Enterprise Systems
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Realtime Movie Recommendation
      </label>
    
    <a href="./" title="Realtime Movie Recommendation" class="md-nav__link md-nav__link--active">
      Realtime Movie Recommendation
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scenario-predicting-movie-ratings" title="Scenario - Predicting movie ratings" class="md-nav__link">
    Scenario - Predicting movie ratings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" title="What you'll build" class="md-nav__link">
    What you'll build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-requirements" title="Mandatory Requirements" class="md-nav__link">
    Mandatory Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#training-tensorflow-model-for-sentiment-analysis" title="Training Tensorflow model for Sentiment Analysis" class="md-nav__link">
    Training Tensorflow model for Sentiment Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training-pmml-model-for-movie-recommendation" title="Training PMML model for movie recommendation" class="md-nav__link">
    Training PMML model for movie recommendation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Requirements needed to deploy Siddhi in Docker/Kubernetes" class="md-nav__link">
    Requirements needed to deploy Siddhi in Docker/Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implement-streaming-queries" title="Implement Streaming Queries" class="md-nav__link">
    Implement Streaming Queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-mock-logger-service" title="Run Mock Logger service" class="md-nav__link">
    Run Mock Logger service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-the-siddhi-app" title="Invoking the Siddhi App" class="md-nav__link">
    Invoking the Siddhi App
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-on-vm-bare-metal" title="Deploy on VM/ Bare Metal" class="md-nav__link">
    Deploy on VM/ Bare Metal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-docker" title="Deploy on Docker" class="md-nav__link">
    Deploy on Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-kubernetes" title="Deploy on Kubernetes" class="md-nav__link">
    Deploy on Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../tooling/" title="Tooling" class="md-nav__link">
      Tooling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../query-guide/" title="Query Guide" class="md-nav__link">
      Query Guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-7" type="checkbox" id="nav-3-7">
    
    <label class="md-nav__link" for="nav-3-7">
      Siddhi APIs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-7">
        Siddhi APIs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/latest/" title="latest" class="md-nav__link">
      latest
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../api/5.1.0/" title="5.1.0" class="md-nav__link">
      5.1.0
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3-8" type="checkbox" id="nav-3-8">
    
    <label class="md-nav__link" for="nav-3-8">
      REST API Guides
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-3-8">
        REST API Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/siddhi-app-api/" title="Siddhi App APIs" class="md-nav__link">
      Siddhi App APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/store-api/" title="Store APIs" class="md-nav__link">
      Store APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/health-check-api/" title="Health Check APIs" class="md-nav__link">
      Health Check APIs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../rest-guides/http-status-code/" title="HTTP Status Codes" class="md-nav__link">
      HTTP Status Codes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../extensions/" title="Extensions" class="md-nav__link">
      Extensions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-java-library/" title="Siddhi Java library" class="md-nav__link">
      Siddhi Java library
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-local-microservice/" title="Siddhi Local Microservice" class="md-nav__link">
      Siddhi Local Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-docker-microservice/" title="Siddhi Docker Microservice" class="md-nav__link">
      Siddhi Docker Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../siddhi-as-a-kubernetes-microservice/" title="Siddhi Kubernetes Microservice" class="md-nav__link">
      Siddhi Kubernetes Microservice
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../config-guide/" title="Configuration Guide" class="md-nav__link">
      Configuration Guide
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Community
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Community
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/" title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/source/" title="Source" class="md-nav__link">
      Source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/build/" title="Build" class="md-nav__link">
      Build
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../../development/roadmap/" title="Roadmap" class="md-nav__link">
      Roadmap
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
        
        
        


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      License
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        License
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="/license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

      
    </ul>
  </nav>  
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">On this page</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#scenario-predicting-movie-ratings" title="Scenario - Predicting movie ratings" class="md-nav__link">
    Scenario - Predicting movie ratings
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-youll-build" title="What you'll build" class="md-nav__link">
    What you'll build
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#prerequisites" title="Prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mandatory-requirements" title="Mandatory Requirements" class="md-nav__link">
    Mandatory Requirements
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#training-tensorflow-model-for-sentiment-analysis" title="Training Tensorflow model for Sentiment Analysis" class="md-nav__link">
    Training Tensorflow model for Sentiment Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#training-pmml-model-for-movie-recommendation" title="Training PMML model for movie recommendation" class="md-nav__link">
    Training PMML model for movie recommendation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Requirements needed to deploy Siddhi in Docker/Kubernetes" class="md-nav__link">
    Requirements needed to deploy Siddhi in Docker/Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementation" title="Implementation" class="md-nav__link">
    Implementation
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#implement-streaming-queries" title="Implement Streaming Queries" class="md-nav__link">
    Implement Streaming Queries
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing" title="Testing" class="md-nav__link">
    Testing
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-mock-logger-service" title="Run Mock Logger service" class="md-nav__link">
    Run Mock Logger service
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#invoking-the-siddhi-app" title="Invoking the Siddhi App" class="md-nav__link">
    Invoking the Siddhi App
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deployment" title="Deployment" class="md-nav__link">
    Deployment
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-on-vm-bare-metal" title="Deploy on VM/ Bare Metal" class="md-nav__link">
    Deploy on VM/ Bare Metal
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-docker" title="Deploy on Docker" class="md-nav__link">
    Deploy on Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-on-kubernetes" title="Deploy on Kubernetes" class="md-nav__link">
    Deploy on Kubernetes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
  
                
                  <a href="https://github.com/siddhi-io/www/edit/v5.1/en/docs/docs/guides/realtime-movie-recommendation/guide.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="realtime-predictions-with-pre-trained-ml-models">Realtime predictions with pre-trained ML models<a class="headerlink" href="#realtime-predictions-with-pre-trained-ml-models" title="Permanent link">&para;</a></h1>
<p>In this guide, we are going to understand  how we can use Siddhi’s capability to perform real time predictions with a pre-trained machine learning models.</p>
<h2 id="scenario-predicting-movie-ratings">Scenario - Predicting movie ratings<a class="headerlink" href="#scenario-predicting-movie-ratings" title="Permanent link">&para;</a></h2>
<p>Recommendation systems that model users and their interests are often used to improve various user services. 
Such systems are usually based on automatic prediction of user ratings of the items provided by the service. </p>
<p>Within this guide, we focus on using machine learning capabilities integrated with Siddhi to perform Sentiment Analysis 
and generate movie recommendations. 
We'll use a pretrained tensorflow model to predict whether a movie review is positive or negative using BERT in Tensorflow 
and then a PMML model trained with the MovieLense dataset to generate recommendations for a positively reviewed movie. </p>
<p>The following sections are available in this guide.</p>
<ul>
<li><a href="#what-youll-build">What you'll build</a></li>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#testing">Testing</a></li>
<li><a href="#deployment">Deployment &amp; Output</a></li>
</ul>
<h2 id="what-youll-build">What you'll build<a class="headerlink" href="#what-youll-build" title="Permanent link">&para;</a></h2>
<p>We are going to consider a real world use case of implementing a real time prediction requirement. 
This will help you to understand some Siddhi Stream Processing constructs and extensions such as filters, source, sinks, 
tensorflow, pmml extensions… Let’s jump in to the use case directly.</p>
<p>This guide demonstrates how we can build a recommendation system which recommends movies based on the user’s review comments. 
User would write a review comment on a movie and this review comment would be the initial input to the system. From the system, 
we would perform sentiment analysis using a pre-trained tensorflow model to binary classify the review comment as positive or negative.
If the user’s comment is positive, we pass the UserId and the MovieId as inputs to a pre-trained PMML model which then generates movie recommendations.</p>
<p><img alt="Movie Recommendation_Scenario" src="../images/movie-recommendation-system.png" title="Movie Recommendation Scenario" /></p>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>Below are the prerequisites that should be considered to implement the above use case.</p>
<h3 id="mandatory-requirements">Mandatory Requirements<a class="headerlink" href="#mandatory-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://siddhi.io/en/v5.1/download/">Siddhi tooling VM/Local distribution</a></li>
<li>One of the <a href="https://siddhi.io/en/v5.1/download/">Siddhi runner distributions</a> <ul>
<li>VM/Local Runtime</li>
<li>Docker Image</li>
<li>K8S Operator (commands are given in deployment section)</li>
</ul>
</li>
<li>Java 8 or higher</li>
<li><a href="https://maven.wso2.org/nexus/service/local/repositories/releases/content/io/siddhi/extension/gpl/execution/pmml/siddhi-gpl-execution-pmml/5.0.1/siddhi-gpl-execution-pmml-5.0.1.jar">Siddhi Gpl Execution PMML extension</a></li>
<li><a href="https://mvnrepository.com/artifact/io.siddhi.extension.execution.tensorflow/siddhi-execution-tensorflow/2.0.2">Siddhi Execution Tensorflow extension</a> </li>
<li><a href="https://github.com/pcnfernando/MovieRecommendationSystem/tree/master/tf/SentimentAnalysisModel/bert">Pre-trained sentiment analysis tensorflow model</a></li>
<li><a href="https://github.com/pcnfernando/MovieRecommendationSystem/tree/master/pmml/MovieRecommendationModel">Pre-trained movie recommendation PMML model</a></li>
</ul>
<h5 id="training-tensorflow-model-for-sentiment-analysis">Training Tensorflow model for Sentiment Analysis<a class="headerlink" href="#training-tensorflow-model-for-sentiment-analysis" title="Permanent link">&para;</a></h5>
<p>We use the IMDB dataset that contains the text of 50,000 movie reviews from the Internet Movie Database. 
These are split into 25,000 reviews for training and 25,000 reviews for testing. The training and testing sets are balanced, 
meaning they contain an equal number of positive and negative reviews.  We use this data to train a Tensorflow model. </p>
<p>You can find the <a href="https://github.com/pcnfernando/IMDB_SentimentAnalysis/blob/master/tf/predicting_movie_reviews_with_bert_on_tf_hub.ipynb">Jupyter notebook</a> used to train the tensorflow sentiment analysis model. </p>
<h5 id="training-pmml-model-for-movie-recommendation">Training PMML model for movie recommendation<a class="headerlink" href="#training-pmml-model-for-movie-recommendation" title="Permanent link">&para;</a></h5>
<p>We use the MovieLens 1M Dataset that contain 1,000,209 anonymous ratings of approximately 3,900 movies for training the model. We use Scikit-Learn library to create the recommendation model and exports it using SkLearn2PMML to a PMML model.</p>
<p>You can find the <a href="https://github.com/codeheroku/Introduction-to-Machine-Learning/blob/master/Building%20a%20Movie%20Recommendation%20Engine/Movie_Recommendation_Engine.ipynb">Jupyter notebook</a> used to train the movie recommendation model. </p>
<h3 id="requirements-needed-to-deploy-siddhi-in-dockerkubernetes">Requirements needed to deploy Siddhi in Docker/Kubernetes<a class="headerlink" href="#requirements-needed-to-deploy-siddhi-in-dockerkubernetes" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://docs.docker.com/engine/installation/">Docker</a></li>
<li><a href="https://github.com/kubernetes/minikube#installation">Minikube</a> or <a href="https://console.cloud.google.com/">Google Kubernetes Engine(GKE) Cluster</a> or <a href="https://docs.docker.com/docker-for-mac/install/">Docker for Mac</a></li>
</ul>
<h2 id="implementation">Implementation<a class="headerlink" href="#implementation" title="Permanent link">&para;</a></h2>
<p>Let’s assume the system sends a HTTP request upon user adding a review comment to a movie to endpoint /feedbackInputStream registered by Siddhi Runtime. 
This HTTP request would contain the UserId, MovieId and the ReviewComment. </p>
<ul>
<li>Siddhi Runtime performs sentiment analysis on the received ReviewComment using a pre-trained tensorflow model.</li>
<li>If the review comment is positive, then the MovieId and UserId are passed to a recommendation PMML model and it recommends few movies for the passed combination.</li>
<li>This recommendation is then sent back as an HTTP request back to the system. </li>
</ul>
<p>The use case depends on two extensions namely Siddhi-gpl-execution-pmml and Siddhi-execution-tensorflow extensions that are not bundled to the Siddhi distributions by default.
Hence, these dependencies needs to be copied to the distribution before you start implementing the use case.</p>
<p>Copy siddhi-gpl-execution-pmml and siddhi-execution-tensorflow extensions to SIDDHI_TOOLING_HOME/bundles directory. 
Refer <a href="https://siddhi.io/en/v5.1/docs/config-guide/#adding-extensions-and-third-party-dependencies">Adding Extensions and Third Party Dependencies documentation</a> for more details.</p>
<h3 id="implement-streaming-queries">Implement Streaming Queries<a class="headerlink" href="#implement-streaming-queries" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Start the <a href="https://siddhi.io/en/v5.0/docs/tooling/">Siddhi tooling</a> runtime and go to the editor UI in http://localhost:9390/editor </p>
<p>Follow below steps to start the Siddhi tooling runtime.
* Extract the downloaded zip and navigate to <TOOLING_HOME>/bin. (TOOLING_HOME refers to the extracted folder) 
* Issue the following command in the command prompt (Windows) / terminal (Linux/Mac)
    <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>For Windows: tooling.bat
For Linux/Mac: ./tooling.sh
</pre></div>
</td></tr></table></p>
</li>
<li>
<p>Select File -&gt; New option, then you could either use the source view or design view to write/build the Siddhi Application. You can find the Siddhi Application bellow, that implements the requirements mentioned above.</p>
</li>
<li>
<p>Let’s write (develop) the Siddhi Application, as given below.</p>
</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">name</span><span class="p">(</span><span class="s1">&#39;Realtime-Movie-Recommendation-App&#39;</span><span class="p">)</span>
<span class="o">@</span><span class="n">App</span><span class="p">:</span><span class="n">description</span><span class="p">(</span><span class="s1">&#39;Performs realtime movie recommendations&#39;</span><span class="p">)</span>

<span class="o">@</span><span class="k">Source</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">receiver</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://0.0.0.0:8006/feedbackInputStream&#39;</span><span class="p">,</span>
 <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">FeedbackInputStream</span> <span class="p">(</span><span class="n">userId</span> <span class="n">string</span><span class="p">,</span> <span class="n">movieId</span> <span class="n">string</span><span class="p">,</span> <span class="n">reviewComment</span> <span class="n">string</span><span class="p">);</span>

<span class="o">@</span><span class="k">Source</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span>
        <span class="n">receiver</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://0.0.0.0:8006/recomendationRequestStream&#39;</span><span class="p">,</span>
        <span class="n">basic</span><span class="p">.</span><span class="n">auth</span><span class="p">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="s1">&#39;false&#39;</span><span class="p">,</span> <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RecomendationRequestStream</span><span class="p">(</span><span class="n">userId</span> <span class="n">string</span><span class="p">,</span> <span class="n">movieId</span> <span class="n">string</span><span class="p">);</span>

<span class="c1">-- HTTP sink to publish movie recommendations. For testing purposes, there is a mock logger service provided </span>
<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">publisher</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="ss">&quot;http://${LOGGER_SERVICE_HOST}:8080/logger&quot;</span><span class="p">,</span> <span class="k">method</span> <span class="o">=</span> <span class="ss">&quot;POST&quot;</span><span class="p">,</span> <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;http&#39;</span><span class="p">,</span> <span class="n">publisher</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://0.0.0.0:8008/movieRecommendations&#39;</span><span class="p">,</span> 
<span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">))</span>
<span class="o">@</span><span class="n">sink</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="o">@</span><span class="k">map</span><span class="p">(</span><span class="k">type</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span><span class="p">))</span>
<span class="n">define</span> <span class="n">stream</span> <span class="n">RecommendedMovieStream</span> <span class="p">(</span><span class="n">userId</span> <span class="n">string</span><span class="p">,</span> <span class="n">movieList</span> <span class="n">string</span><span class="p">);</span>

<span class="c1">-- Perform sentiment analysis on the review comment</span>
<span class="c1">--probabilities0 and probabilities1 stands for positive and negative probabilities respectlively.</span>
<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;query1&#39;</span><span class="p">)</span> 
<span class="k">From</span> <span class="n">FeedbackInputStream</span><span class="o">#</span><span class="n">tensorFlow</span><span class="p">:</span><span class="n">predict</span><span class="p">(</span><span class="s1">&#39;${SENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH}&#39;</span><span class="p">,</span> <span class="s1">&#39;input_string_text&#39;</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="s1">&#39;probabilities&#39;</span><span class="p">,</span> <span class="n">str</span><span class="p">:</span><span class="n">concat</span><span class="p">(</span><span class="ss">&quot;{&#39;input_text&#39;:&#39;&quot;</span><span class="p">,</span> <span class="n">reviewComment</span><span class="p">,</span> <span class="ss">&quot;&#39;}&quot;</span><span class="p">))</span> 
<span class="k">select</span> <span class="n">userId</span><span class="p">,</span> <span class="n">movieId</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">probabilities0</span><span class="p">,</span> <span class="n">probabilities1</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">SentimentPredictionStream</span><span class="p">;</span>

<span class="c1">-- Filter positive review comment</span>
<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;query2&#39;</span><span class="p">)</span> 
<span class="k">from</span> <span class="n">SentimentPredictionStream</span><span class="p">[</span><span class="n">label</span> <span class="o">==</span> <span class="ss">&quot;positive&quot;</span><span class="p">]</span>
<span class="k">select</span> <span class="n">userId</span><span class="p">,</span> <span class="n">movieId</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">RecomendationRequestStream</span><span class="p">;</span>

<span class="c1">-- Recommends a movie list for the provided userId and movieId</span>
<span class="o">@</span><span class="n">info</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;query3&#39;</span><span class="p">)</span> 
<span class="k">From</span> <span class="n">RecomendationRequestStream</span><span class="o">#</span><span class="n">pmml</span><span class="p">:</span><span class="n">predict</span><span class="p">(</span><span class="s1">&#39;${MOVIE_RECOMMENDATION_PMML_MODEL_PATH}&#39;</span><span class="p">,</span> <span class="n">userId</span><span class="p">,</span> <span class="n">movieId</span><span class="p">)</span> 
<span class="k">select</span> <span class="n">userId</span><span class="p">,</span> <span class="n">movieList</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">RecommendedMovieStream</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>Source view of the Siddhi app.
<img alt="source_view" src="../images/source-view.png" title="Source view of the Siddhi App" /></p>
<p>Below is the flow diagram of the above Siddhi App.</p>
<p><img alt="query_flow" src="../images/query-flow.png" title="Query flow diagram" /></p>
<ol>
<li>Once the Siddhi app is created, you can use the Event Simulator option in the editor to simulate events to streams and perform developer testing.</li>
</ol>
<h2 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h2>
<p>NOTE: In the provided Siddhi app, there are some environmental variables (SENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH, and MOVIE_RECOMMENDATION_PMML_MODEL_PATH) used which are the absolute paths for the pre-trained models. Again, there is a mock service configured to receive the recommended movies, and its host is configured via LOGGER_SERVICE_HOST environment property. Hence, make sure to set the environmental variables with the proper values in the system</p>
<ul>
<li>SENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH: Absolute path to the pre-trained tensorflow saved model directory.</li>
<li>MOVIE_RECOMMENDATION_PMML_MODEL_PATH: Absolute path to the pre-trained PMML file.</li>
<li>LOGGER_SERVICE_HOST: IP address of the host where logger service is running. (eg: 'localhost')</li>
</ul>
<p>When you run the Siddhi app in the editor, you will see below logs getting printed in the editor console.</p>
<p><img alt="editor_app_run_mode" src="../images/editor-app-run-mode.png" title="Siddhi App Run mode" /></p>
<ul>
<li>You could simply simulate some events directly into the stream and test your Siddhi app in the editor itself. </li>
<li>Then, you can also simulate some events through HTTP to test the application. The following sections explain how you can test the Siddhi app via HTTP using cURL. </li>
</ul>
<h3 id="run-mock-logger-service">Run Mock Logger service<a class="headerlink" href="#run-mock-logger-service" title="Permanent link">&para;</a></h3>
<p>In the provided Siddhi app, there is a HTTP sink configured to push output events to an HTTP endpoint. To verify that, please download the mock server <a href="https://github.com/pcnfernando/MovieRecommendationSystem/util/logservice-1.0.0.jar">jar</a> and run that mock service by executing below command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>java -jar logservice-1.0.0.jar
</pre></div>
</td></tr></table>

<h3 id="invoking-the-siddhi-app">Invoking the Siddhi App<a class="headerlink" href="#invoking-the-siddhi-app" title="Permanent link">&para;</a></h3>
<p>As mentioned in the previous steps, there is a service running in Siddhi side which is listening for events related to movie review comments. As per the Siddhi query that we wrote in the ‘Implementation’ section, respective service can be accessed via 'http://0.0.0.0:8006/feedbackInputStream'.</p>
<p>As per the app, if the review comment is positive, movies similar to the reviewed movie will be returned as recommendations.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>curl -v -X POST -d \
&#39;{&quot;event&quot;: {&quot;userId&quot;: &quot;user105&quot;, &quot;movieId&quot;: &quot;avatar&quot;, &quot;reviewComment&quot;: &quot;Best movie experience of the last 30 years..&quot;}}&#39; \
&quot;http://localhost:8006/feedbackInputStream&quot; -H &quot;Content-Type:application/json&quot;
</pre></div>
</td></tr></table>

<p>If you invoke, above cURL request then Siddhi would identify it as a positive feedback and recommends similar movies. In this guide, for simplicity we are just logging the movie recommendations as below. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>INFO {io.siddhi.core.stream.output.sink.LogSink} - Realtime-Movie-Recommendation-App : RecommendedMovieStream : Event{timestamp=1568785937271, data=[user105, {After Earth, Star Trek Into Darkness, Oblivion, The Croods}], isExpired=false}
</pre></div>
</td></tr></table>

<h2 id="deployment">Deployment<a class="headerlink" href="#deployment" title="Permanent link">&para;</a></h2>
<p>Once you are done with the development, export the Siddhi app that you have developed with File -&gt; Export File option.</p>
<p>You can deploy the Siddhi app using any of the methods listed below. </p>
<p>NOTE: In the above provided Siddhi app, there are some environmental variables (SENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH and MOVIE_RECOMMENDATION_PMML_MODEL_PATH)  which are mandatory to be set for Siddhi application to execute. Again, there is a mock service configured to publish the movie recommendations. Please configure LOGGER_SERVICE_HOST environment property to point the host where mock service is running.</p>
<ul>
<li>SENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH: Absolute path to the pre-trained tensorflow saved model directory.</li>
<li>MOVIE_RECOMMENDATION_PMML_MODEL_PATH: Absolute path to the pre-trained PMML file.</li>
<li>LOGGER_SERVICE_HOST: IP address of the host where logger service is running. (eg: 'localhost')</li>
</ul>
<h3 id="deploy-on-vm-bare-metal">Deploy on VM/ Bare Metal<a class="headerlink" href="#deploy-on-vm-bare-metal" title="Permanent link">&para;</a></h3>
<ol>
<li>Download the latest Siddhi Runner <a href="https://github.com/siddhi-io/distribution/releases/download/v5.1.0-beta/siddhi-runner-5.1.0-beta.zip">distribution</a>.</li>
<li>Unzip the <code>siddhi-runner-x.x.x.zip</code>.</li>
<li>Copy the downloaded <a href="https://maven.wso2.org/nexus/service/local/repositories/releases/content/io/siddhi/extension/gpl/execution/pmml/siddhi-gpl-execution-pmml/5.0.1/siddhi-gpl-execution-pmml-5.0.1.jar">siddhi-gpl-execution-pmml</a> and <a href="https://mvnrepository.com/artifact/io.siddhi.extension.execution.tensorflow/siddhi-execution-tensorflow/2.0.2">siddhi-execution-tensorflow</a> to SIDDHI_RUNNER_HOME/bundles directory.</li>
<li>
<p>Start Siddhi app with the runner config by executing the following commands from the distribution directory.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>Linux/Mac : ./bin/runner.sh -Dapps=&lt;siddhi-file-path&gt; -DSENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH=&lt;sentiment-analysis-tf-model-path&gt; -DMOVIE_RECOMMENDATION_PMML_MODEL_PATH=&lt;movie-recommendation-pmml-model-path&gt;

Windows : bin\runner.bat -Dapps=&lt;siddhi-file-path&gt; -DSENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH=&lt;sentiment-analysis-tf-model-path&gt; -DMOVIE_RECOMMENDATION_PMML_MODEL_PATH=&lt;movie-recommendation-pmml-model-path&gt;

Eg: If exported siddhi app in Siddhi home directory,
      ./bin/runner.sh -Dapps=Realtime-Movie-Recommendation-App.siddhi
</pre></div>
</td></tr></table>

</li>
<li>
<p>Download the mock <a href="https://github.com/pcnfernando/MovieRecommendationSystem/util/logservice-1.0.0.jar">logging service</a> which is used to demonstrate the capability of Siddhi HTTP sink. Execute the below command to run the mock server.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>java -jar logservice-1.0.0.jar
</pre></div>
</td></tr></table>

</li>
<li>
<p>Invoke the service with below cURL request.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>curl -v -X POST -d \
&#39;{&quot;event&quot;: {&quot;userId&quot;: &quot;user105&quot;, &quot;movieId&quot;: &quot;avatar&quot;, &quot;reviewComment&quot;: &quot;Best movie experience of the last 30 years..&quot;}}&#39; \
&quot;http://localhost:8006/feedbackInputStream&quot; -H &quot;Content-Type:application/json&quot;
</pre></div>
</td></tr></table>

</li>
<li>
<p>We can see the output log in the console as shown below. You could see there is an alert log printed as shown in the below image.</p>
<p><img alt="console_output_vm" src="../images/console_output_vm.png" title="Console output" /></p>
</li>
<li>
<p>At the same time, you could also see the events received to HTTP mock service endpoint (started in step #5) via its log as below.</p>
<p><img alt="mock_service_output_vm" src="../images/mock_service_output_vm.png" title="Mock service output" /></p>
</li>
</ol>
<h3 id="deploy-on-docker">Deploy on Docker<a class="headerlink" href="#deploy-on-docker" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create a folder locally on your host machine (eg: <code>/home/siddhi-apps</code>) and copy the Siddhi app into it.</p>
</li>
<li>
<p>Create a folder locally (eg: <code>/home/tf_model</code>) and copy the pretrained Sentiment Analysis tensorflow model in to it.</p>
</li>
<li>
<p>Create a folder locally (eg: <code>/home/pmml_model</code>) and copy the pretrained Movie Recommendation PMML model in to it.</p>
</li>
<li>
<p>Pull the latest Siddhi Runner image from [Siddhiio Docker Hub] (https://hub.docker.com/u/siddhiio).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker pull siddhiio/siddhi-runner-alpine:5.1.0-beta
</pre></div>
</td></tr></table>

</li>
<li>
<p>Start SiddhiApp by executing the following docker command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>docker run -it -p 8006:8006 -v /home/siddhi-apps:/apps -v /home/tf_model:/tf_model -v /home/pmml_model:/pmml_model -e SENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH=/tf_model -e MOVIE_RECOMMENDATION_PMML_MODEL_PATH=/pmml_model/movie-recommendation.pmml siddhiio/siddhi-runner-alpine:5.1.0-beta -Dapps=/apps/Realtime-Movie-Recommendation-App.siddhi
</pre></div>
</td></tr></table>

<p>NOTE: In the above provided Siddhi app, there are some environmental variables (SENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH and MOVIE_RECOMMENDATION_PMML_MODEL_PATH)  which are mandatory to be set for Siddhi application to execute. Again, there is a mock service configured to receive the recommended movies (instructions given below), and its host is configured via LOGGER_SERVICE_HOST environment property. 
Hence, make sure to add proper values for the environmental variables in the above command.</p>
</li>
<li>
<p>Download the mock <a href="https://github.com/pcnfernando/MovieRecommendationSystem/util/logservice-1.0.0.jar">logging service</a>  which is used to demonstrate the capability of SIddhi HTTP sink. Execute below command to run the mock server.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    java -jar logservice-1.0.0.jar
</pre></div>
</td></tr></table>

</li>
<li>
<p>Send a POST request with the movie feedback to the endpoint.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    curl -v -X POST -d \
    &#39;{&quot;event&quot;: {&quot;userId&quot;: &quot;user105&quot;, &quot;movieId&quot;: &quot;avatar&quot;, &quot;reviewComment&quot;: &quot;Best movie experience of the last 30 years..&quot;}}&#39; \
    &quot;http://localhost:8006/feedbackInputStream&quot; -H &quot;Content-Type:application/json&quot;
</pre></div>
</td></tr></table>

</li>
<li>
<p>Since you have started the docker in interactive mode you can see the output in its console as below. 
(If it is not started in the interactive mode then you can run <code>docker exec -it  &lt;docker-container-id&gt; sh</code> command, go into the container and check the log file in <code>home/siddhi_user/siddhi-runner/wso2/runner/logs/carbon.log</code> file)</p>
<p><img alt="console_output_docker" src="../images/console_output_docker.png" title="Console output" /></p>
</li>
<li>
<p>At the same time, you could also see the events received to HTTP mock service endpoint (started in step #4) via its log as below.</p>
<p><img alt="mock_service_output_docker" src="../images/mock_service_output_docker.png" title="Mock service output" /></p>
</li>
</ol>
<h3 id="deploy-on-kubernetes">Deploy on Kubernetes<a class="headerlink" href="#deploy-on-kubernetes" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Install Siddhi Operator</p>
<ul>
<li>
<p>To install the Siddhi Kubernetes operator run the following commands.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl apply -f https://github.com/siddhi-io/siddhi-operator/releases/download/v0.2.0-alpha/00-prereqs.yaml
kubectl apply -f https://github.com/siddhi-io/siddhi-operator/releases/download/v0.2.0-alpha/01-siddhi-operator.yaml
</pre></div>
</td></tr></table>

</li>
<li>
<p>You can verify the installation by making sure the following deployments are running in your Kubernetes cluster.</p>
<p><img alt="kubernetes_siddhi-deployments" src="../images/kubernetes-siddhi-deployments.png" title="K8S Siddhi deployments" /></p>
</li>
</ul>
</li>
<li>
<p>Download the mock <a href="https://github.com/pcnfernando/MovieRecommendationSystem/util/logservice-1.0.0.jar">logging service</a> 
which is used to demonstrate the capability of Siddhi HTTP sink. Execute the below command to run the mock server.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>    java -jar logservice-1.0.0.jar
</pre></div>
</td></tr></table>

</li>
<li>
<p>Siddhi applications can be deployed on Kubernetes using the Siddhi operator.</p>
<ul>
<li>
<p>Before deploying the apps you have to define an <a href="https://kubernetes.github.io/ingress-nginx/deploy/#provider-specific-steps">Ingress</a>, this is because there is an HTTP endpoint in the Siddhi app you have written and you will be sending events to that.</p>
</li>
<li>
<p>We need a custom docker image bundling the pretrained models to the container.
  <table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1"># use siddhi-runner-base</span>
<span class="l l-Scalar l-Scalar-Plain">FROM siddhiio/siddhi-runner-base-alpine:5.1.0-beta</span>
<span class="l l-Scalar l-Scalar-Plain">MAINTAINER Siddhi IO Docker Maintainers &quot;siddhi-dev@googlegroups.com&quot;</span>

<span class="l l-Scalar l-Scalar-Plain">ARG HOST_BUNDLES_DIR=./bundles</span>
<span class="l l-Scalar l-Scalar-Plain">ARG HOST_JARS_DIR=./jars</span>
<span class="l l-Scalar l-Scalar-Plain">ARG HOST_APPS_DIR=./siddhi-files</span>
<span class="l l-Scalar l-Scalar-Plain">ARG TRAINED_MODEL_DIR=./models</span>
<span class="l l-Scalar l-Scalar-Plain">ARG JARS=${RUNTIME_SERVER_HOME}/jars</span>
<span class="l l-Scalar l-Scalar-Plain">ARG BUNDLES=${RUNTIME_SERVER_HOME}/bundles</span>
<span class="l l-Scalar l-Scalar-Plain">ARG APPS=${RUNTIME_SERVER_HOME}/deployment/siddhi-files</span>
<span class="l l-Scalar l-Scalar-Plain">ARG CONFIG_FILE=./configurations.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">ARG CONFIG_FILE_PATH=${HOME}/configurations.yaml</span>

<span class="l l-Scalar l-Scalar-Plain"># copy bundles &amp; jars to the siddhi-runner distribution</span>
<span class="l l-Scalar l-Scalar-Plain">COPY --chown=siddhi_user:siddhi_io ${HOST_APPS_DIR}/ ${APPS}</span>

<span class="l l-Scalar l-Scalar-Plain">COPY --chown=siddhi_user:siddhi_io ${HOST_BUNDLES_DIR}/ ${BUNDLES}</span>
<span class="l l-Scalar l-Scalar-Plain">COPY --chown=siddhi_user:siddhi_io ${CONFIG_FILE}/ ${USER_HOME}</span>
<span class="l l-Scalar l-Scalar-Plain">COPY --chown=siddhi_user:siddhi_io ${TRAINED_MODEL_DIR}/ ${USER_HOME}</span>

<span class="l l-Scalar l-Scalar-Plain"># expose ports</span>
<span class="l l-Scalar l-Scalar-Plain">EXPOSE 9090 9443 9712 9612 7711 7611 7070 7443</span>

<span class="l l-Scalar l-Scalar-Plain">STOPSIGNAL SIGINT</span>

<span class="l l-Scalar l-Scalar-Plain">ENTRYPOINT [&quot;/home/siddhi_user/siddhi-runner/bin/runner.sh&quot;]</span>
</pre></div>
</td></tr></table></p>
</li>
</ul>
<p>To create the docker image, save the above content to a docker file and execute the below command.
   <code>docker build &lt;absolute-docker-file-path&gt; -t siddhi-runner-mov-recommendation:1.0.0</code></p>
<ul>
<li>
<p>To deploy the above created Siddhi app, you have to create a custom resource object YAML file (with the kind as SiddhiProcess) as following</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="nt">apiVersion</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">siddhi.io/v1alpha2</span>
<span class="nt">kind</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SiddhiProcess</span>
<span class="nt">metadata</span><span class="p">:</span>
  <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">movie-recommendation-app</span>
<span class="nt">spec</span><span class="p">:</span>
  <span class="nt">apps</span><span class="p">:</span>
   <span class="p p-Indicator">-</span> <span class="nt">script</span><span class="p">:</span> <span class="p p-Indicator">|</span>
   <span class=" -Error"> </span><span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">App:name(&#39;Realtime-Movie-Recommendation-App&#39;)</span>
<span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">App:description(&#39;Performs realtime movie recommendations&#39;)</span>

<span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">Source(type = &#39;http&#39;, receiver.url = &#39;http://0.0.0.0:8006/feedbackInputStream&#39;,</span>
 <span class="l l-Scalar l-Scalar-Plain">basic.auth.enabled = &#39;false&#39;, @map(type = &#39;json&#39;))</span>
<span class="l l-Scalar l-Scalar-Plain">define stream FeedbackInputStream (userId string, movieId string, reviewComment string);</span>

<span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">Source(type = &#39;http&#39;,</span>
        <span class="l l-Scalar l-Scalar-Plain">receiver.url = &#39;http://0.0.0.0:8006/recomendationRequestStream&#39;,</span>
        <span class="l l-Scalar l-Scalar-Plain">basic.auth.enabled = &#39;false&#39;, @map(type = &#39;json&#39;))</span>
<span class="l l-Scalar l-Scalar-Plain">define stream RecomendationRequestStream(userId string, movieId string);</span>

<span class="l l-Scalar l-Scalar-Plain">-- HTTP sink to publish movie recommendations. For testing purposes, there is a mock logger service provided</span> 
<span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">sink(type = &#39;http&#39;, publisher.url = &quot;http://${LOGGER_SERVICE_HOST}:8080/logger&quot;, method = &quot;POST&quot;, @map(type = &#39;json&#39;))</span>
<span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">sink(type = &#39;log&#39;, @map(type = &#39;text&#39;))</span>
<span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">sink(type = &#39;http&#39;, publisher.url = &#39;http://0.0.0.0:8008/movieRecommendations&#39;,</span> 
<span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">map(type = &#39;json&#39;))</span>
<span class="l l-Scalar l-Scalar-Plain">define stream RecommendedMovieStream (userId string, movieList string);</span>

<span class="l l-Scalar l-Scalar-Plain">-- Perform sentiment analysis on the review comment</span>
<span class="l l-Scalar l-Scalar-Plain">--probabilities0 and probabilities1 stands for positive and negative probabilities respectlively.</span>
<span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">info(name = &#39;query1&#39;)</span> 
<span class="l l-Scalar l-Scalar-Plain">From FeedbackInputStream#tensorFlow:predict(&#39;${SENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH}&#39;, &#39;input_string_text&#39;, &#39;label&#39;, &#39;probabilities&#39;, str:concat(&quot;{&#39;input_text&#39;:&#39;&quot;, reviewComment, &quot;&#39;}&quot;))</span> 
<span class="l l-Scalar l-Scalar-Plain">select userId, movieId, label, probabilities0, probabilities1</span>
<span class="l l-Scalar l-Scalar-Plain">insert into SentimentPredictionStream;</span>

<span class="l l-Scalar l-Scalar-Plain">-- Filter positive review comment</span>
<span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">info(name = &#39;query2&#39;)</span> 
<span class="l l-Scalar l-Scalar-Plain">from SentimentPredictionStream[label == &quot;positive&quot;]</span>
<span class="l l-Scalar l-Scalar-Plain">select userId, movieId</span>
<span class="l l-Scalar l-Scalar-Plain">insert into RecomendationRequestStream;</span>

<span class="l l-Scalar l-Scalar-Plain">-- Recommends a movie list for the provided userId and movieId</span>
<span class="err">@</span><span class="l l-Scalar l-Scalar-Plain">info(name = &#39;query3&#39;)</span> 
<span class="l l-Scalar l-Scalar-Plain">From RecomendationRequestStream#pmml:predict(&#39;${MOVIE_RECOMMENDATION_PMML_MODEL_PATH}&#39;, userId, movieId)</span> 
<span class="l l-Scalar l-Scalar-Plain">select userId, movieList</span>
<span class="l l-Scalar l-Scalar-Plain">insert into RecommendedMovieStream;</span>

  <span class="l l-Scalar l-Scalar-Plain">container</span><span class="p p-Indicator">:</span>
    <span class="nt">env</span><span class="p">:</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">LOGGER_SERVICE_HOST</span>
        <span class="nt">value</span><span class="p">:</span> <span class="s">&quot;10.100.1.88&quot;</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">SENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH</span>
        <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/siddhi_user/trained_models/tf</span>
      <span class="p p-Indicator">-</span>
        <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">MOVIE_RECOMMENDATION_PMML_MODEL_PATH</span>
        <span class="nt">value</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/home/siddhi_user/trained_models/pmml/movie-recommendation.pmml</span>

    <span class="nt">image</span><span class="p">:</span> <span class="s">&quot;siddhi-runner-mov-recommendation:1.0.0&quot;</span>
</pre></div>
</td></tr></table>

<p>NOTE: In the above provided Siddhi app, there are some environmental variables (SENTIMENT_ANALYSIS_TF_SAVED_MODEL_PATH and MOVIE_RECOMMENDATION_PMML_MODEL_PATH)  which are mandatory to be set for Siddhi application to execute. Again, there is a mock service configured to to receive the recommended movies (instructions given below), and its host is configured via LOGGER_SERVICE_HOST environment property. 
Hence, make sure to add proper values for the environmental variables in the above YAML file (check the <code>env</code> section of the YAML file).</p>
</li>
<li>
<p>Now, let’s create the above resource in the Kubernetes cluster with the following command.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span> kubectl create -f &lt;absolute-yaml-file-path&gt;/Movie-Recommendation-App.yaml
</pre></div>
</td></tr></table>

</li>
<li>
<p>Once, Siddhi app is successfully deployed. You can verify its health using the following commands</p>
<p><img alt="kubernetes_output" src="../images/kubernetes_output.png" title="Kubectl console outputs" /></p>
</li>
<li>
<p>Then, add the host <code>siddhi</code> and related external IP (ADDRESS) to the <code>/etc/hosts</code> file in your machine. For Docker for Mac , external IP is <code>0.0.0.0</code>. For Minikube, you have to use Minikube IP as the external IP. Hence, run minikube ip command to get the IP of the Minikube cluster.</p>
</li>
<li>
<p>You can find the recommendations logged in the Siddhi runner log file. To see the Siddhi runner log file, first, invoke below command to get the pods.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl get pods
</pre></div>
</td></tr></table>

<p>Then, find the pod name of the Siddhi app deployed, and invoke below command to view the logs.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>kubectl logs -f &lt;siddhi-app-pod-name&gt;
</pre></div>
</td></tr></table>

<p>Eg: as shown below image,</p>
<p><img alt="kubernetes_get_pods" src="../images/kubernetes_get_pods.png" title="Kubectl get pods command output" /></p>
</li>
<li>
<p>Pass the movie review along with the userId and the movieId as a CURL request.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>curl -v -X POST -d \
&#39;{&quot;event&quot;: {&quot;userId&quot;: &quot;user105&quot;, &quot;movieId&quot;: &quot;avatar&quot;, &quot;reviewComment&quot;: &quot;Best movie experience of the last 30 years..&quot;}}&#39; \
&quot;http://siddhi/movie-recommendation-app-0/8006/feedbackInputStream&quot; -H &quot;Content-Type:application/json&quot;
</pre></div>
</td></tr></table>

</li>
<li>
<p>Then, we could see the movie recommendations as console logs (as given below).</p>
<p><img alt="console_output_kubernetes" src="../images/console_output_k8.png" title="Console output" /></p>
</li>
<li>
<p>At the same time, you could see the events received to HTTP mock endpoint that started in the step [2].</p>
<p><img alt="mock_service_output_kubernetes" src="../images/mock-service-output-kubernetes.png" title="Mock service output" /></p>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Refer <a href="https://siddhi.io/en/v5.1/docs/siddhi-as-a-kubernetes-microservice/">here</a> to get more details about running Siddhi on Kubernetes.</p>
</div>
</li>
</ol>
                
                  
                
              
  <a href="#" class="cd-top text--replace js-cd-top">Top</a>

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../integrate-various-enterprise-systems/guide/" title="Integrate Various Enterprise Systems" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Integrate Various Enterprise Systems
              </span>
            </div>
          </a>
        
        
          <a href="../../../tooling/" title="Tooling" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Tooling
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Siddhi - Documentation
          </div>
        
        &copy;2019 <a href="https://wso2.com/">WSO2</a>
      </div>
      
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../../../assets/fonts/font-awesome.css">
    
      <a href="/community/#community-collaboration" class="md-footer-social__link fa fa-slack"></a>
    
      <a href="https://github.com/siddhi-io/siddhi" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://medium.com/siddhi-io" class="md-footer-social__link fa fa-medium"></a>
    
      <a href="https://twitter.com/siddhi_io" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://www.linkedin.com/groups/13553064" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../../../.."}})</script>
      
        <script src="../../../../assets/lib/highlightjs/highlight.min.js"></script>
      
        <script src="../../../../assets/js/theme.js"></script>
      
        <script src="../../../../assets/lib/backtotop/js/util.js"></script>
      
        <script src="../../../../assets/lib/backtotop/js/main.js"></script>
      
    
  </body>
</html>